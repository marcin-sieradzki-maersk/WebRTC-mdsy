var Ti=(A,V)=>()=>(V||A((V={exports:{}}).exports,V),V.exports);import"./modulepreload-polyfill-B5Qt9EMX.js";var Yi=Ti((vi,hn)=>{(function(A){typeof vi=="object"&&typeof hn<"u"?hn.exports=A():typeof define=="function"&&define.amd?define([],A):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JsSIP=A()})(function(){return function(){return function A(V,j,L){function N(q,t){if(!j[q]){if(!V[q]){var I=typeof require=="function"&&require;if(!t&&I)return I(q,!0);if(i)return i(q,!0);var R=new Error("Cannot find module '"+q+"'");throw R.code="MODULE_NOT_FOUND",R}var s=j[q]={exports:{}};V[q][0].call(s.exports,function(_){return N(V[q][1][_]||_)},s,s.exports,A,V,j,L)}return j[q].exports}for(var i=typeof require=="function"&&require,M=0;M<L.length;M++)N(L[M]);return N}}()({1:[function(A,V,j){function L(_,a){var v=typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(!v){if(Array.isArray(_)||(v=function(S,b){if(S){if(typeof S=="string")return N(S,b);var T=Object.prototype.toString.call(S).slice(8,-1);if(T==="Object"&&S.constructor&&(T=S.constructor.name),T==="Map"||T==="Set")return Array.from(S);if(T==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T))return N(S,b)}}(_))||a){v&&(_=v);var y=0,C=function(){};return{s:C,n:function(){return y>=_.length?{done:!0}:{done:!1,value:_[y++]}},e:function(S){throw S},f:C}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c,p=!0,m=!1;return{s:function(){v=v.call(_)},n:function(){var S=v.next();return p=S.done,S},e:function(S){m=!0,c=S},f:function(){try{p||v.return==null||v.return()}finally{if(m)throw c}}}}function N(_,a){(a==null||a>_.length)&&(a=_.length);for(var v=0,y=new Array(a);v<a;v++)y[v]=_[v];return y}var i=A("./Utils"),M=A("./Constants"),q=A("./Grammar"),t=A("./URI"),I=A("./Socket"),R=A("./Exceptions");j.settings={authorization_user:null,password:null,realm:null,ha1:null,authorization_jwt:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:M.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:M.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:M.CONNECTION_RECOVERY_MIN_INTERVAL,extra_headers:null,via_host:"".concat(i.createRandomToken(12),".invalid")};var s={mandatory:{sockets:function(_){var a=[];if(I.isSocket(_))a.push({socket:_});else{if(!Array.isArray(_)||!_.length)return;var v,y=L(_);try{for(y.s();!(v=y.n()).done;){var C=v.value;Object.prototype.hasOwnProperty.call(C,"socket")&&I.isSocket(C.socket)?a.push(C):I.isSocket(C)&&a.push({socket:C})}}catch(c){y.e(c)}finally{y.f()}}return a},uri:function(_){/^sip:/i.test(_)||(_="".concat(M.SIP,":").concat(_));var a=t.parse(_);return a&&a.user?a:void 0}},optional:{authorization_user:function(_){return q.parse('"'.concat(_,'"'),"quoted_string")===-1?void 0:_},authorization_jwt:function(_){if(typeof _=="string")return _},user_agent:function(_){if(typeof _=="string")return _},connection_recovery_max_interval:function(_){if(i.isDecimal(_)){var a=Number(_);if(a>0)return a}},connection_recovery_min_interval:function(_){if(i.isDecimal(_)){var a=Number(_);if(a>0)return a}},contact_uri:function(_){if(typeof _=="string"){var a=q.parse(_,"SIP_URI");if(a!==-1)return a}},display_name:function(_){return _},instance_id:function(_){return/^uuid:/i.test(_)&&(_=_.substr(5)),q.parse(_,"uuid")===-1?void 0:_},no_answer_timeout:function(_){if(i.isDecimal(_)){var a=Number(_);if(a>0)return a}},session_timers:function(_){if(typeof _=="boolean")return _},session_timers_refresh_method:function(_){if(typeof _=="string"&&((_=_.toUpperCase())===M.INVITE||_===M.UPDATE))return _},session_timers_force_refresher:function(_){if(typeof _=="boolean")return _},password:function(_){return String(_)},realm:function(_){return String(_)},ha1:function(_){return String(_)},register:function(_){if(typeof _=="boolean")return _},register_expires:function(_){if(i.isDecimal(_)){var a=Number(_);if(a>0)return a}},registrar_server:function(_){/^sip:/i.test(_)||(_="".concat(M.SIP,":").concat(_));var a=t.parse(_);return a?a.user?void 0:a:void 0},use_preloaded_route:function(_){if(typeof _=="boolean")return _},extra_headers:function(_){var a=[];if(Array.isArray(_)&&_.length){var v,y=L(_);try{for(y.s();!(v=y.n()).done;){var C=v.value;typeof C=="string"&&a.push(C)}}catch(c){y.e(c)}finally{y.f()}return a}}}};j.load=function(_,a){for(var v in s.mandatory){if(!a.hasOwnProperty(v))throw new R.ConfigurationError(v);var y=a[v],C=s.mandatory[v](y);if(C===void 0)throw new R.ConfigurationError(v,y);_[v]=C}for(var c in s.optional)if(a.hasOwnProperty(c)){var p=a[c];if(i.isEmpty(p))continue;var m=s.optional[c](p);if(m===void 0)throw new R.ConfigurationError(c,p);_[c]=m}}},{"./Constants":2,"./Exceptions":6,"./Grammar":7,"./Socket":23,"./URI":29,"./Utils":30}],2:[function(A,V,j){var L=A("../package.json");V.exports={USER_AGENT:"".concat(L.title," ").concat(L.version),SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY,SUBSCRIBE",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2}},{"../package.json":42}],3:[function(A,V,j){function L(_,a){for(var v=0;v<a.length;v++){var y=a[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(_,y.key,y)}}var N=A("./Logger"),i=A("./SIPMessage"),M=A("./Constants"),q=A("./Transactions"),t=A("./Dialog/RequestSender"),I=A("./Utils"),R=new N("Dialog"),s={STATUS_EARLY:1,STATUS_CONFIRMED:2,STATUS_TERMINATED:3};V.exports=function(){function _(C,c,p){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.STATUS_CONFIRMED;if(function(b,T){if(!(b instanceof T))throw new TypeError("Cannot call a class as a function")}(this,_),this._owner=C,this._ua=C._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!c.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};c instanceof i.IncomingResponse&&(m=c.status_code<200?s.STATUS_EARLY:s.STATUS_CONFIRMED);var S=c.parseHeader("contact");p==="UAS"?(this._id={call_id:c.call_id,local_tag:c.to_tag,remote_tag:c.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=m,this._remote_seqnum=c.cseq,this._local_uri=c.parseHeader("to").uri,this._remote_uri=c.parseHeader("from").uri,this._remote_target=S.uri,this._route_set=c.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):p==="UAC"&&(this._id={call_id:c.call_id,local_tag:c.from_tag,remote_tag:c.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=m,this._local_seqnum=c.cseq,this._local_uri=c.parseHeader("from").uri,this._remote_uri=c.parseHeader("to").uri,this._remote_target=S.uri,this._route_set=c.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),R.debug("new ".concat(p," dialog created with status ").concat(this._state===s.STATUS_EARLY?"EARLY":"CONFIRMED"))}var a,v,y;return a=_,y=[{key:"C",get:function(){return s}}],(v=[{key:"id",get:function(){return this._id}},{key:"local_seqnum",get:function(){return this._local_seqnum},set:function(C){this._local_seqnum=C}},{key:"owner",get:function(){return this._owner}},{key:"uac_pending_reply",get:function(){return this._uac_pending_reply},set:function(C){this._uac_pending_reply=C}},{key:"uas_pending_reply",get:function(){return this._uas_pending_reply}},{key:"isTerminated",value:function(){return this._status===s.STATUS_TERMINATED}},{key:"update",value:function(C,c){this._state=s.STATUS_CONFIRMED,R.debug("dialog ".concat(this._id.toString(),"  changed to CONFIRMED state")),c==="UAC"&&(this._route_set=C.getHeaders("record-route").reverse())}},{key:"terminate",value:function(){R.debug("dialog ".concat(this._id.toString()," deleted")),this._ua.destroyDialog(this),this._state=s.STATUS_TERMINATED}},{key:"sendRequest",value:function(C){var c=this,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=I.cloneArray(p.extraHeaders),S=I.cloneObject(p.eventHandlers),b=p.body||null,T=this._createRequest(C,m,b);return S.onAuthenticated=function(){c._local_seqnum+=1},new t(this,T,S).send(),T}},{key:"receiveRequest",value:function(C){this._checkInDialogRequest(C)&&(C.method===M.ACK&&this._ack_seqnum!==null?this._ack_seqnum=null:C.method===M.INVITE&&(this._ack_seqnum=C.cseq),this._owner.receiveRequest(C))}},{key:"_createRequest",value:function(C,c,p){c=I.cloneArray(c),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));var m=C===M.CANCEL||C===M.ACK?this._local_seqnum:this._local_seqnum+=1;return new i.OutgoingRequest(C,this._remote_target,this._ua,{cseq:m,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},c,p)}},{key:"_checkInDialogRequest",value:function(C){var c=this;if(this._remote_seqnum)if(C.cseq<this._remote_seqnum){if(C.method!==M.ACK)return C.reply(500),!1;if(this._ack_seqnum===null||C.cseq!==this._ack_seqnum)return!1}else C.cseq>this._remote_seqnum&&(this._remote_seqnum=C.cseq);else this._remote_seqnum=C.cseq;if(C.method===M.INVITE||C.method===M.UPDATE&&C.body){if(this._uac_pending_reply===!0)C.reply(491);else{if(this._uas_pending_reply===!0){var p=1+(10*Math.random()|0);return C.reply(500,null,["Retry-After:".concat(p)]),!1}this._uas_pending_reply=!0,C.server_transaction.on("stateChanged",function m(){C.server_transaction.state!==q.C.STATUS_ACCEPTED&&C.server_transaction.state!==q.C.STATUS_COMPLETED&&C.server_transaction.state!==q.C.STATUS_TERMINATED||(C.server_transaction.removeListener("stateChanged",m),c._uas_pending_reply=!1)})}C.hasHeader("contact")&&C.server_transaction.on("stateChanged",function(){C.server_transaction.state===q.C.STATUS_ACCEPTED&&(c._remote_target=C.parseHeader("contact").uri)})}else C.method===M.NOTIFY&&C.hasHeader("contact")&&C.server_transaction.on("stateChanged",function(){C.server_transaction.state===q.C.STATUS_COMPLETED&&(c._remote_target=C.parseHeader("contact").uri)});return!0}}])&&L(a.prototype,v),y&&L(a,y),Object.defineProperty(a,"prototype",{writable:!1}),_}()},{"./Constants":2,"./Dialog/RequestSender":4,"./Logger":9,"./SIPMessage":22,"./Transactions":26,"./Utils":30}],4:[function(A,V,j){function L(t,I){for(var R=0;R<I.length;R++){var s=I[R];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var N=A("../Constants"),i=A("../Transactions"),M=A("../RequestSender"),q={onRequestTimeout:function(){},onTransportError:function(){},onSuccessResponse:function(){},onErrorResponse:function(){},onAuthenticated:function(){},onDialogError:function(){}};V.exports=function(){function t(s,_,a){for(var v in function(y,C){if(!(y instanceof C))throw new TypeError("Cannot call a class as a function")}(this,t),this._dialog=s,this._ua=s._ua,this._request=_,this._eventHandlers=a,this._reattempt=!1,this._reattemptTimer=null,q)Object.prototype.hasOwnProperty.call(q,v)&&(this._eventHandlers[v]||(this._eventHandlers[v]=q[v]))}var I,R;return I=t,(R=[{key:"request",get:function(){return this._request}},{key:"send",value:function(){var s=this,_=new M(this._ua,this._request,{onRequestTimeout:function(){s._eventHandlers.onRequestTimeout()},onTransportError:function(){s._eventHandlers.onTransportError()},onAuthenticated:function(a){s._eventHandlers.onAuthenticated(a)},onReceiveResponse:function(a){s._receiveResponse(a)}});_.send(),(this._request.method===N.INVITE||this._request.method===N.UPDATE&&this._request.body)&&_.clientTransaction.state!==i.C.STATUS_TERMINATED&&(this._dialog.uac_pending_reply=!0,_.clientTransaction.on("stateChanged",function a(){_.clientTransaction.state!==i.C.STATUS_ACCEPTED&&_.clientTransaction.state!==i.C.STATUS_COMPLETED&&_.clientTransaction.state!==i.C.STATUS_TERMINATED||(_.clientTransaction.removeListener("stateChanged",a),s._dialog.uac_pending_reply=!1)}))}},{key:"_receiveResponse",value:function(s){var _=this;s.status_code===408||s.status_code===481?this._eventHandlers.onDialogError(s):s.method===N.INVITE&&s.status_code===491?this._reattempt?s.status_code>=200&&s.status_code<300?this._eventHandlers.onSuccessResponse(s):s.status_code>=300&&this._eventHandlers.onErrorResponse(s):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(function(){_._dialog.isTerminated()||(_._reattempt=!0,_.send())},1e3)):s.status_code>=200&&s.status_code<300?this._eventHandlers.onSuccessResponse(s):s.status_code>=300&&this._eventHandlers.onErrorResponse(s)}}])&&L(I.prototype,R),Object.defineProperty(I,"prototype",{writable:!1}),t}()},{"../Constants":2,"../RequestSender":21,"../Transactions":26}],5:[function(A,V,j){function L(q,t){for(var I=0;I<t.length;I++){var R=t[I];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(q,R.key,R)}}var N=A("./Logger"),i=A("./Utils"),M=new N("DigestAuthentication");V.exports=function(){function q(R){(function(s,_){if(!(s instanceof _))throw new TypeError("Cannot call a class as a function")})(this,q),this._credentials=R,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}var t,I;return t=q,(I=[{key:"get",value:function(R){switch(R){case"realm":return this._realm;case"ha1":return this._ha1;default:return void M.warn('get() | cannot get "%s" parameter',R)}}},{key:"authenticate",value:function(R,s){var _=R.method,a=R.ruri,v=R.body,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(this._algorithm=s.algorithm,this._realm=s.realm,this._nonce=s.nonce,this._opaque=s.opaque,this._stale=s.stale,this._algorithm){if(this._algorithm!=="MD5")return M.warn('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return M.warn("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return M.warn("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return M.warn("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return M.warn('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(s.qop)if(s.qop.indexOf("auth-int")>-1)this._qop="auth-int";else{if(!(s.qop.indexOf("auth")>-1))return M.warn('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=_,this._uri=a,this._cnonce=y||i.createRandomToken(12),this._nc+=1;var C,c,p=Number(this._nc).toString(16);return this._ncHex="00000000".substr(0,8-p.length)+p,this._nc===4294967296&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=i.calculateMD5("".concat(this._credentials.username,":").concat(this._realm,":").concat(this._credentials.password)):this._ha1=this._credentials.ha1,this._qop==="auth"?(C="".concat(this._method,":").concat(this._uri),c=i.calculateMD5(C),M.debug('authenticate() | using qop=auth [a2:"%s"]',C),this._response=i.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth:").concat(c))):this._qop==="auth-int"?(C="".concat(this._method,":").concat(this._uri,":").concat(i.calculateMD5(v||"")),c=i.calculateMD5(C),M.debug('authenticate() | using qop=auth-int [a2:"%s"]',C),this._response=i.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth-int:").concat(c))):this._qop===null&&(C="".concat(this._method,":").concat(this._uri),c=i.calculateMD5(C),M.debug('authenticate() | using qop=null [a2:"%s"]',C),this._response=i.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(c))),M.debug("authenticate() | response generated"),!0}},{key:"toString",value:function(){var R=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return R.push("algorithm=".concat(this._algorithm)),R.push('username="'.concat(this._credentials.username,'"')),R.push('realm="'.concat(this._realm,'"')),R.push('nonce="'.concat(this._nonce,'"')),R.push('uri="'.concat(this._uri,'"')),R.push('response="'.concat(this._response,'"')),this._opaque&&R.push('opaque="'.concat(this._opaque,'"')),this._qop&&(R.push("qop=".concat(this._qop)),R.push('cnonce="'.concat(this._cnonce,'"')),R.push("nc=".concat(this._ncHex))),"Digest ".concat(R.join(", "))}}])&&L(t.prototype,I),Object.defineProperty(t,"prototype",{writable:!1}),q}()},{"./Logger":9,"./Utils":30}],6:[function(A,V,j){function L(c){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(c)}function N(c,p,m){return Object.defineProperty(c,"prototype",{writable:!1}),c}function i(c,p){if(!(c instanceof p))throw new TypeError("Cannot call a class as a function")}function M(c,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(p&&p.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),p&&s(c,p)}function q(c){var p=R();return function(){var m,S=_(c);if(p){var b=_(this).constructor;m=Reflect.construct(S,arguments,b)}else m=S.apply(this,arguments);return function(T,x){if(x&&(L(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Q){if(Q===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Q}(T)}(this,m)}}function t(c){var p=typeof Map=="function"?new Map:void 0;return(t=function(m){if(m===null||(S=m,Function.toString.call(S).indexOf("[native code]")===-1))return m;var S;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(p!==void 0){if(p.has(m))return p.get(m);p.set(m,b)}function b(){return I(m,arguments,_(this).constructor)}return b.prototype=Object.create(m.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),s(b,m)})(c)}function I(c,p,m){return(I=R()?Reflect.construct.bind():function(S,b,T){var x=[null];x.push.apply(x,b);var Q=new(Function.bind.apply(S,x));return T&&s(Q,T.prototype),Q}).apply(null,arguments)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function s(c,p){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,S){return m.__proto__=S,m})(c,p)}function _(c){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)})(c)}var a=function(c){M(m,t(Error));var p=q(m);function m(S,b){var T;return i(this,m),(T=p.call(this)).code=1,T.name="CONFIGURATION_ERROR",T.parameter=S,T.value=b,T.message=T.value?"Invalid value ".concat(JSON.stringify(T.value),' for parameter "').concat(T.parameter,'"'):"Missing parameter: ".concat(T.parameter),T}return N(m)}(),v=function(c){M(m,t(Error));var p=q(m);function m(S){var b;return i(this,m),(b=p.call(this)).code=2,b.name="INVALID_STATE_ERROR",b.status=S,b.message="Invalid status: ".concat(S),b}return N(m)}(),y=function(c){M(m,t(Error));var p=q(m);function m(S){var b;return i(this,m),(b=p.call(this)).code=3,b.name="NOT_SUPPORTED_ERROR",b.message=S,b}return N(m)}(),C=function(c){M(m,t(Error));var p=q(m);function m(S){var b;return i(this,m),(b=p.call(this)).code=4,b.name="NOT_READY_ERROR",b.message=S,b}return N(m)}();V.exports={ConfigurationError:a,InvalidStateError:v,NotSupportedError:y,NotReadyError:C}},{}],7:[function(A,V,j){V.exports=function(){function L(i){return'"'+i.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var N={parse:function(i,M){var q={CRLF:_,DIGIT:a,ALPHA:v,HEXDIG:y,WSP:C,OCTET:c,DQUOTE:p,SP:m,HTAB:S,alphanum:b,reserved:T,unreserved:x,mark:Q,escaped:G,LWS:d,SWS:f,HCOLON:E,TEXT_UTF8_TRIM:w,TEXT_UTF8char:D,UTF8_NONASCII:O,UTF8_CONT:F,LHEX:function(){var e;return(e=a())===null&&(/^[a-f]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[a-f]"))),e},token:B,token_nodot:$,separators:function(){var e;return i.charCodeAt(t)===40?(e="(",t++):(e=null,s('"("')),e===null&&(i.charCodeAt(t)===41?(e=")",t++):(e=null,s('")"')),e===null&&(i.charCodeAt(t)===60?(e="<",t++):(e=null,s('"<"')),e===null&&(i.charCodeAt(t)===62?(e=">",t++):(e=null,s('">"')),e===null&&(i.charCodeAt(t)===64?(e="@",t++):(e=null,s('"@"')),e===null&&(i.charCodeAt(t)===44?(e=",",t++):(e=null,s('","')),e===null&&(i.charCodeAt(t)===59?(e=";",t++):(e=null,s('";"')),e===null&&(i.charCodeAt(t)===58?(e=":",t++):(e=null,s('":"')),e===null&&(i.charCodeAt(t)===92?(e="\\",t++):(e=null,s('"\\\\"')),e===null&&(e=p())===null&&(i.charCodeAt(t)===47?(e="/",t++):(e=null,s('"/"')),e===null&&(i.charCodeAt(t)===91?(e="[",t++):(e=null,s('"["')),e===null&&(i.charCodeAt(t)===93?(e="]",t++):(e=null,s('"]"')),e===null&&(i.charCodeAt(t)===63?(e="?",t++):(e=null,s('"?"')),e===null&&(i.charCodeAt(t)===61?(e="=",t++):(e=null,s('"="')),e===null&&(i.charCodeAt(t)===123?(e="{",t++):(e=null,s('"{"')),e===null&&(i.charCodeAt(t)===125?(e="}",t++):(e=null,s('"}"')),e===null&&(e=m())===null&&(e=S())))))))))))))))),e},word:l,STAR:h,SLASH:k,EQUAL:P,LPAREN:W,RPAREN:K,RAQUOT:z,LAQUOT:ne,COMMA:Z,SEMI:X,COLON:ie,LDQUOT:ue,RDQUOT:de,comment:function e(){var n,r,o,u;if(u=t,n=W(),n!==null){for(r=[],(o=ye())===null&&(o=Se())===null&&(o=e());o!==null;)r.push(o),(o=ye())===null&&(o=Se())===null&&(o=e());r!==null&&(o=K())!==null?n=[n,r,o]:(n=null,t=u)}else n=null,t=u;return n},ctext:ye,quoted_string:Ee,quoted_string_clean:xe,qdtext:Oe,quoted_pair:Se,SIP_URI_noparams:Ue,SIP_URI:Ne,uri_scheme:tt,uri_scheme_sips:nt,uri_scheme_sip:He,userinfo:Ke,user:ce,user_unreserved:Fe,password:rt,hostport:vt,host:it,hostname:Lt,domainlabel:Ht,toplabel:vn,IPv6reference:Ft,IPv6address:jt,h16:re,ls32:Ce,IPv4address:st,dec_octet:ot,port:yn,uri_parameters:Tn,uri_parameter:Bt,transport_param:bn,user_param:Sn,method_param:Cn,ttl_param:En,maddr_param:An,lr_param:wn,other_param:Rn,pname:In,pvalue:On,paramchar:lt,param_unreserved:kn,headers:Nn,header:yt,hname:Dn,hvalue:Pn,hnv_unreserved:at,Request_Response:function(){var e;return(e=tr())===null&&(e=xn()),e},Request_Line:xn,Request_URI:Un,absoluteURI:Vt,hier_part:Mn,net_path:qn,abs_path:Tt,opaque_part:Ln,uric:ut,uric_no_slash:Hn,path_segments:Fn,segment:bt,param:Gt,pchar:ct,scheme:jn,authority:Bn,srvr:Vn,reg_name:Gn,query:Wn,SIP_Version:Wt,INVITEm:Yn,ACKm:$n,OPTIONSm:Kn,BYEm:zn,CANCELm:Xn,REGISTERm:Qn,SUBSCRIBEm:Jn,NOTIFYm:Zn,REFERm:er,Method:St,Status_Line:tr,Status_Code:nr,extension_code:rr,Reason_Phrase:ir,Allow_Events:function(){var e,n,r,o,u,g;if(u=t,(e=dt())!==null){for(n=[],g=t,(r=Z())!==null&&(o=dt())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=Z())!==null&&(o=dt())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},Call_ID:function(){var e,n,r,o,u,g;o=t,u=t,(e=l())!==null?(g=t,i.charCodeAt(t)===64?(n="@",t++):(n=null,s('"@"')),n!==null&&(r=l())!==null?n=[n,r]:(n=null,t=g),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=u)):(e=null,t=u),e!==null&&(U=o,e=void(H=i.substring(t,U)));var U;return e===null&&(t=o),e},Contact:function(){var e,n,r,o,u,g,U;if(u=t,(e=h())===null)if(g=t,(e=Ct())!==null){for(n=[],U=t,(r=Z())!==null&&(o=Ct())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=Z())!==null&&(o=Ct())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y){var te,se;for(se=H.multi_header.length,te=0;te<se;te++)if(H.multi_header[te].parsed===null){H=null;break}H=H!==null?H.multi_header:-1}()),e===null&&(t=u),e},contact_param:Ct,name_addr:je,display_name:Et,contact_params:Yt,c_p_q:sr,c_p_expires:or,delta_seconds:Be,qvalue:lr,generic_param:pe,gen_value:ar,Content_Disposition:function(){var e,n,r,o,u,g;if(u=t,(e=ur())!==null){for(n=[],g=t,(r=X())!==null&&(o=$t())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=X())!==null&&(o=$t())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},disp_type:ur,disp_param:$t,handling_param:cr,Content_Encoding:function(){var e,n,r,o,u,g;if(u=t,(e=B())!==null){for(n=[],g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},Content_Length:function(){var e,n,r;if(r=t,(n=a())!==null)for(e=[];n!==null;)e.push(n),n=a();else e=null;return e!==null&&(e=void(H=parseInt(e.join("")))),e===null&&(t=r),e},Content_Type:function(){var e,n;n=t,(e=dr())!==null&&(r=n,e=void(H=i.substring(t,r)));var r;return e===null&&(t=n),e},media_type:dr,m_type:fr,discrete_type:hr,composite_type:_r,extension_token:At,x_token:pr,m_subtype:mr,m_parameter:Kt,m_value:gr,CSeq:function(){var e,n,r,o;return o=t,(e=vr())!==null&&(n=d())!==null&&(r=St())!==null?e=[e,n,r]:(e=null,t=o),e},CSeq_value:vr,Expires:function(){var e,n;return n=t,(e=Be())!==null&&(e=void(H=e)),e===null&&(t=n),e},Event:function(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=dt())!==null){for(n=[],U=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;e!==null&&(Y=e[0],e=void(H.event=Y.join("").toLowerCase()));var Y;return e===null&&(t=u),e},event_type:dt,From:function(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=Ue())===null&&(e=je()),e!==null){for(n=[],U=t,(r=X())!==null&&(o=zt())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=X())!==null&&(o=zt())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y){var te=H.tag;try{H=new ze(H.uri,H.display_name,H.params),te&&H.setParam("tag",te)}catch{H=-1}}()),e===null&&(t=u),e},from_param:zt,tag_param:Xt,Max_Forwards:function(){var e,n,r;if(r=t,(n=a())!==null)for(e=[];n!==null;)e.push(n),n=a();else e=null;return e!==null&&(e=void(H=parseInt(e.join("")))),e===null&&(t=r),e},Min_Expires:function(){var e,n;return n=t,(e=Be())!==null&&(e=void(H=e)),e===null&&(t=n),e},Name_Addr_Header:function(){var e,n,r,o,u,g,U,Y,te,se;for(Y=t,te=t,e=[],n=Et();n!==null;)e.push(n),n=Et();if(e!==null)if((n=ne())!==null)if((r=Ne())!==null)if((o=z())!==null){for(u=[],se=t,(g=X())!==null&&(U=pe())!==null?g=[g,U]:(g=null,t=se);g!==null;)u.push(g),se=t,(g=X())!==null&&(U=pe())!==null?g=[g,U]:(g=null,t=se);u!==null?e=[e,n,r,o,u]:(e=null,t=te)}else e=null,t=te;else e=null,t=te;else e=null,t=te;else e=null,t=te;return e!==null&&(e=function(Te){try{H=new ze(H.uri,H.display_name,H.params)}catch{H=-1}}()),e===null&&(t=Y),e},Proxy_Authenticate:function(){return Qt()},challenge:Qt,other_challenge:yr,auth_param:ft,digest_cln:wt,realm:Tr,realm_value:br,domain:Sr,URI:Rt,nonce:Cr,nonce_value:Er,opaque:Ar,stale:wr,algorithm:Rr,qop_options:Ir,qop_value:It,Proxy_Require:function(){var e,n,r,o,u,g;if(u=t,(e=B())!==null){for(n=[],g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},Record_Route:function(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=Ot())!==null){for(n=[],U=t,(r=Z())!==null&&(o=Ot())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=Z())!==null&&(o=Ot())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y){var te,se;for(se=H.multi_header.length,te=0;te<se;te++)if(H.multi_header[te].parsed===null){H=null;break}H=H!==null?H.multi_header:-1}()),e===null&&(t=u),e},rec_route:Ot,Reason:function(){var e,n,r,o,u,g,U;if(u=t,g=t,i.substr(t,3).toLowerCase()==="sip"?(e=i.substr(t,3),t+=3):(e=null,s('"SIP"')),e===null&&(e=B()),e!==null){for(n=[],U=t,(r=X())!==null&&(o=Jt())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=X())!==null&&(o=Jt())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y,te){if(H.protocol=te.toLowerCase(),H.params||(H.params={}),H.params.text&&H.params.text[0]==='"'){var se=H.params.text;H.text=se.substring(1,se.length-1),delete H.params.text}}(0,e[0])),e===null&&(t=u),e},reason_param:Jt,reason_cause:Or,Require:function(){var e,n,r,o,u,g;if(u=t,(e=B())!==null){for(n=[],g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},Route:function(){var e,n,r,o,u,g;if(u=t,(e=kt())!==null){for(n=[],g=t,(r=Z())!==null&&(o=kt())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=Z())!==null&&(o=kt())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},route_param:kt,Subscription_State:function(){var e,n,r,o,u,g;if(u=t,(e=kr())!==null){for(n=[],g=t,(r=X())!==null&&(o=Zt())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=X())!==null&&(o=Zt())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},substate_value:kr,subexp_params:Zt,event_reason_value:Nr,Subject:function(){var e;return e=(e=w())!==null?e:""},Supported:function(){var e,n,r,o,u,g;if(u=t,(e=B())!==null){for(n=[],g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=Z())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e=e!==null?e:""},To:function(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=Ue())===null&&(e=je()),e!==null){for(n=[],U=t,(r=X())!==null&&(o=en())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=X())!==null&&(o=en())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y){var te=H.tag;try{H=new ze(H.uri,H.display_name,H.params),te&&H.setParam("tag",te)}catch{H=-1}}()),e===null&&(t=u),e},to_param:en,Via:function(){var e,n,r,o,u,g;if(u=t,(e=Nt())!==null){for(n=[],g=t,(r=Z())!==null&&(o=Nt())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=Z())!==null&&(o=Nt())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},via_param:Nt,via_params:tn,via_ttl:Dr,via_maddr:Pr,via_received:xr,via_branch:Ur,response_port:Mr,rport:qr,sent_protocol:Lr,protocol_name:Hr,transport:Fr,sent_by:jr,via_host:Br,via_port:Vr,ttl:nn,WWW_Authenticate:function(){return Qt()},Session_Expires:function(){var e,n,r,o,u,g;if(u=t,(e=Gr())!==null){for(n=[],g=t,(r=X())!==null&&(o=rn())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=X())!==null&&(o=rn())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},s_e_expires:Gr,s_e_params:rn,s_e_refresher:Wr,extension_header:function(){var e,n,r,o;return o=t,(e=B())!==null&&(n=E())!==null&&(r=Yr())!==null?e=[e,n,r]:(e=null,t=o),e},header_value:Yr,message_body:function(){var e,n;for(e=[],n=c();n!==null;)e.push(n),n=c();return e},uuid_URI:function(){var e,n,r;return r=t,i.substr(t,5)==="uuid:"?(e="uuid:",t+=5):(e=null,s('"uuid:"')),e!==null&&(n=$r())!==null?e=[e,n]:(e=null,t=r),e},uuid:$r,hex4:De,hex8:Kr,hex12:zr,Refer_To:function(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=Ue())===null&&(e=je()),e!==null){for(n=[],U=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y){try{H=new ze(H.uri,H.display_name,H.params)}catch{H=-1}}()),e===null&&(t=u),e},Replaces:function(){var e,n,r,o,u,g;if(u=t,(e=Xr())!==null){for(n=[],g=t,(r=X())!==null&&(o=sn())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=X())!==null&&(o=sn())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e},call_id:Xr,replaces_param:sn,to_tag:Qr,from_tag:Jr,early_flag:Zr};if(M!==void 0){if(q[M]===void 0)throw new Error("Invalid rule name: "+L(M)+".")}else M="CRLF";var t=0,I=0,R=[];function s(e){t<I||(t>I&&(I=t,R=[]),R.push(e))}function _(){var e;return i.substr(t,2)===`\r
`?(e=`\r
`,t+=2):(e=null,s('"\\r\\n"')),e}function a(){var e;return/^[0-9]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[0-9]")),e}function v(){var e;return/^[a-zA-Z]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[a-zA-Z]")),e}function y(){var e;return/^[0-9a-fA-F]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[0-9a-fA-F]")),e}function C(){var e;return(e=m())===null&&(e=S()),e}function c(){var e;return/^[\0-\xFF]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[\\0-\\xFF]")),e}function p(){var e;return/^["]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s('["]')),e}function m(){var e;return i.charCodeAt(t)===32?(e=" ",t++):(e=null,s('" "')),e}function S(){var e;return i.charCodeAt(t)===9?(e="	",t++):(e=null,s('"\\t"')),e}function b(){var e;return/^[a-zA-Z0-9]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[a-zA-Z0-9]")),e}function T(){var e;return i.charCodeAt(t)===59?(e=";",t++):(e=null,s('";"')),e===null&&(i.charCodeAt(t)===47?(e="/",t++):(e=null,s('"/"')),e===null&&(i.charCodeAt(t)===63?(e="?",t++):(e=null,s('"?"')),e===null&&(i.charCodeAt(t)===58?(e=":",t++):(e=null,s('":"')),e===null&&(i.charCodeAt(t)===64?(e="@",t++):(e=null,s('"@"')),e===null&&(i.charCodeAt(t)===38?(e="&",t++):(e=null,s('"&"')),e===null&&(i.charCodeAt(t)===61?(e="=",t++):(e=null,s('"="')),e===null&&(i.charCodeAt(t)===43?(e="+",t++):(e=null,s('"+"')),e===null&&(i.charCodeAt(t)===36?(e="$",t++):(e=null,s('"$"')),e===null&&(i.charCodeAt(t)===44?(e=",",t++):(e=null,s('","'))))))))))),e}function x(){var e;return(e=b())===null&&(e=Q()),e}function Q(){var e;return i.charCodeAt(t)===45?(e="-",t++):(e=null,s('"-"')),e===null&&(i.charCodeAt(t)===95?(e="_",t++):(e=null,s('"_"')),e===null&&(i.charCodeAt(t)===46?(e=".",t++):(e=null,s('"."')),e===null&&(i.charCodeAt(t)===33?(e="!",t++):(e=null,s('"!"')),e===null&&(i.charCodeAt(t)===126?(e="~",t++):(e=null,s('"~"')),e===null&&(i.charCodeAt(t)===42?(e="*",t++):(e=null,s('"*"')),e===null&&(i.charCodeAt(t)===39?(e="'",t++):(e=null,s(`"'"`)),e===null&&(i.charCodeAt(t)===40?(e="(",t++):(e=null,s('"("')),e===null&&(i.charCodeAt(t)===41?(e=")",t++):(e=null,s('")"')))))))))),e}function G(){var e,n,r,o,u;return o=t,u=t,i.charCodeAt(t)===37?(e="%",t++):(e=null,s('"%"')),e!==null&&(n=y())!==null&&(r=y())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(e=e.join("")),e===null&&(t=o),e}function d(){var e,n,r,o,u,g;for(o=t,u=t,g=t,e=[],n=C();n!==null;)e.push(n),n=C();if(e!==null&&(n=_())!==null?e=[e,n]:(e=null,t=g),(e=e!==null?e:"")!==null){if((r=C())!==null)for(n=[];r!==null;)n.push(r),r=C();else n=null;n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e!==null&&(e=" "),e===null&&(t=o),e}function f(){var e;return e=(e=d())!==null?e:""}function E(){var e,n,r,o,u;for(o=t,u=t,e=[],(n=m())===null&&(n=S());n!==null;)e.push(n),(n=m())===null&&(n=S());return e!==null?(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e=":"),e===null&&(t=o),e}function w(){var e,n,r,o,u,g,U,Y;if(u=t,g=t,(n=D())!==null)for(e=[];n!==null;)e.push(n),n=D();else e=null;if(e!==null){for(n=[],U=t,r=[],o=d();o!==null;)r.push(o),o=d();for(r!==null&&(o=D())!==null?r=[r,o]:(r=null,t=U);r!==null;){for(n.push(r),U=t,r=[],o=d();o!==null;)r.push(o),o=d();r!==null&&(o=D())!==null?r=[r,o]:(r=null,t=U)}n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(Y=u,e=i.substring(t,Y)),e===null&&(t=u),e}function D(){var e;return/^[!-~]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[!-~]")),e===null&&(e=O()),e}function O(){var e;return/^[\x80-\uFFFF]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[\\x80-\\uFFFF]")),e}function F(){var e;return/^[\x80-\xBF]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[\\x80-\\xBF]")),e}function B(){var e,n,r,o;if(r=t,(n=b())===null&&(i.charCodeAt(t)===45?(n="-",t++):(n=null,s('"-"')),n===null&&(i.charCodeAt(t)===46?(n=".",t++):(n=null,s('"."')),n===null&&(i.charCodeAt(t)===33?(n="!",t++):(n=null,s('"!"')),n===null&&(i.charCodeAt(t)===37?(n="%",t++):(n=null,s('"%"')),n===null&&(i.charCodeAt(t)===42?(n="*",t++):(n=null,s('"*"')),n===null&&(i.charCodeAt(t)===95?(n="_",t++):(n=null,s('"_"')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===96?(n="`",t++):(n=null,s('"`"')),n===null&&(i.charCodeAt(t)===39?(n="'",t++):(n=null,s(`"'"`)),n===null&&(i.charCodeAt(t)===126?(n="~",t++):(n=null,s('"~"')))))))))))),n!==null)for(e=[];n!==null;)e.push(n),(n=b())===null&&(i.charCodeAt(t)===45?(n="-",t++):(n=null,s('"-"')),n===null&&(i.charCodeAt(t)===46?(n=".",t++):(n=null,s('"."')),n===null&&(i.charCodeAt(t)===33?(n="!",t++):(n=null,s('"!"')),n===null&&(i.charCodeAt(t)===37?(n="%",t++):(n=null,s('"%"')),n===null&&(i.charCodeAt(t)===42?(n="*",t++):(n=null,s('"*"')),n===null&&(i.charCodeAt(t)===95?(n="_",t++):(n=null,s('"_"')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===96?(n="`",t++):(n=null,s('"`"')),n===null&&(i.charCodeAt(t)===39?(n="'",t++):(n=null,s(`"'"`)),n===null&&(i.charCodeAt(t)===126?(n="~",t++):(n=null,s('"~"'))))))))))));else e=null;return e!==null&&(o=r,e=i.substring(t,o)),e===null&&(t=r),e}function $(){var e,n,r,o;if(r=t,(n=b())===null&&(i.charCodeAt(t)===45?(n="-",t++):(n=null,s('"-"')),n===null&&(i.charCodeAt(t)===33?(n="!",t++):(n=null,s('"!"')),n===null&&(i.charCodeAt(t)===37?(n="%",t++):(n=null,s('"%"')),n===null&&(i.charCodeAt(t)===42?(n="*",t++):(n=null,s('"*"')),n===null&&(i.charCodeAt(t)===95?(n="_",t++):(n=null,s('"_"')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===96?(n="`",t++):(n=null,s('"`"')),n===null&&(i.charCodeAt(t)===39?(n="'",t++):(n=null,s(`"'"`)),n===null&&(i.charCodeAt(t)===126?(n="~",t++):(n=null,s('"~"'))))))))))),n!==null)for(e=[];n!==null;)e.push(n),(n=b())===null&&(i.charCodeAt(t)===45?(n="-",t++):(n=null,s('"-"')),n===null&&(i.charCodeAt(t)===33?(n="!",t++):(n=null,s('"!"')),n===null&&(i.charCodeAt(t)===37?(n="%",t++):(n=null,s('"%"')),n===null&&(i.charCodeAt(t)===42?(n="*",t++):(n=null,s('"*"')),n===null&&(i.charCodeAt(t)===95?(n="_",t++):(n=null,s('"_"')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===96?(n="`",t++):(n=null,s('"`"')),n===null&&(i.charCodeAt(t)===39?(n="'",t++):(n=null,s(`"'"`)),n===null&&(i.charCodeAt(t)===126?(n="~",t++):(n=null,s('"~"')))))))))));else e=null;return e!==null&&(o=r,e=i.substring(t,o)),e===null&&(t=r),e}function l(){var e,n,r,o;if(r=t,(n=b())===null&&(i.charCodeAt(t)===45?(n="-",t++):(n=null,s('"-"')),n===null&&(i.charCodeAt(t)===46?(n=".",t++):(n=null,s('"."')),n===null&&(i.charCodeAt(t)===33?(n="!",t++):(n=null,s('"!"')),n===null&&(i.charCodeAt(t)===37?(n="%",t++):(n=null,s('"%"')),n===null&&(i.charCodeAt(t)===42?(n="*",t++):(n=null,s('"*"')),n===null&&(i.charCodeAt(t)===95?(n="_",t++):(n=null,s('"_"')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===96?(n="`",t++):(n=null,s('"`"')),n===null&&(i.charCodeAt(t)===39?(n="'",t++):(n=null,s(`"'"`)),n===null&&(i.charCodeAt(t)===126?(n="~",t++):(n=null,s('"~"')),n===null&&(i.charCodeAt(t)===40?(n="(",t++):(n=null,s('"("')),n===null&&(i.charCodeAt(t)===41?(n=")",t++):(n=null,s('")"')),n===null&&(i.charCodeAt(t)===60?(n="<",t++):(n=null,s('"<"')),n===null&&(i.charCodeAt(t)===62?(n=">",t++):(n=null,s('">"')),n===null&&(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n===null&&(i.charCodeAt(t)===92?(n="\\",t++):(n=null,s('"\\\\"')),n===null&&(n=p())===null&&(i.charCodeAt(t)===47?(n="/",t++):(n=null,s('"/"')),n===null&&(i.charCodeAt(t)===91?(n="[",t++):(n=null,s('"["')),n===null&&(i.charCodeAt(t)===93?(n="]",t++):(n=null,s('"]"')),n===null&&(i.charCodeAt(t)===63?(n="?",t++):(n=null,s('"?"')),n===null&&(i.charCodeAt(t)===123?(n="{",t++):(n=null,s('"{"')),n===null&&(i.charCodeAt(t)===125?(n="}",t++):(n=null,s('"}"')))))))))))))))))))))))),n!==null)for(e=[];n!==null;)e.push(n),(n=b())===null&&(i.charCodeAt(t)===45?(n="-",t++):(n=null,s('"-"')),n===null&&(i.charCodeAt(t)===46?(n=".",t++):(n=null,s('"."')),n===null&&(i.charCodeAt(t)===33?(n="!",t++):(n=null,s('"!"')),n===null&&(i.charCodeAt(t)===37?(n="%",t++):(n=null,s('"%"')),n===null&&(i.charCodeAt(t)===42?(n="*",t++):(n=null,s('"*"')),n===null&&(i.charCodeAt(t)===95?(n="_",t++):(n=null,s('"_"')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===96?(n="`",t++):(n=null,s('"`"')),n===null&&(i.charCodeAt(t)===39?(n="'",t++):(n=null,s(`"'"`)),n===null&&(i.charCodeAt(t)===126?(n="~",t++):(n=null,s('"~"')),n===null&&(i.charCodeAt(t)===40?(n="(",t++):(n=null,s('"("')),n===null&&(i.charCodeAt(t)===41?(n=")",t++):(n=null,s('")"')),n===null&&(i.charCodeAt(t)===60?(n="<",t++):(n=null,s('"<"')),n===null&&(i.charCodeAt(t)===62?(n=">",t++):(n=null,s('">"')),n===null&&(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n===null&&(i.charCodeAt(t)===92?(n="\\",t++):(n=null,s('"\\\\"')),n===null&&(n=p())===null&&(i.charCodeAt(t)===47?(n="/",t++):(n=null,s('"/"')),n===null&&(i.charCodeAt(t)===91?(n="[",t++):(n=null,s('"["')),n===null&&(i.charCodeAt(t)===93?(n="]",t++):(n=null,s('"]"')),n===null&&(i.charCodeAt(t)===63?(n="?",t++):(n=null,s('"?"')),n===null&&(i.charCodeAt(t)===123?(n="{",t++):(n=null,s('"{"')),n===null&&(i.charCodeAt(t)===125?(n="}",t++):(n=null,s('"}"'))))))))))))))))))))))));else e=null;return e!==null&&(o=r,e=i.substring(t,o)),e===null&&(t=r),e}function h(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===42?(n="*",t++):(n=null,s('"*"')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e="*"),e===null&&(t=o),e}function k(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===47?(n="/",t++):(n=null,s('"/"')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e="/"),e===null&&(t=o),e}function P(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e="="),e===null&&(t=o),e}function W(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===40?(n="(",t++):(n=null,s('"("')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e="("),e===null&&(t=o),e}function K(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===41?(n=")",t++):(n=null,s('")"')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e=")"),e===null&&(t=o),e}function z(){var e,n,r,o;return r=t,o=t,i.charCodeAt(t)===62?(e=">",t++):(e=null,s('">"')),e!==null&&(n=f())!==null?e=[e,n]:(e=null,t=o),e!==null&&(e=">"),e===null&&(t=r),e}function ne(){var e,n,r,o;return r=t,o=t,(e=f())!==null?(i.charCodeAt(t)===60?(n="<",t++):(n=null,s('"<"')),n!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e!==null&&(e="<"),e===null&&(t=r),e}function Z(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===44?(n=",",t++):(n=null,s('","')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e=","),e===null&&(t=o),e}function X(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===59?(n=";",t++):(n=null,s('";"')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e=";"),e===null&&(t=o),e}function ie(){var e,n,r,o,u;return o=t,u=t,(e=f())!==null?(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=f())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(e=":"),e===null&&(t=o),e}function ue(){var e,n,r,o;return r=t,o=t,(e=f())!==null&&(n=p())!==null?e=[e,n]:(e=null,t=o),e!==null&&(e='"'),e===null&&(t=r),e}function de(){var e,n,r,o;return r=t,o=t,(e=p())!==null&&(n=f())!==null?e=[e,n]:(e=null,t=o),e!==null&&(e='"'),e===null&&(t=r),e}function ye(){var e;return/^[!-']/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[!-']")),e===null&&(/^[*-[]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[*-[]")),e===null&&(/^[\]-~]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[\\]-~]")),e===null&&(e=O())===null&&(e=d()))),e}function Ee(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=f())!==null)if((n=p())!==null){for(r=[],(o=Oe())===null&&(o=Se());o!==null;)r.push(o),(o=Oe())===null&&(o=Se());r!==null&&(o=p())!==null?e=[e,n,r,o]:(e=null,t=g)}else e=null,t=g;else e=null,t=g;return e!==null&&(U=u,e=i.substring(t,U)),e===null&&(t=u),e}function xe(){var e,n,r,o,u,g,U,Y;if(u=t,g=t,(e=f())!==null)if((n=p())!==null){for(r=[],(o=Oe())===null&&(o=Se());o!==null;)r.push(o),(o=Oe())===null&&(o=Se());r!==null&&(o=p())!==null?e=[e,n,r,o]:(e=null,t=g)}else e=null,t=g;else e=null,t=g;return e!==null&&(U=u,e=(Y=i.substring(t,U).trim()).substring(1,Y.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1")),e===null&&(t=u),e}function Oe(){var e;return(e=d())===null&&(i.charCodeAt(t)===33?(e="!",t++):(e=null,s('"!"')),e===null&&(/^[#-[]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[#-[]")),e===null&&(/^[\]-~]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[\\]-~]")),e===null&&(e=O())))),e}function Se(){var e,n,r;return r=t,i.charCodeAt(t)===92?(e="\\",t++):(e=null,s('"\\\\"')),e!==null?(/^[\0-\t]/.test(i.charAt(t))?(n=i.charAt(t),t++):(n=null,s("[\\0-\\t]")),n===null&&(/^[\x0B-\f]/.test(i.charAt(t))?(n=i.charAt(t),t++):(n=null,s("[\\x0B-\\f]")),n===null&&(/^[\x0E-]/.test(i.charAt(t))?(n=i.charAt(t),t++):(n=null,s("[\\x0E-]")))),n!==null?e=[e,n]:(e=null,t=r)):(e=null,t=r),e}function Ue(){var e,n,r,o,u,g;return u=t,g=t,(e=tt())!==null?(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=(r=Ke())!==null?r:"")!==null&&(o=vt())!==null?e=[e,n,r,o]:(e=null,t=g)):(e=null,t=g),e!==null&&(e=function(U){try{H.uri=new ei(H.scheme,H.user,H.host,H.port),delete H.scheme,delete H.user,delete H.host,delete H.host_type,delete H.port}catch{H=-1}}()),e===null&&(t=u),e}function Ne(){var e,n,r,o,u,g,U,Y;return U=t,Y=t,(e=tt())!==null?(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=(r=Ke())!==null?r:"")!==null&&(o=vt())!==null&&(u=Tn())!==null&&(g=(g=Nn())!==null?g:"")!==null?e=[e,n,r,o,u,g]:(e=null,t=Y)):(e=null,t=Y),e!==null&&(e=function(te){try{H.uri=new ei(H.scheme,H.user,H.host,H.port,H.uri_params,H.uri_headers),delete H.scheme,delete H.user,delete H.host,delete H.host_type,delete H.port,delete H.uri_params,M==="SIP_URI"&&(H=H.uri)}catch{H=-1}}()),e===null&&(t=U),e}function tt(){var e;return(e=nt())===null&&(e=He()),e}function nt(){var e,n,r;return n=t,i.substr(t,4).toLowerCase()==="sips"?(e=i.substr(t,4),t+=4):(e=null,s('"sips"')),e!==null&&(r=e,e=void(H.scheme=r.toLowerCase())),e===null&&(t=n),e}function He(){var e,n,r;return n=t,i.substr(t,3).toLowerCase()==="sip"?(e=i.substr(t,3),t+=3):(e=null,s('"sip"')),e!==null&&(r=e,e=void(H.scheme=r.toLowerCase())),e===null&&(t=n),e}function Ke(){var e,n,r,o,u,g,U;return o=t,u=t,(e=ce())!==null?(g=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=rt())!==null?n=[n,r]:(n=null,t=g),(n=n!==null?n:"")!==null?(i.charCodeAt(t)===64?(r="@",t++):(r=null,s('"@"')),r!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u)):(e=null,t=u),e!==null&&(U=o,e=void(H.user=decodeURIComponent(i.substring(t-1,U)))),e===null&&(t=o),e}function ce(){var e,n;if((n=x())===null&&(n=G())===null&&(n=Fe()),n!==null)for(e=[];n!==null;)e.push(n),(n=x())===null&&(n=G())===null&&(n=Fe());else e=null;return e}function Fe(){var e;return i.charCodeAt(t)===38?(e="&",t++):(e=null,s('"&"')),e===null&&(i.charCodeAt(t)===61?(e="=",t++):(e=null,s('"="')),e===null&&(i.charCodeAt(t)===43?(e="+",t++):(e=null,s('"+"')),e===null&&(i.charCodeAt(t)===36?(e="$",t++):(e=null,s('"$"')),e===null&&(i.charCodeAt(t)===44?(e=",",t++):(e=null,s('","')),e===null&&(i.charCodeAt(t)===59?(e=";",t++):(e=null,s('";"')),e===null&&(i.charCodeAt(t)===63?(e="?",t++):(e=null,s('"?"')),e===null&&(i.charCodeAt(t)===47?(e="/",t++):(e=null,s('"/"'))))))))),e}function rt(){var e,n,r,o;for(r=t,e=[],(n=x())===null&&(n=G())===null&&(i.charCodeAt(t)===38?(n="&",t++):(n=null,s('"&"')),n===null&&(i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===36?(n="$",t++):(n=null,s('"$"')),n===null&&(i.charCodeAt(t)===44?(n=",",t++):(n=null,s('","')))))));n!==null;)e.push(n),(n=x())===null&&(n=G())===null&&(i.charCodeAt(t)===38?(n="&",t++):(n=null,s('"&"')),n===null&&(i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')),n===null&&(i.charCodeAt(t)===36?(n="$",t++):(n=null,s('"$"')),n===null&&(i.charCodeAt(t)===44?(n=",",t++):(n=null,s('","')))))));return e!==null&&(o=r,e=void(H.password=i.substring(t,o))),e===null&&(t=r),e}function vt(){var e,n,r,o,u;return o=t,(e=it())!==null?(u=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=yn())!==null?n=[n,r]:(n=null,t=u),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e}function it(){var e,n,r;return n=t,(e=Lt())===null&&(e=st())===null&&(e=Ft()),e!==null&&(r=n,H.host=i.substring(t,r).toLowerCase(),e=H.host),e===null&&(t=n),e}function Lt(){var e,n,r,o,u,g,U;for(o=t,u=t,e=[],g=t,(n=Ht())!==null?(i.charCodeAt(t)===46?(r=".",t++):(r=null,s('"."')),r!==null?n=[n,r]:(n=null,t=g)):(n=null,t=g);n!==null;)e.push(n),g=t,(n=Ht())!==null?(i.charCodeAt(t)===46?(r=".",t++):(r=null,s('"."')),r!==null?n=[n,r]:(n=null,t=g)):(n=null,t=g);return e!==null&&(n=vn())!==null?(i.charCodeAt(t)===46?(r=".",t++):(r=null,s('"."')),(r=r!==null?r:"")!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(U=o,H.host_type="domain",e=i.substring(t,U)),e===null&&(t=o),e}function Ht(){var e,n,r,o;if(o=t,(e=b())!==null){for(n=[],(r=b())===null&&(i.charCodeAt(t)===45?(r="-",t++):(r=null,s('"-"')),r===null&&(i.charCodeAt(t)===95?(r="_",t++):(r=null,s('"_"'))));r!==null;)n.push(r),(r=b())===null&&(i.charCodeAt(t)===45?(r="-",t++):(r=null,s('"-"')),r===null&&(i.charCodeAt(t)===95?(r="_",t++):(r=null,s('"_"'))));n!==null?e=[e,n]:(e=null,t=o)}else e=null,t=o;return e}function vn(){var e,n,r,o;if(o=t,(e=v())!==null){for(n=[],(r=b())===null&&(i.charCodeAt(t)===45?(r="-",t++):(r=null,s('"-"')),r===null&&(i.charCodeAt(t)===95?(r="_",t++):(r=null,s('"_"'))));r!==null;)n.push(r),(r=b())===null&&(i.charCodeAt(t)===45?(r="-",t++):(r=null,s('"-"')),r===null&&(i.charCodeAt(t)===95?(r="_",t++):(r=null,s('"_"'))));n!==null?e=[e,n]:(e=null,t=o)}else e=null,t=o;return e}function Ft(){var e,n,r,o,u,g;return o=t,u=t,i.charCodeAt(t)===91?(e="[",t++):(e=null,s('"["')),e!==null&&(n=jt())!==null?(i.charCodeAt(t)===93?(r="]",t++):(r=null,s('"]"')),r!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(g=o,H.host_type="IPv6",e=i.substring(t,g)),e===null&&(t=o),e}function jt(){var e,n,r,o,u,g,U,Y,te,se,Te,ke,ni,ln,ee,oe,ri;return ln=t,ee=t,(e=re())!==null?(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?(i.charCodeAt(t)===58?(o=":",t++):(o=null,s('":"')),o!==null&&(u=re())!==null?(i.charCodeAt(t)===58?(g=":",t++):(g=null,s('":"')),g!==null&&(U=re())!==null?(i.charCodeAt(t)===58?(Y=":",t++):(Y=null,s('":"')),Y!==null&&(te=re())!==null?(i.charCodeAt(t)===58?(se=":",t++):(se=null,s('":"')),se!==null&&(Te=re())!==null?(i.charCodeAt(t)===58?(ke=":",t++):(ke=null,s('":"')),ke!==null&&(ni=Ce())!==null?e=[e,n,r,o,u,g,U,Y,te,se,Te,ke,ni]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,i.substr(t,2)==="::"?(e="::",t+=2):(e=null,s('"::"')),e!==null&&(n=re())!==null?(i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?(i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=re())!==null?(i.charCodeAt(t)===58?(U=":",t++):(U=null,s('":"')),U!==null&&(Y=re())!==null?(i.charCodeAt(t)===58?(te=":",t++):(te=null,s('":"')),te!==null&&(se=re())!==null?(i.charCodeAt(t)===58?(Te=":",t++):(Te=null,s('":"')),Te!==null&&(ke=Ce())!==null?e=[e,n,r,o,u,g,U,Y,te,se,Te,ke]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,i.substr(t,2)==="::"?(e="::",t+=2):(e=null,s('"::"')),e!==null&&(n=re())!==null?(i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?(i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=re())!==null?(i.charCodeAt(t)===58?(U=":",t++):(U=null,s('":"')),U!==null&&(Y=re())!==null?(i.charCodeAt(t)===58?(te=":",t++):(te=null,s('":"')),te!==null&&(se=Ce())!==null?e=[e,n,r,o,u,g,U,Y,te,se]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,i.substr(t,2)==="::"?(e="::",t+=2):(e=null,s('"::"')),e!==null&&(n=re())!==null?(i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?(i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=re())!==null?(i.charCodeAt(t)===58?(U=":",t++):(U=null,s('":"')),U!==null&&(Y=Ce())!==null?e=[e,n,r,o,u,g,U,Y]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,i.substr(t,2)==="::"?(e="::",t+=2):(e=null,s('"::"')),e!==null&&(n=re())!==null?(i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?(i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=Ce())!==null?e=[e,n,r,o,u,g]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,i.substr(t,2)==="::"?(e="::",t+=2):(e=null,s('"::"')),e!==null&&(n=re())!==null?(i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=Ce())!==null?e=[e,n,r,o]:(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,i.substr(t,2)==="::"?(e="::",t+=2):(e=null,s('"::"')),e!==null&&(n=Ce())!==null?e=[e,n]:(e=null,t=ee),e===null&&(ee=t,i.substr(t,2)==="::"?(e="::",t+=2):(e=null,s('"::"')),e!==null&&(n=re())!==null?e=[e,n]:(e=null,t=ee),e===null&&(ee=t,(e=re())!==null?(i.substr(t,2)==="::"?(n="::",t+=2):(n=null,s('"::"')),n!==null&&(r=re())!==null?(i.charCodeAt(t)===58?(o=":",t++):(o=null,s('":"')),o!==null&&(u=re())!==null?(i.charCodeAt(t)===58?(g=":",t++):(g=null,s('":"')),g!==null&&(U=re())!==null?(i.charCodeAt(t)===58?(Y=":",t++):(Y=null,s('":"')),Y!==null&&(te=re())!==null?(i.charCodeAt(t)===58?(se=":",t++):(se=null,s('":"')),se!==null&&(Te=Ce())!==null?e=[e,n,r,o,u,g,U,Y,te,se,Te]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,(e=re())!==null?(oe=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?n=[n,r]:(n=null,t=oe),(n=n!==null?n:"")!==null?(i.substr(t,2)==="::"?(r="::",t+=2):(r=null,s('"::"')),r!==null&&(o=re())!==null?(i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=re())!==null?(i.charCodeAt(t)===58?(U=":",t++):(U=null,s('":"')),U!==null&&(Y=re())!==null?(i.charCodeAt(t)===58?(te=":",t++):(te=null,s('":"')),te!==null&&(se=Ce())!==null?e=[e,n,r,o,u,g,U,Y,te,se]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,(e=re())!==null?(oe=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?n=[n,r]:(n=null,t=oe),(n=n!==null?n:"")!==null?(oe=t,i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?r=[r,o]:(r=null,t=oe),(r=r!==null?r:"")!==null?(i.substr(t,2)==="::"?(o="::",t+=2):(o=null,s('"::"')),o!==null&&(u=re())!==null?(i.charCodeAt(t)===58?(g=":",t++):(g=null,s('":"')),g!==null&&(U=re())!==null?(i.charCodeAt(t)===58?(Y=":",t++):(Y=null,s('":"')),Y!==null&&(te=Ce())!==null?e=[e,n,r,o,u,g,U,Y,te]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,(e=re())!==null?(oe=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?n=[n,r]:(n=null,t=oe),(n=n!==null?n:"")!==null?(oe=t,i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?r=[r,o]:(r=null,t=oe),(r=r!==null?r:"")!==null?(oe=t,i.charCodeAt(t)===58?(o=":",t++):(o=null,s('":"')),o!==null&&(u=re())!==null?o=[o,u]:(o=null,t=oe),(o=o!==null?o:"")!==null?(i.substr(t,2)==="::"?(u="::",t+=2):(u=null,s('"::"')),u!==null&&(g=re())!==null?(i.charCodeAt(t)===58?(U=":",t++):(U=null,s('":"')),U!==null&&(Y=Ce())!==null?e=[e,n,r,o,u,g,U,Y]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,(e=re())!==null?(oe=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?n=[n,r]:(n=null,t=oe),(n=n!==null?n:"")!==null?(oe=t,i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?r=[r,o]:(r=null,t=oe),(r=r!==null?r:"")!==null?(oe=t,i.charCodeAt(t)===58?(o=":",t++):(o=null,s('":"')),o!==null&&(u=re())!==null?o=[o,u]:(o=null,t=oe),(o=o!==null?o:"")!==null?(oe=t,i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=re())!==null?u=[u,g]:(u=null,t=oe),(u=u!==null?u:"")!==null?(i.substr(t,2)==="::"?(g="::",t+=2):(g=null,s('"::"')),g!==null&&(U=Ce())!==null?e=[e,n,r,o,u,g,U]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,(e=re())!==null?(oe=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?n=[n,r]:(n=null,t=oe),(n=n!==null?n:"")!==null?(oe=t,i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?r=[r,o]:(r=null,t=oe),(r=r!==null?r:"")!==null?(oe=t,i.charCodeAt(t)===58?(o=":",t++):(o=null,s('":"')),o!==null&&(u=re())!==null?o=[o,u]:(o=null,t=oe),(o=o!==null?o:"")!==null?(oe=t,i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=re())!==null?u=[u,g]:(u=null,t=oe),(u=u!==null?u:"")!==null?(oe=t,i.charCodeAt(t)===58?(g=":",t++):(g=null,s('":"')),g!==null&&(U=re())!==null?g=[g,U]:(g=null,t=oe),(g=g!==null?g:"")!==null?(i.substr(t,2)==="::"?(U="::",t+=2):(U=null,s('"::"')),U!==null&&(Y=re())!==null?e=[e,n,r,o,u,g,U,Y]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee),e===null&&(ee=t,(e=re())!==null?(oe=t,i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?n=[n,r]:(n=null,t=oe),(n=n!==null?n:"")!==null?(oe=t,i.charCodeAt(t)===58?(r=":",t++):(r=null,s('":"')),r!==null&&(o=re())!==null?r=[r,o]:(r=null,t=oe),(r=r!==null?r:"")!==null?(oe=t,i.charCodeAt(t)===58?(o=":",t++):(o=null,s('":"')),o!==null&&(u=re())!==null?o=[o,u]:(o=null,t=oe),(o=o!==null?o:"")!==null?(oe=t,i.charCodeAt(t)===58?(u=":",t++):(u=null,s('":"')),u!==null&&(g=re())!==null?u=[u,g]:(u=null,t=oe),(u=u!==null?u:"")!==null?(oe=t,i.charCodeAt(t)===58?(g=":",t++):(g=null,s('":"')),g!==null&&(U=re())!==null?g=[g,U]:(g=null,t=oe),(g=g!==null?g:"")!==null?(oe=t,i.charCodeAt(t)===58?(U=":",t++):(U=null,s('":"')),U!==null&&(Y=re())!==null?U=[U,Y]:(U=null,t=oe),(U=U!==null?U:"")!==null?(i.substr(t,2)==="::"?(Y="::",t+=2):(Y=null,s('"::"')),Y!==null?e=[e,n,r,o,u,g,U,Y]:(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee)):(e=null,t=ee))))))))))))))),e!==null&&(ri=ln,H.host_type="IPv6",e=i.substring(t,ri)),e===null&&(t=ln),e}function re(){var e,n,r,o,u;return u=t,(e=y())!==null&&(n=(n=y())!==null?n:"")!==null&&(r=(r=y())!==null?r:"")!==null&&(o=(o=y())!==null?o:"")!==null?e=[e,n,r,o]:(e=null,t=u),e}function Ce(){var e,n,r,o;return o=t,(e=re())!==null?(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null&&(r=re())!==null?e=[e,n,r]:(e=null,t=o)):(e=null,t=o),e===null&&(e=st()),e}function st(){var e,n,r,o,u,g,U,Y,te,se;return Y=t,te=t,(e=ot())!==null?(i.charCodeAt(t)===46?(n=".",t++):(n=null,s('"."')),n!==null&&(r=ot())!==null?(i.charCodeAt(t)===46?(o=".",t++):(o=null,s('"."')),o!==null&&(u=ot())!==null?(i.charCodeAt(t)===46?(g=".",t++):(g=null,s('"."')),g!==null&&(U=ot())!==null?e=[e,n,r,o,u,g,U]:(e=null,t=te)):(e=null,t=te)):(e=null,t=te)):(e=null,t=te),e!==null&&(se=Y,H.host_type="IPv4",e=i.substring(t,se)),e===null&&(t=Y),e}function ot(){var e,n,r,o;return o=t,i.substr(t,2)==="25"?(e="25",t+=2):(e=null,s('"25"')),e!==null?(/^[0-5]/.test(i.charAt(t))?(n=i.charAt(t),t++):(n=null,s("[0-5]")),n!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e===null&&(o=t,i.charCodeAt(t)===50?(e="2",t++):(e=null,s('"2"')),e!==null?(/^[0-4]/.test(i.charAt(t))?(n=i.charAt(t),t++):(n=null,s("[0-4]")),n!==null&&(r=a())!==null?e=[e,n,r]:(e=null,t=o)):(e=null,t=o),e===null&&(o=t,i.charCodeAt(t)===49?(e="1",t++):(e=null,s('"1"')),e!==null&&(n=a())!==null&&(r=a())!==null?e=[e,n,r]:(e=null,t=o),e===null&&(o=t,/^[1-9]/.test(i.charAt(t))?(e=i.charAt(t),t++):(e=null,s("[1-9]")),e!==null&&(n=a())!==null?e=[e,n]:(e=null,t=o),e===null&&(e=a())))),e}function yn(){var e,n,r,o,u,g,U,Y;return g=t,U=t,(e=(e=a())!==null?e:"")!==null&&(n=(n=a())!==null?n:"")!==null&&(r=(r=a())!==null?r:"")!==null&&(o=(o=a())!==null?o:"")!==null&&(u=(u=a())!==null?u:"")!==null?e=[e,n,r,o,u]:(e=null,t=U),e!==null&&(Y=e,Y=parseInt(Y.join("")),H.port=Y,e=Y),e===null&&(t=g),e}function Tn(){var e,n,r,o;for(e=[],o=t,i.charCodeAt(t)===59?(n=";",t++):(n=null,s('";"')),n!==null&&(r=Bt())!==null?n=[n,r]:(n=null,t=o);n!==null;)e.push(n),o=t,i.charCodeAt(t)===59?(n=";",t++):(n=null,s('";"')),n!==null&&(r=Bt())!==null?n=[n,r]:(n=null,t=o);return e}function Bt(){var e;return(e=bn())===null&&(e=Sn())===null&&(e=Cn())===null&&(e=En())===null&&(e=An())===null&&(e=wn())===null&&(e=Rn()),e}function bn(){var e,n,r,o,u;return r=t,o=t,i.substr(t,10).toLowerCase()==="transport="?(e=i.substr(t,10),t+=10):(e=null,s('"transport="')),e!==null?(i.substr(t,3).toLowerCase()==="udp"?(n=i.substr(t,3),t+=3):(n=null,s('"udp"')),n===null&&(i.substr(t,3).toLowerCase()==="tcp"?(n=i.substr(t,3),t+=3):(n=null,s('"tcp"')),n===null&&(i.substr(t,4).toLowerCase()==="sctp"?(n=i.substr(t,4),t+=4):(n=null,s('"sctp"')),n===null&&(i.substr(t,3).toLowerCase()==="tls"?(n=i.substr(t,3),t+=3):(n=null,s('"tls"')),n===null&&(n=B())))),n!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e!==null&&(u=e[1],H.uri_params||(H.uri_params={}),e=void(H.uri_params.transport=u.toLowerCase())),e===null&&(t=r),e}function Sn(){var e,n,r,o,u;return r=t,o=t,i.substr(t,5).toLowerCase()==="user="?(e=i.substr(t,5),t+=5):(e=null,s('"user="')),e!==null?(i.substr(t,5).toLowerCase()==="phone"?(n=i.substr(t,5),t+=5):(n=null,s('"phone"')),n===null&&(i.substr(t,2).toLowerCase()==="ip"?(n=i.substr(t,2),t+=2):(n=null,s('"ip"')),n===null&&(n=B())),n!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e!==null&&(u=e[1],H.uri_params||(H.uri_params={}),e=void(H.uri_params.user=u.toLowerCase())),e===null&&(t=r),e}function Cn(){var e,n,r,o,u;return r=t,o=t,i.substr(t,7).toLowerCase()==="method="?(e=i.substr(t,7),t+=7):(e=null,s('"method="')),e!==null&&(n=St())!==null?e=[e,n]:(e=null,t=o),e!==null&&(u=e[1],H.uri_params||(H.uri_params={}),e=void(H.uri_params.method=u)),e===null&&(t=r),e}function En(){var e,n,r,o,u;return r=t,o=t,i.substr(t,4).toLowerCase()==="ttl="?(e=i.substr(t,4),t+=4):(e=null,s('"ttl="')),e!==null&&(n=nn())!==null?e=[e,n]:(e=null,t=o),e!==null&&(u=e[1],H.params||(H.params={}),e=void(H.params.ttl=u)),e===null&&(t=r),e}function An(){var e,n,r,o,u;return r=t,o=t,i.substr(t,6).toLowerCase()==="maddr="?(e=i.substr(t,6),t+=6):(e=null,s('"maddr="')),e!==null&&(n=it())!==null?e=[e,n]:(e=null,t=o),e!==null&&(u=e[1],H.uri_params||(H.uri_params={}),e=void(H.uri_params.maddr=u)),e===null&&(t=r),e}function wn(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,2).toLowerCase()==="lr"?(e=i.substr(t,2),t+=2):(e=null,s('"lr"')),e!==null?(g=t,i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n!==null&&(r=B())!==null?n=[n,r]:(n=null,t=g),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=u)):(e=null,t=u),e!==null&&(H.uri_params||(H.uri_params={}),e=void(H.uri_params.lr=void 0)),e===null&&(t=o),e}function Rn(){var e,n,r,o,u,g,U,Y;return o=t,u=t,(e=In())!==null?(g=t,i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n!==null&&(r=On())!==null?n=[n,r]:(n=null,t=g),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=u)):(e=null,t=u),e!==null&&(U=e[0],Y=e[1],H.uri_params||(H.uri_params={}),Y=Y===void 0?void 0:Y[1],e=void(H.uri_params[U.toLowerCase()]=Y)),e===null&&(t=o),e}function In(){var e,n,r;if(r=t,(n=lt())!==null)for(e=[];n!==null;)e.push(n),n=lt();else e=null;return e!==null&&(e=e.join("")),e===null&&(t=r),e}function On(){var e,n,r;if(r=t,(n=lt())!==null)for(e=[];n!==null;)e.push(n),n=lt();else e=null;return e!==null&&(e=e.join("")),e===null&&(t=r),e}function lt(){var e;return(e=kn())===null&&(e=x())===null&&(e=G()),e}function kn(){var e;return i.charCodeAt(t)===91?(e="[",t++):(e=null,s('"["')),e===null&&(i.charCodeAt(t)===93?(e="]",t++):(e=null,s('"]"')),e===null&&(i.charCodeAt(t)===47?(e="/",t++):(e=null,s('"/"')),e===null&&(i.charCodeAt(t)===58?(e=":",t++):(e=null,s('":"')),e===null&&(i.charCodeAt(t)===38?(e="&",t++):(e=null,s('"&"')),e===null&&(i.charCodeAt(t)===43?(e="+",t++):(e=null,s('"+"')),e===null&&(i.charCodeAt(t)===36?(e="$",t++):(e=null,s('"$"')))))))),e}function Nn(){var e,n,r,o,u,g,U;if(g=t,i.charCodeAt(t)===63?(e="?",t++):(e=null,s('"?"')),e!==null)if((n=yt())!==null){for(r=[],U=t,i.charCodeAt(t)===38?(o="&",t++):(o=null,s('"&"')),o!==null&&(u=yt())!==null?o=[o,u]:(o=null,t=U);o!==null;)r.push(o),U=t,i.charCodeAt(t)===38?(o="&",t++):(o=null,s('"&"')),o!==null&&(u=yt())!==null?o=[o,u]:(o=null,t=U);r!==null?e=[e,n,r]:(e=null,t=g)}else e=null,t=g;else e=null,t=g;return e}function yt(){var e,n,r,o,u,g,U;return o=t,u=t,(e=Dn())!==null?(i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n!==null&&(r=Pn())!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(g=e[0],U=e[2],g=g.join("").toLowerCase(),U=U.join(""),H.uri_headers||(H.uri_headers={}),e=void(H.uri_headers[g]?H.uri_headers[g].push(U):H.uri_headers[g]=[U])),e===null&&(t=o),e}function Dn(){var e,n;if((n=at())===null&&(n=x())===null&&(n=G()),n!==null)for(e=[];n!==null;)e.push(n),(n=at())===null&&(n=x())===null&&(n=G());else e=null;return e}function Pn(){var e,n;for(e=[],(n=at())===null&&(n=x())===null&&(n=G());n!==null;)e.push(n),(n=at())===null&&(n=x())===null&&(n=G());return e}function at(){var e;return i.charCodeAt(t)===91?(e="[",t++):(e=null,s('"["')),e===null&&(i.charCodeAt(t)===93?(e="]",t++):(e=null,s('"]"')),e===null&&(i.charCodeAt(t)===47?(e="/",t++):(e=null,s('"/"')),e===null&&(i.charCodeAt(t)===63?(e="?",t++):(e=null,s('"?"')),e===null&&(i.charCodeAt(t)===58?(e=":",t++):(e=null,s('":"')),e===null&&(i.charCodeAt(t)===43?(e="+",t++):(e=null,s('"+"')),e===null&&(i.charCodeAt(t)===36?(e="$",t++):(e=null,s('"$"')))))))),e}function xn(){var e,n,r,o,u,g;return g=t,(e=St())!==null&&(n=m())!==null&&(r=Un())!==null&&(o=m())!==null&&(u=Wt())!==null?e=[e,n,r,o,u]:(e=null,t=g),e}function Un(){var e;return(e=Ne())===null&&(e=Vt()),e}function Vt(){var e,n,r,o;return o=t,(e=jn())!==null?(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n!==null?((r=Mn())===null&&(r=Ln()),r!==null?e=[e,n,r]:(e=null,t=o)):(e=null,t=o)):(e=null,t=o),e}function Mn(){var e,n,r,o,u;return o=t,(e=qn())===null&&(e=Tt()),e!==null?(u=t,i.charCodeAt(t)===63?(n="?",t++):(n=null,s('"?"')),n!==null&&(r=Wn())!==null?n=[n,r]:(n=null,t=u),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e}function qn(){var e,n,r,o;return o=t,i.substr(t,2)==="//"?(e="//",t+=2):(e=null,s('"//"')),e!==null&&(n=Bn())!==null&&(r=(r=Tt())!==null?r:"")!==null?e=[e,n,r]:(e=null,t=o),e}function Tt(){var e,n,r;return r=t,i.charCodeAt(t)===47?(e="/",t++):(e=null,s('"/"')),e!==null&&(n=Fn())!==null?e=[e,n]:(e=null,t=r),e}function Ln(){var e,n,r,o;if(o=t,(e=Hn())!==null){for(n=[],r=ut();r!==null;)n.push(r),r=ut();n!==null?e=[e,n]:(e=null,t=o)}else e=null,t=o;return e}function ut(){var e;return(e=T())===null&&(e=x())===null&&(e=G()),e}function Hn(){var e;return(e=x())===null&&(e=G())===null&&(i.charCodeAt(t)===59?(e=";",t++):(e=null,s('";"')),e===null&&(i.charCodeAt(t)===63?(e="?",t++):(e=null,s('"?"')),e===null&&(i.charCodeAt(t)===58?(e=":",t++):(e=null,s('":"')),e===null&&(i.charCodeAt(t)===64?(e="@",t++):(e=null,s('"@"')),e===null&&(i.charCodeAt(t)===38?(e="&",t++):(e=null,s('"&"')),e===null&&(i.charCodeAt(t)===61?(e="=",t++):(e=null,s('"="')),e===null&&(i.charCodeAt(t)===43?(e="+",t++):(e=null,s('"+"')),e===null&&(i.charCodeAt(t)===36?(e="$",t++):(e=null,s('"$"')),e===null&&(i.charCodeAt(t)===44?(e=",",t++):(e=null,s('","'))))))))))),e}function Fn(){var e,n,r,o,u,g;if(u=t,(e=bt())!==null){for(n=[],g=t,i.charCodeAt(t)===47?(r="/",t++):(r=null,s('"/"')),r!==null&&(o=bt())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,i.charCodeAt(t)===47?(r="/",t++):(r=null,s('"/"')),r!==null&&(o=bt())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e}function bt(){var e,n,r,o,u,g;for(u=t,e=[],n=ct();n!==null;)e.push(n),n=ct();if(e!==null){for(n=[],g=t,i.charCodeAt(t)===59?(r=";",t++):(r=null,s('";"')),r!==null&&(o=Gt())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,i.charCodeAt(t)===59?(r=";",t++):(r=null,s('";"')),r!==null&&(o=Gt())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e}function Gt(){var e,n;for(e=[],n=ct();n!==null;)e.push(n),n=ct();return e}function ct(){var e;return(e=x())===null&&(e=G())===null&&(i.charCodeAt(t)===58?(e=":",t++):(e=null,s('":"')),e===null&&(i.charCodeAt(t)===64?(e="@",t++):(e=null,s('"@"')),e===null&&(i.charCodeAt(t)===38?(e="&",t++):(e=null,s('"&"')),e===null&&(i.charCodeAt(t)===61?(e="=",t++):(e=null,s('"="')),e===null&&(i.charCodeAt(t)===43?(e="+",t++):(e=null,s('"+"')),e===null&&(i.charCodeAt(t)===36?(e="$",t++):(e=null,s('"$"')),e===null&&(i.charCodeAt(t)===44?(e=",",t++):(e=null,s('","'))))))))),e}function jn(){var e,n,r,o,u,g;if(o=t,u=t,(e=v())!==null){for(n=[],(r=v())===null&&(r=a())===null&&(i.charCodeAt(t)===43?(r="+",t++):(r=null,s('"+"')),r===null&&(i.charCodeAt(t)===45?(r="-",t++):(r=null,s('"-"')),r===null&&(i.charCodeAt(t)===46?(r=".",t++):(r=null,s('"."')))));r!==null;)n.push(r),(r=v())===null&&(r=a())===null&&(i.charCodeAt(t)===43?(r="+",t++):(r=null,s('"+"')),r===null&&(i.charCodeAt(t)===45?(r="-",t++):(r=null,s('"-"')),r===null&&(i.charCodeAt(t)===46?(r=".",t++):(r=null,s('"."')))));n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e!==null&&(g=o,e=void(H.scheme=i.substring(t,g))),e===null&&(t=o),e}function Bn(){var e;return(e=Vn())===null&&(e=Gn()),e}function Vn(){var e,n,r,o;return r=t,o=t,(e=Ke())!==null?(i.charCodeAt(t)===64?(n="@",t++):(n=null,s('"@"')),n!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),(e=e!==null?e:"")!==null&&(n=vt())!==null?e=[e,n]:(e=null,t=r),e=e!==null?e:""}function Gn(){var e,n;if((n=x())===null&&(n=G())===null&&(i.charCodeAt(t)===36?(n="$",t++):(n=null,s('"$"')),n===null&&(i.charCodeAt(t)===44?(n=",",t++):(n=null,s('","')),n===null&&(i.charCodeAt(t)===59?(n=";",t++):(n=null,s('";"')),n===null&&(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n===null&&(i.charCodeAt(t)===64?(n="@",t++):(n=null,s('"@"')),n===null&&(i.charCodeAt(t)===38?(n="&",t++):(n=null,s('"&"')),n===null&&(i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"')))))))))),n!==null)for(e=[];n!==null;)e.push(n),(n=x())===null&&(n=G())===null&&(i.charCodeAt(t)===36?(n="$",t++):(n=null,s('"$"')),n===null&&(i.charCodeAt(t)===44?(n=",",t++):(n=null,s('","')),n===null&&(i.charCodeAt(t)===59?(n=";",t++):(n=null,s('";"')),n===null&&(i.charCodeAt(t)===58?(n=":",t++):(n=null,s('":"')),n===null&&(i.charCodeAt(t)===64?(n="@",t++):(n=null,s('"@"')),n===null&&(i.charCodeAt(t)===38?(n="&",t++):(n=null,s('"&"')),n===null&&(i.charCodeAt(t)===61?(n="=",t++):(n=null,s('"="')),n===null&&(i.charCodeAt(t)===43?(n="+",t++):(n=null,s('"+"'))))))))));else e=null;return e}function Wn(){var e,n;for(e=[],n=ut();n!==null;)e.push(n),n=ut();return e}function Wt(){var e,n,r,o,u,g,U,Y,te;if(U=t,Y=t,i.substr(t,3).toLowerCase()==="sip"?(e=i.substr(t,3),t+=3):(e=null,s('"SIP"')),e!==null)if(i.charCodeAt(t)===47?(n="/",t++):(n=null,s('"/"')),n!==null){if((o=a())!==null)for(r=[];o!==null;)r.push(o),o=a();else r=null;if(r!==null)if(i.charCodeAt(t)===46?(o=".",t++):(o=null,s('"."')),o!==null){if((g=a())!==null)for(u=[];g!==null;)u.push(g),g=a();else u=null;u!==null?e=[e,n,r,o,u]:(e=null,t=Y)}else e=null,t=Y;else e=null,t=Y}else e=null,t=Y;else e=null,t=Y;return e!==null&&(te=U,e=void(H.sip_version=i.substring(t,te))),e===null&&(t=U),e}function Yn(){var e;return i.substr(t,6)==="INVITE"?(e="INVITE",t+=6):(e=null,s('"INVITE"')),e}function $n(){var e;return i.substr(t,3)==="ACK"?(e="ACK",t+=3):(e=null,s('"ACK"')),e}function Kn(){var e;return i.substr(t,7)==="OPTIONS"?(e="OPTIONS",t+=7):(e=null,s('"OPTIONS"')),e}function zn(){var e;return i.substr(t,3)==="BYE"?(e="BYE",t+=3):(e=null,s('"BYE"')),e}function Xn(){var e;return i.substr(t,6)==="CANCEL"?(e="CANCEL",t+=6):(e=null,s('"CANCEL"')),e}function Qn(){var e;return i.substr(t,8)==="REGISTER"?(e="REGISTER",t+=8):(e=null,s('"REGISTER"')),e}function Jn(){var e;return i.substr(t,9)==="SUBSCRIBE"?(e="SUBSCRIBE",t+=9):(e=null,s('"SUBSCRIBE"')),e}function Zn(){var e;return i.substr(t,6)==="NOTIFY"?(e="NOTIFY",t+=6):(e=null,s('"NOTIFY"')),e}function er(){var e;return i.substr(t,5)==="REFER"?(e="REFER",t+=5):(e=null,s('"REFER"')),e}function St(){var e,n,r;return n=t,(e=Yn())===null&&(e=$n())===null&&(e=Kn())===null&&(e=zn())===null&&(e=Xn())===null&&(e=Qn())===null&&(e=Jn())===null&&(e=Zn())===null&&(e=er())===null&&(e=B()),e!==null&&(r=n,H.method=i.substring(t,r),e=H.method),e===null&&(t=n),e}function tr(){var e,n,r,o,u,g;return g=t,(e=Wt())!==null&&(n=m())!==null&&(r=nr())!==null&&(o=m())!==null&&(u=ir())!==null?e=[e,n,r,o,u]:(e=null,t=g),e}function nr(){var e,n,r;return n=t,(e=rr())!==null&&(r=e,e=void(H.status_code=parseInt(r.join("")))),e===null&&(t=n),e}function rr(){var e,n,r,o;return o=t,(e=a())!==null&&(n=a())!==null&&(r=a())!==null?e=[e,n,r]:(e=null,t=o),e}function ir(){var e,n,r,o;for(r=t,e=[],(n=T())===null&&(n=x())===null&&(n=G())===null&&(n=O())===null&&(n=F())===null&&(n=m())===null&&(n=S());n!==null;)e.push(n),(n=T())===null&&(n=x())===null&&(n=G())===null&&(n=O())===null&&(n=F())===null&&(n=m())===null&&(n=S());return e!==null&&(o=r,e=void(H.reason_phrase=i.substring(t,o))),e===null&&(t=r),e}function Ct(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=Ue())===null&&(e=je()),e!==null){for(n=[],U=t,(r=X())!==null&&(o=Yt())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=X())!==null&&(o=Yt())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y){var te;H.multi_header||(H.multi_header=[]);try{te=new ze(H.uri,H.display_name,H.params),delete H.uri,delete H.display_name,delete H.params}catch{te=null}H.multi_header.push({possition:t,offset:Y,parsed:te})}(u)),e===null&&(t=u),e}function je(){var e,n,r,o,u;return u=t,(e=(e=Et())!==null?e:"")!==null&&(n=ne())!==null&&(r=Ne())!==null&&(o=z())!==null?e=[e,n,r,o]:(e=null,t=u),e}function Et(){var e,n,r,o,u,g,U,Y;if(u=t,g=t,(e=B())!==null){for(n=[],U=t,(r=d())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=d())!==null&&(o=B())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e===null&&(e=xe()),e!==null&&(Y=e,e=void(H.display_name=typeof Y=="string"?Y:Y[1].reduce(function(te,se){return te+se[0]+se[1]},Y[0]))),e===null&&(t=u),e}function Yt(){var e;return(e=sr())===null&&(e=or())===null&&(e=pe()),e}function sr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,1).toLowerCase()==="q"?(e=i.substr(t,1),t++):(e=null,s('"q"')),e!==null&&(n=P())!==null&&(r=lr())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],H.params||(H.params={}),e=void(H.params.q=g)),e===null&&(t=o),e}function or(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,7).toLowerCase()==="expires"?(e=i.substr(t,7),t+=7):(e=null,s('"expires"')),e!==null&&(n=P())!==null&&(r=Be())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],H.params||(H.params={}),e=void(H.params.expires=g)),e===null&&(t=o),e}function Be(){var e,n,r;if(r=t,(n=a())!==null)for(e=[];n!==null;)e.push(n),n=a();else e=null;return e!==null&&(e=parseInt(e.join(""))),e===null&&(t=r),e}function lr(){var e,n,r,o,u,g,U,Y,te;return g=t,U=t,i.charCodeAt(t)===48?(e="0",t++):(e=null,s('"0"')),e!==null?(Y=t,i.charCodeAt(t)===46?(n=".",t++):(n=null,s('"."')),n!==null&&(r=(r=a())!==null?r:"")!==null&&(o=(o=a())!==null?o:"")!==null&&(u=(u=a())!==null?u:"")!==null?n=[n,r,o,u]:(n=null,t=Y),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=U)):(e=null,t=U),e!==null&&(te=g,e=parseFloat(i.substring(t,te))),e===null&&(t=g),e}function pe(){var e,n,r,o,u,g,U,Y;return o=t,u=t,(e=B())!==null?(g=t,(n=P())!==null&&(r=ar())!==null?n=[n,r]:(n=null,t=g),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=u)):(e=null,t=u),e!==null&&(U=e[0],Y=e[1],H.params||(H.params={}),Y=Y===void 0?void 0:Y[1],e=void(H.params[U.toLowerCase()]=Y)),e===null&&(t=o),e}function ar(){var e;return(e=B())===null&&(e=it())===null&&(e=Ee()),e}function ur(){var e;return i.substr(t,6).toLowerCase()==="render"?(e=i.substr(t,6),t+=6):(e=null,s('"render"')),e===null&&(i.substr(t,7).toLowerCase()==="session"?(e=i.substr(t,7),t+=7):(e=null,s('"session"')),e===null&&(i.substr(t,4).toLowerCase()==="icon"?(e=i.substr(t,4),t+=4):(e=null,s('"icon"')),e===null&&(i.substr(t,5).toLowerCase()==="alert"?(e=i.substr(t,5),t+=5):(e=null,s('"alert"')),e===null&&(e=B())))),e}function $t(){var e;return(e=cr())===null&&(e=pe()),e}function cr(){var e,n,r,o;return o=t,i.substr(t,8).toLowerCase()==="handling"?(e=i.substr(t,8),t+=8):(e=null,s('"handling"')),e!==null&&(n=P())!==null?(i.substr(t,8).toLowerCase()==="optional"?(r=i.substr(t,8),t+=8):(r=null,s('"optional"')),r===null&&(i.substr(t,8).toLowerCase()==="required"?(r=i.substr(t,8),t+=8):(r=null,s('"required"')),r===null&&(r=B())),r!==null?e=[e,n,r]:(e=null,t=o)):(e=null,t=o),e}function dr(){var e,n,r,o,u,g,U,Y;if(U=t,(e=fr())!==null)if((n=k())!==null)if((r=mr())!==null){for(o=[],Y=t,(u=X())!==null&&(g=Kt())!==null?u=[u,g]:(u=null,t=Y);u!==null;)o.push(u),Y=t,(u=X())!==null&&(g=Kt())!==null?u=[u,g]:(u=null,t=Y);o!==null?e=[e,n,r,o]:(e=null,t=U)}else e=null,t=U;else e=null,t=U;else e=null,t=U;return e}function fr(){var e;return(e=hr())===null&&(e=_r()),e}function hr(){var e;return i.substr(t,4).toLowerCase()==="text"?(e=i.substr(t,4),t+=4):(e=null,s('"text"')),e===null&&(i.substr(t,5).toLowerCase()==="image"?(e=i.substr(t,5),t+=5):(e=null,s('"image"')),e===null&&(i.substr(t,5).toLowerCase()==="audio"?(e=i.substr(t,5),t+=5):(e=null,s('"audio"')),e===null&&(i.substr(t,5).toLowerCase()==="video"?(e=i.substr(t,5),t+=5):(e=null,s('"video"')),e===null&&(i.substr(t,11).toLowerCase()==="application"?(e=i.substr(t,11),t+=11):(e=null,s('"application"')),e===null&&(e=At()))))),e}function _r(){var e;return i.substr(t,7).toLowerCase()==="message"?(e=i.substr(t,7),t+=7):(e=null,s('"message"')),e===null&&(i.substr(t,9).toLowerCase()==="multipart"?(e=i.substr(t,9),t+=9):(e=null,s('"multipart"')),e===null&&(e=At())),e}function At(){var e;return(e=B())===null&&(e=pr()),e}function pr(){var e,n,r;return r=t,i.substr(t,2).toLowerCase()==="x-"?(e=i.substr(t,2),t+=2):(e=null,s('"x-"')),e!==null&&(n=B())!==null?e=[e,n]:(e=null,t=r),e}function mr(){var e;return(e=At())===null&&(e=B()),e}function Kt(){var e,n,r,o;return o=t,(e=B())!==null&&(n=P())!==null&&(r=gr())!==null?e=[e,n,r]:(e=null,t=o),e}function gr(){var e;return(e=B())===null&&(e=Ee()),e}function vr(){var e,n,r,o;if(r=t,(n=a())!==null)for(e=[];n!==null;)e.push(n),n=a();else e=null;return e!==null&&(o=e,e=void(H.value=parseInt(o.join("")))),e===null&&(t=r),e}function dt(){var e,n,r,o,u,g;if(u=t,(e=$())!==null){for(n=[],g=t,i.charCodeAt(t)===46?(r=".",t++):(r=null,s('"."')),r!==null&&(o=$())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,i.charCodeAt(t)===46?(r=".",t++):(r=null,s('"."')),r!==null&&(o=$())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e}function zt(){var e;return(e=Xt())===null&&(e=pe()),e}function Xt(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,3).toLowerCase()==="tag"?(e=i.substr(t,3),t+=3):(e=null,s('"tag"')),e!==null&&(n=P())!==null&&(r=B())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],e=void(H.tag=g)),e===null&&(t=o),e}function Qt(){var e,n,r,o,u,g,U,Y;if(U=t,i.substr(t,6).toLowerCase()==="digest"?(e=i.substr(t,6),t+=6):(e=null,s('"Digest"')),e!==null)if((n=d())!==null)if((r=wt())!==null){for(o=[],Y=t,(u=Z())!==null&&(g=wt())!==null?u=[u,g]:(u=null,t=Y);u!==null;)o.push(u),Y=t,(u=Z())!==null&&(g=wt())!==null?u=[u,g]:(u=null,t=Y);o!==null?e=[e,n,r,o]:(e=null,t=U)}else e=null,t=U;else e=null,t=U;else e=null,t=U;return e===null&&(e=yr()),e}function yr(){var e,n,r,o,u,g,U,Y;if(U=t,(e=B())!==null)if((n=d())!==null)if((r=ft())!==null){for(o=[],Y=t,(u=Z())!==null&&(g=ft())!==null?u=[u,g]:(u=null,t=Y);u!==null;)o.push(u),Y=t,(u=Z())!==null&&(g=ft())!==null?u=[u,g]:(u=null,t=Y);o!==null?e=[e,n,r,o]:(e=null,t=U)}else e=null,t=U;else e=null,t=U;else e=null,t=U;return e}function ft(){var e,n,r,o;return o=t,(e=B())!==null&&(n=P())!==null?((r=B())===null&&(r=Ee()),r!==null?e=[e,n,r]:(e=null,t=o)):(e=null,t=o),e}function wt(){var e;return(e=Tr())===null&&(e=Sr())===null&&(e=Cr())===null&&(e=Ar())===null&&(e=wr())===null&&(e=Rr())===null&&(e=Ir())===null&&(e=ft()),e}function Tr(){var e,n,r,o;return o=t,i.substr(t,5).toLowerCase()==="realm"?(e=i.substr(t,5),t+=5):(e=null,s('"realm"')),e!==null&&(n=P())!==null&&(r=br())!==null?e=[e,n,r]:(e=null,t=o),e}function br(){var e,n,r;return n=t,(e=xe())!==null&&(r=e,e=void(H.realm=r)),e===null&&(t=n),e}function Sr(){var e,n,r,o,u,g,U,Y,te;if(Y=t,i.substr(t,6).toLowerCase()==="domain"?(e=i.substr(t,6),t+=6):(e=null,s('"domain"')),e!==null)if((n=P())!==null)if((r=ue())!==null)if((o=Rt())!==null){if(u=[],te=t,(U=m())!==null)for(g=[];U!==null;)g.push(U),U=m();else g=null;for(g!==null&&(U=Rt())!==null?g=[g,U]:(g=null,t=te);g!==null;){if(u.push(g),te=t,(U=m())!==null)for(g=[];U!==null;)g.push(U),U=m();else g=null;g!==null&&(U=Rt())!==null?g=[g,U]:(g=null,t=te)}u!==null&&(g=de())!==null?e=[e,n,r,o,u,g]:(e=null,t=Y)}else e=null,t=Y;else e=null,t=Y;else e=null,t=Y;else e=null,t=Y;return e}function Rt(){var e;return(e=Vt())===null&&(e=Tt()),e}function Cr(){var e,n,r,o;return o=t,i.substr(t,5).toLowerCase()==="nonce"?(e=i.substr(t,5),t+=5):(e=null,s('"nonce"')),e!==null&&(n=P())!==null&&(r=Er())!==null?e=[e,n,r]:(e=null,t=o),e}function Er(){var e,n,r;return n=t,(e=xe())!==null&&(r=e,e=void(H.nonce=r)),e===null&&(t=n),e}function Ar(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,6).toLowerCase()==="opaque"?(e=i.substr(t,6),t+=6):(e=null,s('"opaque"')),e!==null&&(n=P())!==null&&(r=xe())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],e=void(H.opaque=g)),e===null&&(t=o),e}function wr(){var e,n,r,o,u;return o=t,i.substr(t,5).toLowerCase()==="stale"?(e=i.substr(t,5),t+=5):(e=null,s('"stale"')),e!==null&&(n=P())!==null?(u=t,i.substr(t,4).toLowerCase()==="true"?(r=i.substr(t,4),t+=4):(r=null,s('"true"')),r!==null&&(r=void(H.stale=!0)),r===null&&(t=u),r===null&&(u=t,i.substr(t,5).toLowerCase()==="false"?(r=i.substr(t,5),t+=5):(r=null,s('"false"')),r!==null&&(r=void(H.stale=!1)),r===null&&(t=u)),r!==null?e=[e,n,r]:(e=null,t=o)):(e=null,t=o),e}function Rr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,9).toLowerCase()==="algorithm"?(e=i.substr(t,9),t+=9):(e=null,s('"algorithm"')),e!==null&&(n=P())!==null?(i.substr(t,3).toLowerCase()==="md5"?(r=i.substr(t,3),t+=3):(r=null,s('"MD5"')),r===null&&(i.substr(t,8).toLowerCase()==="md5-sess"?(r=i.substr(t,8),t+=8):(r=null,s('"MD5-sess"')),r===null&&(r=B())),r!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(g=e[2],e=void(H.algorithm=g.toUpperCase())),e===null&&(t=o),e}function Ir(){var e,n,r,o,u,g,U,Y,te,se;if(Y=t,i.substr(t,3).toLowerCase()==="qop"?(e=i.substr(t,3),t+=3):(e=null,s('"qop"')),e!==null)if((n=P())!==null)if((r=ue())!==null){if(te=t,(o=It())!==null){for(u=[],se=t,i.charCodeAt(t)===44?(g=",",t++):(g=null,s('","')),g!==null&&(U=It())!==null?g=[g,U]:(g=null,t=se);g!==null;)u.push(g),se=t,i.charCodeAt(t)===44?(g=",",t++):(g=null,s('","')),g!==null&&(U=It())!==null?g=[g,U]:(g=null,t=se);u!==null?o=[o,u]:(o=null,t=te)}else o=null,t=te;o!==null&&(u=de())!==null?e=[e,n,r,o,u]:(e=null,t=Y)}else e=null,t=Y;else e=null,t=Y;else e=null,t=Y;return e}function It(){var e,n,r;return n=t,i.substr(t,8).toLowerCase()==="auth-int"?(e=i.substr(t,8),t+=8):(e=null,s('"auth-int"')),e===null&&(i.substr(t,4).toLowerCase()==="auth"?(e=i.substr(t,4),t+=4):(e=null,s('"auth"')),e===null&&(e=B())),e!==null&&(r=e,H.qop||(H.qop=[]),e=void H.qop.push(r.toLowerCase())),e===null&&(t=n),e}function Ot(){var e,n,r,o,u,g,U;if(u=t,g=t,(e=je())!==null){for(n=[],U=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=U);r!==null;)n.push(r),U=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=U);n!==null?e=[e,n]:(e=null,t=g)}else e=null,t=g;return e!==null&&(e=function(Y){var te;H.multi_header||(H.multi_header=[]);try{te=new ze(H.uri,H.display_name,H.params),delete H.uri,delete H.display_name,delete H.params}catch{te=null}H.multi_header.push({possition:t,offset:Y,parsed:te})}(u)),e===null&&(t=u),e}function Jt(){var e;return(e=Or())===null&&(e=pe()),e}function Or(){var e,n,r,o,u,g,U;if(u=t,g=t,i.substr(t,5).toLowerCase()==="cause"?(e=i.substr(t,5),t+=5):(e=null,s('"cause"')),e!==null)if((n=P())!==null){if((o=a())!==null)for(r=[];o!==null;)r.push(o),o=a();else r=null;r!==null?e=[e,n,r]:(e=null,t=g)}else e=null,t=g;else e=null,t=g;return e!==null&&(U=e[2],e=void(H.cause=parseInt(U.join("")))),e===null&&(t=u),e}function kt(){var e,n,r,o,u,g;if(u=t,(e=je())!==null){for(n=[],g=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=g);r!==null;)n.push(r),g=t,(r=X())!==null&&(o=pe())!==null?r=[r,o]:(r=null,t=g);n!==null?e=[e,n]:(e=null,t=u)}else e=null,t=u;return e}function kr(){var e,n,r;return n=t,i.substr(t,6).toLowerCase()==="active"?(e=i.substr(t,6),t+=6):(e=null,s('"active"')),e===null&&(i.substr(t,7).toLowerCase()==="pending"?(e=i.substr(t,7),t+=7):(e=null,s('"pending"')),e===null&&(i.substr(t,10).toLowerCase()==="terminated"?(e=i.substr(t,10),t+=10):(e=null,s('"terminated"')),e===null&&(e=B()))),e!==null&&(r=n,e=void(H.state=i.substring(t,r))),e===null&&(t=n),e}function Zt(){var e,n,r,o,u,g,U,Y;return o=t,u=t,i.substr(t,6).toLowerCase()==="reason"?(e=i.substr(t,6),t+=6):(e=null,s('"reason"')),e!==null&&(n=P())!==null&&(r=Nr())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(e=void((g=e[2])!==void 0&&(H.reason=g))),e===null&&(t=o),e===null&&(o=t,u=t,i.substr(t,7).toLowerCase()==="expires"?(e=i.substr(t,7),t+=7):(e=null,s('"expires"')),e!==null&&(n=P())!==null&&(r=Be())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(e=void((Y=e[2])!==void 0&&(H.expires=Y))),e===null&&(t=o),e===null&&(o=t,u=t,i.substr(t,11).toLowerCase()==="retry_after"?(e=i.substr(t,11),t+=11):(e=null,s('"retry_after"')),e!==null&&(n=P())!==null&&(r=Be())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(e=void((U=e[2])!==void 0&&(H.retry_after=U))),e===null&&(t=o),e===null&&(e=pe()))),e}function Nr(){var e;return i.substr(t,11).toLowerCase()==="deactivated"?(e=i.substr(t,11),t+=11):(e=null,s('"deactivated"')),e===null&&(i.substr(t,9).toLowerCase()==="probation"?(e=i.substr(t,9),t+=9):(e=null,s('"probation"')),e===null&&(i.substr(t,8).toLowerCase()==="rejected"?(e=i.substr(t,8),t+=8):(e=null,s('"rejected"')),e===null&&(i.substr(t,7).toLowerCase()==="timeout"?(e=i.substr(t,7),t+=7):(e=null,s('"timeout"')),e===null&&(i.substr(t,6).toLowerCase()==="giveup"?(e=i.substr(t,6),t+=6):(e=null,s('"giveup"')),e===null&&(i.substr(t,10).toLowerCase()==="noresource"?(e=i.substr(t,10),t+=10):(e=null,s('"noresource"')),e===null&&(i.substr(t,9).toLowerCase()==="invariant"?(e=i.substr(t,9),t+=9):(e=null,s('"invariant"')),e===null&&(e=B()))))))),e}function en(){var e;return(e=Xt())===null&&(e=pe()),e}function Nt(){var e,n,r,o,u,g,U,Y;if(U=t,(e=Lr())!==null)if((n=d())!==null)if((r=jr())!==null){for(o=[],Y=t,(u=X())!==null&&(g=tn())!==null?u=[u,g]:(u=null,t=Y);u!==null;)o.push(u),Y=t,(u=X())!==null&&(g=tn())!==null?u=[u,g]:(u=null,t=Y);o!==null?e=[e,n,r,o]:(e=null,t=U)}else e=null,t=U;else e=null,t=U;else e=null,t=U;return e}function tn(){var e;return(e=Dr())===null&&(e=Pr())===null&&(e=xr())===null&&(e=Ur())===null&&(e=Mr())===null&&(e=pe()),e}function Dr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,3).toLowerCase()==="ttl"?(e=i.substr(t,3),t+=3):(e=null,s('"ttl"')),e!==null&&(n=P())!==null&&(r=nn())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],e=void(H.ttl=g)),e===null&&(t=o),e}function Pr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,5).toLowerCase()==="maddr"?(e=i.substr(t,5),t+=5):(e=null,s('"maddr"')),e!==null&&(n=P())!==null&&(r=it())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],e=void(H.maddr=g)),e===null&&(t=o),e}function xr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,8).toLowerCase()==="received"?(e=i.substr(t,8),t+=8):(e=null,s('"received"')),e!==null&&(n=P())!==null?((r=st())===null&&(r=jt()),r!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(g=e[2],e=void(H.received=g)),e===null&&(t=o),e}function Ur(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,6).toLowerCase()==="branch"?(e=i.substr(t,6),t+=6):(e=null,s('"branch"')),e!==null&&(n=P())!==null&&(r=B())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],e=void(H.branch=g)),e===null&&(t=o),e}function Mr(){var e,n,r,o,u;return o=t,i.substr(t,5).toLowerCase()==="rport"?(e=i.substr(t,5),t+=5):(e=null,s('"rport"')),e!==null?(u=t,(n=P())!==null&&(r=qr())!==null?n=[n,r]:(n=null,t=u),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e}function qr(){var e,n,r,o,u,g,U,Y;return g=t,U=t,(e=(e=a())!==null?e:"")!==null&&(n=(n=a())!==null?n:"")!==null&&(r=(r=a())!==null?r:"")!==null&&(o=(o=a())!==null?o:"")!==null&&(u=(u=a())!==null?u:"")!==null?e=[e,n,r,o,u]:(e=null,t=U),e!==null&&(Y=e,e=void(H.rport=parseInt(Y.join("")))),e===null&&(t=g),e}function Lr(){var e,n,r,o,u,g;return g=t,(e=Hr())!==null&&(n=k())!==null&&(r=B())!==null&&(o=k())!==null&&(u=Fr())!==null?e=[e,n,r,o,u]:(e=null,t=g),e}function Hr(){var e,n,r;return n=t,i.substr(t,3).toLowerCase()==="sip"?(e=i.substr(t,3),t+=3):(e=null,s('"SIP"')),e===null&&(e=B()),e!==null&&(r=e,e=void(H.protocol=r)),e===null&&(t=n),e}function Fr(){var e,n,r;return n=t,i.substr(t,3).toLowerCase()==="udp"?(e=i.substr(t,3),t+=3):(e=null,s('"UDP"')),e===null&&(i.substr(t,3).toLowerCase()==="tcp"?(e=i.substr(t,3),t+=3):(e=null,s('"TCP"')),e===null&&(i.substr(t,3).toLowerCase()==="tls"?(e=i.substr(t,3),t+=3):(e=null,s('"TLS"')),e===null&&(i.substr(t,4).toLowerCase()==="sctp"?(e=i.substr(t,4),t+=4):(e=null,s('"SCTP"')),e===null&&(e=B())))),e!==null&&(r=e,e=void(H.transport=r)),e===null&&(t=n),e}function jr(){var e,n,r,o,u;return o=t,(e=Br())!==null?(u=t,(n=ie())!==null&&(r=Vr())!==null?n=[n,r]:(n=null,t=u),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=o)):(e=null,t=o),e}function Br(){var e,n,r;return n=t,(e=st())===null&&(e=Ft())===null&&(e=Lt()),e!==null&&(r=n,e=void(H.host=i.substring(t,r))),e===null&&(t=n),e}function Vr(){var e,n,r,o,u,g,U,Y;return g=t,U=t,(e=(e=a())!==null?e:"")!==null&&(n=(n=a())!==null?n:"")!==null&&(r=(r=a())!==null?r:"")!==null&&(o=(o=a())!==null?o:"")!==null&&(u=(u=a())!==null?u:"")!==null?e=[e,n,r,o,u]:(e=null,t=U),e!==null&&(Y=e,e=void(H.port=parseInt(Y.join("")))),e===null&&(t=g),e}function nn(){var e,n,r,o,u;return o=t,u=t,(e=a())!==null&&(n=(n=a())!==null?n:"")!==null&&(r=(r=a())!==null?r:"")!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(e=parseInt(e.join(""))),e===null&&(t=o),e}function Gr(){var e,n,r;return n=t,(e=Be())!==null&&(r=e,e=void(H.expires=r)),e===null&&(t=n),e}function rn(){var e;return(e=Wr())===null&&(e=pe()),e}function Wr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,9).toLowerCase()==="refresher"?(e=i.substr(t,9),t+=9):(e=null,s('"refresher"')),e!==null&&(n=P())!==null?(i.substr(t,3).toLowerCase()==="uac"?(r=i.substr(t,3),t+=3):(r=null,s('"uac"')),r===null&&(i.substr(t,3).toLowerCase()==="uas"?(r=i.substr(t,3),t+=3):(r=null,s('"uas"'))),r!==null?e=[e,n,r]:(e=null,t=u)):(e=null,t=u),e!==null&&(g=e[2],e=void(H.refresher=g.toLowerCase())),e===null&&(t=o),e}function Yr(){var e,n;for(e=[],(n=D())===null&&(n=F())===null&&(n=d());n!==null;)e.push(n),(n=D())===null&&(n=F())===null&&(n=d());return e}function $r(){var e,n,r,o,u,g,U,Y,te,se,Te,ke;return se=t,Te=t,(e=Kr())!==null?(i.charCodeAt(t)===45?(n="-",t++):(n=null,s('"-"')),n!==null&&(r=De())!==null?(i.charCodeAt(t)===45?(o="-",t++):(o=null,s('"-"')),o!==null&&(u=De())!==null?(i.charCodeAt(t)===45?(g="-",t++):(g=null,s('"-"')),g!==null&&(U=De())!==null?(i.charCodeAt(t)===45?(Y="-",t++):(Y=null,s('"-"')),Y!==null&&(te=zr())!==null?e=[e,n,r,o,u,g,U,Y,te]:(e=null,t=Te)):(e=null,t=Te)):(e=null,t=Te)):(e=null,t=Te)):(e=null,t=Te),e!==null&&(ke=se,e[0],e=void(H=i.substring(t+5,ke))),e===null&&(t=se),e}function De(){var e,n,r,o,u;return u=t,(e=y())!==null&&(n=y())!==null&&(r=y())!==null&&(o=y())!==null?e=[e,n,r,o]:(e=null,t=u),e}function Kr(){var e,n,r;return r=t,(e=De())!==null&&(n=De())!==null?e=[e,n]:(e=null,t=r),e}function zr(){var e,n,r,o;return o=t,(e=De())!==null&&(n=De())!==null&&(r=De())!==null?e=[e,n,r]:(e=null,t=o),e}function Xr(){var e,n,r,o,u,g,U;return o=t,u=t,(e=l())!==null?(g=t,i.charCodeAt(t)===64?(n="@",t++):(n=null,s('"@"')),n!==null&&(r=l())!==null?n=[n,r]:(n=null,t=g),(n=n!==null?n:"")!==null?e=[e,n]:(e=null,t=u)):(e=null,t=u),e!==null&&(U=o,e=void(H.call_id=i.substring(t,U))),e===null&&(t=o),e}function sn(){var e;return(e=Qr())===null&&(e=Jr())===null&&(e=Zr())===null&&(e=pe()),e}function Qr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,6)==="to-tag"?(e="to-tag",t+=6):(e=null,s('"to-tag"')),e!==null&&(n=P())!==null&&(r=B())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],e=void(H.to_tag=g)),e===null&&(t=o),e}function Jr(){var e,n,r,o,u,g;return o=t,u=t,i.substr(t,8)==="from-tag"?(e="from-tag",t+=8):(e=null,s('"from-tag"')),e!==null&&(n=P())!==null&&(r=B())!==null?e=[e,n,r]:(e=null,t=u),e!==null&&(g=e[2],e=void(H.from_tag=g)),e===null&&(t=o),e}function Zr(){var e,n;return n=t,i.substr(t,10)==="early-only"?(e="early-only",t+=10):(e=null,s('"early-only"')),e!==null&&(e=void(H.early_only=!0)),e===null&&(t=n),e}var ei=A("./URI"),ze=A("./NameAddrHeader"),H={};if(q[M]()===null||t!==i.length){var on=Math.max(t,I),yi=on<i.length?i.charAt(on):null,ti=function(){for(var e=1,n=1,r=!1,o=0;o<Math.max(t,I);o++){var u=i.charAt(o);u===`
`?(r||e++,n=1,r=!1):u==="\r"||u==="\u2028"||u==="\u2029"?(e++,n=1,r=!0):(n++,r=!1)}return{line:e,column:n}}();return new this.SyntaxError(function(e){e.sort();for(var n=null,r=[],o=0;o<e.length;o++)e[o]!==n&&(r.push(e[o]),n=e[o]);return r}(R),yi,on,ti.line,ti.column),-1}return H},toSource:function(){return this._source},SyntaxError:function(i,M,q,t,I){this.name="SyntaxError",this.expected=i,this.found=M,this.message=function(R,s){var _;switch(R.length){case 0:_="end of input";break;case 1:_=R[0];break;default:_=R.slice(0,R.length-1).join(", ")+" or "+R[R.length-1]}return"Expected "+_+" but "+(s?L(s):"end of input")+" found."}(i,M),this.offset=q,this.line=t,this.column=I}};return N.SyntaxError.prototype=Error.prototype,N}()},{"./NameAddrHeader":11,"./URI":29}],8:[function(A,V,j){var L=A("../package.json"),N=A("./Constants"),i=A("./Exceptions"),M=A("./Utils"),q=A("./UA"),t=A("./URI"),I=A("./NameAddrHeader"),R=A("./Grammar"),s=A("./WebSocketInterface"),_=A("./SIPMessage"),a=A("./Parser"),v=A("./DigestAuthentication");A("debug")("JsSIP")("version %s",L.version),V.exports={C:N,Exceptions:i,Utils:M,UA:q,URI:t,NameAddrHeader:I,WebSocketInterface:s,Grammar:R,SIPMessage:_,Parser:a,DigestAuthentication:v,debug:A("debug"),get name(){return L.title},get version(){return L.version}}},{"../package.json":42,"./Constants":2,"./DigestAuthentication":5,"./Exceptions":6,"./Grammar":7,"./NameAddrHeader":11,"./Parser":14,"./SIPMessage":22,"./UA":28,"./URI":29,"./Utils":30,"./WebSocketInterface":31,debug:34}],9:[function(A,V,j){function L(M,q){for(var t=0;t<q.length;t++){var I=q[t];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(M,I.key,I)}}var N=A("debug"),i="JsSIP";V.exports=function(){function M(I){(function(R,s){if(!(R instanceof s))throw new TypeError("Cannot call a class as a function")})(this,M),I?(this._debug=N.default("".concat(i,":").concat(I)),this._warn=N.default("".concat(i,":WARN:").concat(I)),this._error=N.default("".concat(i,":ERROR:").concat(I))):(this._debug=N.default(i),this._warn=N.default("".concat(i,":WARN")),this._error=N.default("".concat(i,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var q,t;return q=M,(t=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&L(q.prototype,t),Object.defineProperty(q,"prototype",{writable:!1}),M}()},{debug:34}],10:[function(A,V,j){function L(c){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(c)}function N(c,p){for(var m=0;m<p.length;m++){var S=p[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(c,S.key,S)}}function i(c,p){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,S){return m.__proto__=S,m})(c,p)}function M(c){var p=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var m,S=q(c);if(p){var b=q(this).constructor;m=Reflect.construct(S,arguments,b)}else m=S.apply(this,arguments);return function(T,x){if(x&&(L(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(Q){if(Q===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Q}(T)}(this,m)}}function q(c){return(q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(p){return p.__proto__||Object.getPrototypeOf(p)})(c)}var t=A("events").EventEmitter,I=A("./Logger"),R=A("./Constants"),s=A("./SIPMessage"),_=A("./Utils"),a=A("./RequestSender"),v=A("./Exceptions"),y=A("./URI"),C=new I("Message");V.exports=function(c){(function(T,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(x&&x.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),Object.defineProperty(T,"prototype",{writable:!1}),x&&i(T,x)})(b,t);var p,m,S=M(b);function b(T){var x;return function(Q,G){if(!(Q instanceof G))throw new TypeError("Cannot call a class as a function")}(this,b),(x=S.call(this))._ua=T,x._request=null,x._closed=!1,x._direction=null,x._local_identity=null,x._remote_identity=null,x._is_replied=!1,x._data={},x}return p=b,(m=[{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"send",value:function(T,x){var Q=this,G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=T;if(T===void 0||x===void 0)throw new TypeError("Not enough arguments");if(!(T=this._ua.normalizeTarget(T)))throw new TypeError("Invalid target: ".concat(d));var f=_.cloneArray(G.extraHeaders),E=_.cloneObject(G.eventHandlers),w=G.contentType||"text/plain",D={};for(var O in G.fromUserName&&(D.from_uri=new y("sip",G.fromUserName,this._ua.configuration.uri.host),f.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),G.fromDisplayName&&(D.from_display_name=G.fromDisplayName),E)Object.prototype.hasOwnProperty.call(E,O)&&this.on(O,E[O]);f.push("Content-Type: ".concat(w)),this._request=new s.OutgoingRequest(R.MESSAGE,T,this._ua,D,f),x&&(this._request.body=x);var F=new a(this._ua,this._request,{onRequestTimeout:function(){Q._onRequestTimeout()},onTransportError:function(){Q._onTransportError()},onReceiveResponse:function(B){Q._receiveResponse(B)}});this._newMessage("local",this._request),F.send()}},{key:"init_incoming",value:function(T){this._request=T,this._newMessage("remote",T),this._is_replied||(this._is_replied=!0,T.reply(200)),this._close()}},{key:"accept",value:function(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=_.cloneArray(T.extraHeaders),Q=T.body;if(this._direction!=="incoming")throw new v.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,x,Q)}},{key:"reject",value:function(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=T.status_code||480,Q=T.reason_phrase,G=_.cloneArray(T.extraHeaders),d=T.body;if(this._direction!=="incoming")throw new v.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(x<300||x>=700)throw new TypeError("Invalid status_code: ".concat(x));this._is_replied=!0,this._request.reply(x,Q,G,d)}},{key:"_receiveResponse",value:function(T){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(T.status_code):break;case/^2[0-9]{2}$/.test(T.status_code):this._succeeded("remote",T);break;default:var x=_.sipErrorCause(T.status_code);this._failed("remote",T,x)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,R.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,R.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newMessage",value:function(T,x){T==="remote"?(this._direction="incoming",this._local_identity=x.to,this._remote_identity=x.from):T==="local"&&(this._direction="outgoing",this._local_identity=x.from,this._remote_identity=x.to),this._ua.newMessage(this,{originator:T,message:this,request:x})}},{key:"_failed",value:function(T,x,Q){C.debug("MESSAGE failed"),this._close(),C.debug('emit "failed"'),this.emit("failed",{originator:T,response:x||null,cause:Q})}},{key:"_succeeded",value:function(T,x){C.debug("MESSAGE succeeded"),this._close(),C.debug('emit "succeeded"'),this.emit("succeeded",{originator:T,response:x})}}])&&N(p.prototype,m),Object.defineProperty(p,"prototype",{writable:!1}),b}()},{"./Constants":2,"./Exceptions":6,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./URI":29,"./Utils":30,events:33}],11:[function(A,V,j){function L(M,q){for(var t=0;t<q.length;t++){var I=q[t];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(M,I.key,I)}}var N=A("./URI"),i=A("./Grammar");V.exports=function(){function M(R,s,_){if(function(v,y){if(!(v instanceof y))throw new TypeError("Cannot call a class as a function")}(this,M),!(R&&R instanceof N))throw new TypeError('missing or invalid "uri" parameter');for(var a in this._uri=R,this._parameters={},this.display_name=s,_)Object.prototype.hasOwnProperty.call(_,a)&&this.setParam(a,_[a])}var q,t,I;return q=M,I=[{key:"parse",value:function(R){return(R=i.parse(R,"Name_Addr_Header"))!==-1?R:void 0}}],(t=[{key:"uri",get:function(){return this._uri}},{key:"display_name",get:function(){return this._display_name},set:function(R){this._display_name=R===0?"0":R}},{key:"setParam",value:function(R,s){R&&(this._parameters[R.toLowerCase()]=s==null?null:s.toString())}},{key:"getParam",value:function(R){if(R)return this._parameters[R.toLowerCase()]}},{key:"hasParam",value:function(R){if(R)return!!this._parameters.hasOwnProperty(R.toLowerCase())}},{key:"deleteParam",value:function(R){if(R=R.toLowerCase(),this._parameters.hasOwnProperty(R)){var s=this._parameters[R];return delete this._parameters[R],s}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"clone",value:function(){return new M(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}},{key:"_quote",value:function(R){return R.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},{key:"toString",value:function(){var R=this._display_name?'"'.concat(this._quote(this._display_name),'" '):"";for(var s in R+="<".concat(this._uri.toString(),">"),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,s)&&(R+=";".concat(s),this._parameters[s]!==null&&(R+="=".concat(this._parameters[s])));return R}}])&&L(q.prototype,t),I&&L(q,I),Object.defineProperty(q,"prototype",{writable:!1}),M}()},{"./Grammar":7,"./URI":29}],12:[function(A,V,j){function L(C){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(C)}function N(C,c){for(var p=0;p<c.length;p++){var m=c[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(C,m.key,m)}}function i(C,c){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,m){return p.__proto__=m,p})(C,c)}function M(C){var c=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var p,m=t(C);if(c){var S=t(this).constructor;p=Reflect.construct(m,arguments,S)}else p=m.apply(this,arguments);return function(b,T){if(T&&(L(T)==="object"||typeof T=="function"))return T;if(T!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return q(b)}(this,p)}}function q(C){if(C===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}function t(C){return(t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)})(C)}var I=A("events").EventEmitter,R=A("./Logger"),s=A("./Constants"),_=A("./Utils"),a=A("./Dialog"),v=new R("Notifier"),y={NOTIFY_RESPONSE_TIMEOUT:0,NOTIFY_TRANSPORT_ERROR:1,NOTIFY_NON_OK_RESPONSE:2,NOTIFY_FAILED_AUTHENTICATION:3,SEND_FINAL_NOTIFY:4,RECEIVE_UNSUBSCRIBE:5,SUBSCRIPTION_EXPIRED:6,STATE_PENDING:0,STATE_ACTIVE:1,STATE_TERMINATED:2};V.exports=function(C){(function(T,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(x&&x.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),Object.defineProperty(T,"prototype",{writable:!1}),x&&i(T,x)})(b,I);var c,p,m,S=M(b);function b(T,x,Q,G){var d,f=G.extraHeaders,E=G.allowEvents,w=G.pending;if(function(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}(this,b),v.debug("new"),d=S.call(this),!x)throw new TypeError("subscribe is undefined");if(!Q)throw new TypeError("contentType is undefined");d._ua=T,d._initial_subscribe=x,d._expires_timestamp=null,d._expires_timer=null,d._state=w?y.STATE_PENDING:y.STATE_ACTIVE,d._terminated_reason=null,d._terminated_retry_after=null,d.data={},d._dialog=null;var D=x.getHeader("event");d._content_type=Q,d._expires=parseInt(x.getHeader("expires")),d._headers=_.cloneArray(f),d._headers.push("Event: ".concat(D)),d._contact=d._headers.find(function(F){return F.startsWith("Contact")}),d._contact||(d._contact="Contact: <sip:".concat(x.to.uri.user,"@").concat(_.createRandomToken(12),".invalid;transport=ws>"),d._headers.push(d._contact)),E&&d._headers.push("Allow-Events: ".concat(E)),d._target=x.from.uri.user,x.to_tag=_.newTag();var O=new a(q(d),x,"UAS");if(O.error)throw v.warn(O.error),new Error("SUBSCRIBE missed Contact");return d._dialog=O,d._expires>0&&d._setExpiresTimer(),d}return c=b,m=[{key:"C",get:function(){return y}}],(p=[{key:"C",get:function(){return y}},{key:"receiveRequest",value:function(T){if(T.method===s.SUBSCRIBE){var x=T.getHeader("expires");x==null&&(x="900",v.debug("Missed expires header. Set by default ".concat(x))),this._expires=parseInt(x),T.reply(200,null,["Expires: ".concat(this._expires),"".concat(this._contact)]);var Q=T.body,G=T.getHeader("content-type"),d=this._expires===0;d||this._setExpiresTimer(),v.debug('emit "subscribe"'),this.emit("subscribe",d,T,Q,G),d&&this._dialogTerminated(y.RECEIVE_UNSUBSCRIBE)}else T.reply(405)}},{key:"start",value:function(){v.debug("start()"),this.receiveRequest(this._initial_subscribe)}},{key:"setActiveState",value:function(){v.debug("setActiveState()"),this._state===y.STATE_PENDING&&(this._state=y.STATE_ACTIVE)}},{key:"notify",value:function(){var T=this,x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(v.debug("notify()"),this._dialog){var Q=this._stateNumberToString(this._state);if(this._state!==y.STATE_TERMINATED){var G=Math.floor((this._expires_timestamp-new Date().getTime())/1e3);G<0&&(G=0),Q+=";expires=".concat(G)}else this._terminated_reason&&(Q+=";reason=".concat(this._terminated_reason)),this._terminated_retry_after!==null&&(Q+=";retry-after=".concat(this._terminated_retry_after));var d=this._headers.slice();d.push("Subscription-State: ".concat(Q)),x&&d.push("Content-Type: ".concat(this._content_type)),this._dialog.sendRequest(s.NOTIFY,{body:x,extraHeaders:d,eventHandlers:{onRequestTimeout:function(){T._dialogTerminated(y.NOTIFY_RESPONSE_TIMEOUT)},onTransportError:function(){T._dialogTerminated(y.NOTIFY_TRANSPORT_ERROR)},onErrorResponse:function(f){f.status_code===401||f.status_code===407?T._dialogTerminated(y.NOTIFY_FAILED_AUTHENTICATION):T._dialogTerminated(y.NOTIFY_NON_OK_RESPONSE)},onDialogError:function(){T._dialogTerminated(y.NOTIFY_NON_OK_RESPONSE)}}})}else v.warn("final notify has sent")}},{key:"terminate",value:function(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;v.debug("terminate()"),this._state=y.STATE_TERMINATED,this._terminated_reason=x,this._terminated_retry_after=Q,this.notify(T),this._dialogTerminated(y.SEND_FINAL_NOTIFY)}},{key:"state",get:function(){return this._state}},{key:"id",get:function(){return this._dialog?this._dialog.id:null}},{key:"_dialogTerminated",value:function(T){if(this._dialog){this._state=y.STATE_TERMINATED,clearTimeout(this._expires_timer),this._dialog&&(this._dialog.terminate(),this._dialog=null);var x=T===y.SUBSCRIPTION_EXPIRED;v.debug('emit "terminated" code='.concat(T,", send final notify=").concat(x)),this.emit("terminated",T,x)}}},{key:"_setExpiresTimer",value:function(){var T=this;this._expires_timestamp=new Date().getTime()+1e3*this._expires,clearTimeout(this._expires_timer),this._expires_timer=setTimeout(function(){T._dialog&&(T._terminated_reason="timeout",T.notify(),T._dialogTerminated(y.SUBSCRIPTION_EXPIRED))},1e3*this._expires)}},{key:"_stateNumberToString",value:function(T){switch(T){case y.STATE_PENDING:return"pending";case y.STATE_ACTIVE:return"active";case y.STATE_TERMINATED:return"terminated";default:throw new TypeError("wrong state value")}}}])&&N(c.prototype,p),m&&N(c,m),Object.defineProperty(c,"prototype",{writable:!1}),b}()},{"./Constants":2,"./Dialog":3,"./Logger":9,"./Utils":30,events:33}],13:[function(A,V,j){function L(C){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(C)}function N(C,c){for(var p=0;p<c.length;p++){var m=c[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(C,m.key,m)}}function i(C,c){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,m){return p.__proto__=m,p})(C,c)}function M(C){var c=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var p,m=q(C);if(c){var S=q(this).constructor;p=Reflect.construct(m,arguments,S)}else p=m.apply(this,arguments);return function(b,T){if(T&&(L(T)==="object"||typeof T=="function"))return T;if(T!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(x){if(x===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x}(b)}(this,p)}}function q(C){return(q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)})(C)}var t=A("events").EventEmitter,I=A("./Logger"),R=A("./Constants"),s=A("./SIPMessage"),_=A("./Utils"),a=A("./RequestSender"),v=A("./Exceptions"),y=new I("Options");V.exports=function(C){(function(b,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function");b.prototype=Object.create(T&&T.prototype,{constructor:{value:b,writable:!0,configurable:!0}}),Object.defineProperty(b,"prototype",{writable:!1}),T&&i(b,T)})(S,t);var c,p,m=M(S);function S(b){var T;return function(x,Q){if(!(x instanceof Q))throw new TypeError("Cannot call a class as a function")}(this,S),(T=m.call(this))._ua=b,T._request=null,T._closed=!1,T._direction=null,T._local_identity=null,T._remote_identity=null,T._is_replied=!1,T._data={},T}return c=S,(p=[{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"send",value:function(b,T){var x=this,Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},G=b;if(b===void 0)throw new TypeError("A target is required for OPTIONS");if(!(b=this._ua.normalizeTarget(b)))throw new TypeError("Invalid target: ".concat(G));var d=_.cloneArray(Q.extraHeaders),f=_.cloneObject(Q.eventHandlers),E=Q.contentType||"application/sdp";for(var w in f)Object.prototype.hasOwnProperty.call(f,w)&&this.on(w,f[w]);d.push("Content-Type: ".concat(E)),this._request=new s.OutgoingRequest(R.OPTIONS,b,this._ua,null,d),T&&(this._request.body=T);var D=new a(this._ua,this._request,{onRequestTimeout:function(){x._onRequestTimeout()},onTransportError:function(){x._onTransportError()},onReceiveResponse:function(O){x._receiveResponse(O)}});this._newOptions("local",this._request),D.send()}},{key:"init_incoming",value:function(b){this._request=b,this._newOptions("remote",b),this._is_replied||(this._is_replied=!0,b.reply(200)),this._close()}},{key:"accept",value:function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},T=_.cloneArray(b.extraHeaders),x=b.body;if(this._direction!=="incoming")throw new v.NotSupportedError('"accept" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");this._is_replied=!0,this._request.reply(200,null,T,x)}},{key:"reject",value:function(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},T=b.status_code||480,x=b.reason_phrase,Q=_.cloneArray(b.extraHeaders),G=b.body;if(this._direction!=="incoming")throw new v.NotSupportedError('"reject" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");if(T<300||T>=700)throw new TypeError("Invalid status_code: ".concat(T));this._is_replied=!0,this._request.reply(T,x,Q,G)}},{key:"_receiveResponse",value:function(b){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(b.status_code):break;case/^2[0-9]{2}$/.test(b.status_code):this._succeeded("remote",b);break;default:var T=_.sipErrorCause(b.status_code);this._failed("remote",b,T)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,R.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,R.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newOptions",value:function(b,T){b==="remote"?(this._direction="incoming",this._local_identity=T.to,this._remote_identity=T.from):b==="local"&&(this._direction="outgoing",this._local_identity=T.from,this._remote_identity=T.to),this._ua.newOptions(this,{originator:b,message:this,request:T})}},{key:"_failed",value:function(b,T,x){y.debug("OPTIONS failed"),this._close(),y.debug('emit "failed"'),this.emit("failed",{originator:b,response:T||null,cause:x})}},{key:"_succeeded",value:function(b,T){y.debug("OPTIONS succeeded"),this._close(),y.debug('emit "succeeded"'),this.emit("succeeded",{originator:b,response:T})}}])&&N(c.prototype,p),Object.defineProperty(c,"prototype",{writable:!1}),S}()},{"./Constants":2,"./Exceptions":6,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./Utils":30,events:33}],14:[function(A,V,j){function L(s,_){var a=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!a){if(Array.isArray(s)||(a=function(m,S){if(m){if(typeof m=="string")return N(m,S);var b=Object.prototype.toString.call(m).slice(8,-1);if(b==="Object"&&m.constructor&&(b=m.constructor.name),b==="Map"||b==="Set")return Array.from(m);if(b==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return N(m,S)}}(s))||_){a&&(s=a);var v=0,y=function(){};return{s:y,n:function(){return v>=s.length?{done:!0}:{done:!1,value:s[v++]}},e:function(m){throw m},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C,c=!0,p=!1;return{s:function(){a=a.call(s)},n:function(){var m=a.next();return c=m.done,m},e:function(m){p=!0,C=m},f:function(){try{c||a.return==null||a.return()}finally{if(p)throw C}}}}function N(s,_){(_==null||_>s.length)&&(_=s.length);for(var a=0,v=new Array(_);a<_;a++)v[a]=s[a];return v}var i=A("./Logger"),M=A("./Grammar"),q=A("./SIPMessage"),t=new i("Parser");function I(s,_){var a=_,v=0,y=0;if(s.substring(a,a+2).match(/(^\r\n)/))return-2;for(;v===0;){if((y=s.indexOf(`\r
`,a))===-1)return y;!s.substring(y+2,y+4).match(/(^\r\n)/)&&s.charAt(y+2).match(/(^\s+)/)?a=y+2:v=y}return v}function R(s,_,a,v){var y,C=_.indexOf(":",a),c=_.substring(a,C).trim(),p=_.substring(C+1,v).trim();switch(c.toLowerCase()){case"via":case"v":s.addHeader("via",p),s.getHeaders("via").length===1?(y=s.parseHeader("Via"))&&(s.via=y,s.via_branch=y.branch):y=0;break;case"from":case"f":s.setHeader("from",p),(y=s.parseHeader("from"))&&(s.from=y,s.from_tag=y.getParam("tag"));break;case"to":case"t":s.setHeader("to",p),(y=s.parseHeader("to"))&&(s.to=y,s.to_tag=y.getParam("tag"));break;case"record-route":if((y=M.parse(p,"Record_Route"))===-1)y=void 0;else{var m,S=L(y);try{for(S.s();!(m=S.n()).done;){var b=m.value;s.addHeader("record-route",p.substring(b.possition,b.offset)),s.headers["Record-Route"][s.getHeaders("record-route").length-1].parsed=b.parsed}}catch(G){S.e(G)}finally{S.f()}}break;case"call-id":case"i":s.setHeader("call-id",p),(y=s.parseHeader("call-id"))&&(s.call_id=p);break;case"contact":case"m":if((y=M.parse(p,"Contact"))===-1)y=void 0;else{var T,x=L(y);try{for(x.s();!(T=x.n()).done;){var Q=T.value;s.addHeader("contact",p.substring(Q.possition,Q.offset)),s.headers.Contact[s.getHeaders("contact").length-1].parsed=Q.parsed}}catch(G){x.e(G)}finally{x.f()}}break;case"content-length":case"l":s.setHeader("content-length",p),y=s.parseHeader("content-length");break;case"content-type":case"c":s.setHeader("content-type",p),y=s.parseHeader("content-type");break;case"cseq":s.setHeader("cseq",p),(y=s.parseHeader("cseq"))&&(s.cseq=y.value),s instanceof q.IncomingResponse&&(s.method=y.method);break;case"max-forwards":s.setHeader("max-forwards",p),y=s.parseHeader("max-forwards");break;case"www-authenticate":s.setHeader("www-authenticate",p),y=s.parseHeader("www-authenticate");break;case"proxy-authenticate":s.setHeader("proxy-authenticate",p),y=s.parseHeader("proxy-authenticate");break;case"session-expires":case"x":s.setHeader("session-expires",p),(y=s.parseHeader("session-expires"))&&(s.session_expires=y.expires,s.session_expires_refresher=y.refresher);break;case"refer-to":case"r":s.setHeader("refer-to",p),(y=s.parseHeader("refer-to"))&&(s.refer_to=y);break;case"replaces":s.setHeader("replaces",p),(y=s.parseHeader("replaces"))&&(s.replaces=y);break;case"event":case"o":s.setHeader("event",p),(y=s.parseHeader("event"))&&(s.event=y);break;default:s.addHeader(c,p),y=0}return y!==void 0||{error:'error parsing header "'.concat(c,'"')}}j.parseMessage=function(s,_){var a,v,y=s.indexOf(`\r
`);if(y!==-1){var C=s.substring(0,y),c=M.parse(C,"Request_Response");if(c!==-1){c.status_code?((a=new q.IncomingResponse).status_code=c.status_code,a.reason_phrase=c.reason_phrase):((a=new q.IncomingRequest(_)).method=c.method,a.ruri=c.uri),a.data=s;for(var p=y+2;;){if((y=I(s,p))===-2){v=p+2;break}if(y===-1)return void t.warn("parseMessage() | malformed message");if((c=R(a,s,p,y))!==!0)return void t.warn("parseMessage() |",c.error);p=y+2}if(a.hasHeader("content-length")){var m=a.getHeader("content-length");a.body=s.substr(v,m)}else a.body=s.substring(v);return a}t.warn('parseMessage() | error parsing first line of SIP message: "'.concat(C,'"'))}else t.warn("parseMessage() | no CRLF found, not a SIP message")}},{"./Grammar":7,"./Logger":9,"./SIPMessage":22}],15:[function(A,V,j){function L(w){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D})(w)}function N(w,D){var O=typeof Symbol<"u"&&w[Symbol.iterator]||w["@@iterator"];if(!O){if(Array.isArray(w)||(O=function(k,P){if(k){if(typeof k=="string")return i(k,P);var W=Object.prototype.toString.call(k).slice(8,-1);if(W==="Object"&&k.constructor&&(W=k.constructor.name),W==="Map"||W==="Set")return Array.from(k);if(W==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(W))return i(k,P)}}(w))||D){O&&(w=O);var F=0,B=function(){};return{s:B,n:function(){return F>=w.length?{done:!0}:{done:!1,value:w[F++]}},e:function(k){throw k},f:B}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var $,l=!0,h=!1;return{s:function(){O=O.call(w)},n:function(){var k=O.next();return l=k.done,k},e:function(k){h=!0,$=k},f:function(){try{l||O.return==null||O.return()}finally{if(h)throw $}}}}function i(w,D){(D==null||D>w.length)&&(D=w.length);for(var O=0,F=new Array(D);O<D;O++)F[O]=w[O];return F}function M(w,D){for(var O=0;O<D.length;O++){var F=D[O];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(w,F.key,F)}}function q(w,D){return(q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(O,F){return O.__proto__=F,O})(w,D)}function t(w){var D=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var O,F=I(w);if(D){var B=I(this).constructor;O=Reflect.construct(F,arguments,B)}else O=F.apply(this,arguments);return function($,l){if(l&&(L(l)==="object"||typeof l=="function"))return l;if(l!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}($)}(this,O)}}function I(w){return(I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(D){return D.__proto__||Object.getPrototypeOf(D)})(w)}var R=A("events").EventEmitter,s=A("sdp-transform"),_=A("./Logger"),a=A("./Constants"),v=A("./Exceptions"),y=A("./Transactions"),C=A("./Utils"),c=A("./Timers"),p=A("./SIPMessage"),m=A("./Dialog"),S=A("./RequestSender"),b=A("./RTCSession/DTMF"),T=A("./RTCSession/Info"),x=A("./RTCSession/ReferNotifier"),Q=A("./RTCSession/ReferSubscriber"),G=A("./URI"),d=new _("RTCSession"),f={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},E=["audio","video"];V.exports=function(w){(function(l,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(h&&h.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),h&&q(l,h)})($,R);var D,O,F,B=t($);function $(l){var h;return function(k,P){if(!(k instanceof P))throw new TypeError("Cannot call a class as a function")}(this,$),d.debug("new"),(h=B.call(this))._id=null,h._ua=l,h._status=f.STATUS_NULL,h._dialog=null,h._earlyDialogs={},h._contact=null,h._from_tag=null,h._to_tag=null,h._connection=null,h._connectionPromiseQueue=Promise.resolve(),h._request=null,h._is_canceled=!1,h._cancel_reason="",h._is_confirmed=!1,h._late_sdp=!1,h._rtcOfferConstraints=null,h._rtcAnswerConstraints=null,h._localMediaStream=null,h._localMediaStreamLocallyGenerated=!1,h._rtcReady=!0,h._iceReady=!1,h._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},h._direction=null,h._local_identity=null,h._remote_identity=null,h._start_time=null,h._end_time=null,h._tones=null,h._audioMuted=!1,h._videoMuted=!1,h._localHold=!1,h._remoteHold=!1,h._sessionTimers={enabled:h._ua.configuration.session_timers,refreshMethod:h._ua.configuration.session_timers_refresh_method,defaultExpires:a.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},h._referSubscribers={},h._data={},h}return D=$,F=[{key:"C",get:function(){return f}}],(O=[{key:"C",get:function(){return f}},{key:"causes",get:function(){return a.causes}},{key:"id",get:function(){return this._id}},{key:"connection",get:function(){return this._connection}},{key:"contact",get:function(){return this._contact}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"start_time",get:function(){return this._start_time}},{key:"end_time",get:function(){return this._end_time}},{key:"data",get:function(){return this._data},set:function(l){this._data=l}},{key:"status",get:function(){return this._status}},{key:"isInProgress",value:function(){switch(this._status){case f.STATUS_NULL:case f.STATUS_INVITE_SENT:case f.STATUS_1XX_RECEIVED:case f.STATUS_INVITE_RECEIVED:case f.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}},{key:"isEstablished",value:function(){switch(this._status){case f.STATUS_ANSWERED:case f.STATUS_WAITING_FOR_ACK:case f.STATUS_CONFIRMED:return!0;default:return!1}}},{key:"isEnded",value:function(){switch(this._status){case f.STATUS_CANCELED:case f.STATUS_TERMINATED:return!0;default:return!1}}},{key:"isMuted",value:function(){return{audio:this._audioMuted,video:this._videoMuted}}},{key:"isOnHold",value:function(){return{local:this._localHold,remote:this._remoteHold}}},{key:"connect",value:function(l){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=arguments.length>2?arguments[2]:void 0;d.debug("connect()");var P=l,W=C.cloneObject(h.eventHandlers),K=C.cloneArray(h.extraHeaders),z=C.cloneObject(h.mediaConstraints,{audio:!0,video:!0}),ne=h.mediaStream||null,Z=C.cloneObject(h.pcConfig,{iceServers:[]}),X=h.rtcConstraints||null,ie=h.rtcOfferConstraints||null;if(this._rtcOfferConstraints=ie,this._rtcAnswerConstraints=h.rtcAnswerConstraints||null,this._data=h.data||this._data,l===void 0)throw new TypeError("Not enough arguments");if(this._status!==f.STATUS_NULL)throw new v.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new v.NotSupportedError("WebRTC not supported");if(!(l=this._ua.normalizeTarget(l)))throw new TypeError("Invalid target: ".concat(P));for(var ue in this._sessionTimers.enabled&&C.isDecimal(h.sessionTimersExpires)&&(h.sessionTimersExpires>=a.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=h.sessionTimersExpires:this._sessionTimers.defaultExpires=a.SESSION_EXPIRES),W)Object.prototype.hasOwnProperty.call(W,ue)&&this.on(ue,W[ue]);this._from_tag=C.newTag();var de=h.anonymous||!1,ye={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:de,outbound:!0}),de?(ye.from_display_name="Anonymous",ye.from_uri=new G("sip","anonymous","anonymous.invalid"),K.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())),K.push("Privacy: id")):h.fromUserName&&(ye.from_uri=new G("sip",h.fromUserName,this._ua.configuration.uri.host),K.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),h.fromDisplayName&&(ye.from_display_name=h.fromDisplayName),K.push("Contact: ".concat(this._contact)),K.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&K.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher?";refresher=uac":"")),this._request=new p.InitialOutgoingInviteRequest(l,this._ua,ye,K),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(Z,X),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,k&&k(this),this._newRTCSession("local",this._request),this._sendInitialRequest(z,ie,ne)}},{key:"init_incoming",value:function(l,h){var k,P=this;d.debug("init_incoming()");var W=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0;if(l.body&&W!=="application/sdp")l.reply(415);else if(this._status=f.STATUS_INVITE_RECEIVED,this._from_tag=l.from_tag,this._id=l.call_id+this._from_tag,this._request=l,this._contact=this._ua.contact.toString(),l.hasHeader("expires")&&(k=1e3*l.getHeader("expires")),l.to_tag=C.newTag(),this._createDialog(l,"UAS",!0)){if(l.body?this._late_sdp=!1:this._late_sdp=!0,this._status=f.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(function(){l.reply(408),P._failed("local",null,a.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),k&&(this._timers.expiresTimer=setTimeout(function(){P._status===f.STATUS_WAITING_FOR_ANSWER&&(l.reply(487),P._failed("system",null,a.causes.EXPIRES))},k)),this._direction="incoming",this._local_identity=l.to,this._remote_identity=l.from,h&&h(this),this._newRTCSession("remote",l),this._status!==f.STATUS_TERMINATED){var K=["Contact: ".concat(this._contact)],z=this._ua.modes.ringing_header_mode;z!==void 0&&(Array.isArray(z)?K=K.concat(z):K.push(z)),l.reply(180,null,K),this._progress("local",null)}}else l.reply(500,"Missing Contact header field")}},{key:"answer",value:function(){var l=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d.debug("answer()");var k=this._request,P=C.cloneArray(h.extraHeaders),W=C.cloneObject(h.mediaConstraints),K=h.mediaStream||null,z=C.cloneObject(h.pcConfig,{iceServers:[]}),ne=h.rtcConstraints||null,Z=h.rtcAnswerConstraints||null,X=C.cloneObject(h.rtcOfferConstraints),ie=!1,ue=!1,de=!1,ye=!1;if(this._rtcAnswerConstraints=Z,this._rtcOfferConstraints=h.rtcOfferConstraints||null,this._data=h.data||this._data,this._direction!=="incoming")throw new v.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==f.STATUS_WAITING_FOR_ANSWER)throw new v.InvalidStateError(this._status);if(this._sessionTimers.enabled&&C.isDecimal(h.sessionTimersExpires)&&(h.sessionTimersExpires>=a.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=h.sessionTimersExpires:this._sessionTimers.defaultExpires=a.SESSION_EXPIRES),this._status=f.STATUS_ANSWERED,this._createDialog(k,"UAS")){clearTimeout(this._timers.userNoAnswerTimer),P.unshift("Contact: ".concat(this._contact));var Ee=k.parseSDP();Array.isArray(Ee.media)||(Ee.media=[Ee.media]);var xe,Oe=N(Ee.media);try{for(Oe.s();!(xe=Oe.n()).done;){var Se=xe.value;Se.type==="audio"&&(ie=!0,Se.direction&&Se.direction!=="sendrecv"||(de=!0)),Se.type==="video"&&(ue=!0,Se.direction&&Se.direction!=="sendrecv"||(ye=!0))}}catch(ce){Oe.e(ce)}finally{Oe.f()}if(K&&W.audio===!1){var Ue,Ne=N(K.getAudioTracks());try{for(Ne.s();!(Ue=Ne.n()).done;){var tt=Ue.value;K.removeTrack(tt)}}catch(ce){Ne.e(ce)}finally{Ne.f()}}if(K&&W.video===!1){var nt,He=N(K.getVideoTracks());try{for(He.s();!(nt=He.n()).done;){var Ke=nt.value;K.removeTrack(Ke)}}catch(ce){He.e(ce)}finally{He.f()}}K||W.audio!==void 0||(W.audio=de),K||W.video!==void 0||(W.video=ye),K||ie||X.offerToReceiveAudio||(W.audio=!1),K||ue||X.offerToReceiveVideo||(W.video=!1),this._createRTCConnection(z,ne),Promise.resolve().then(function(){return K||(W.audio||W.video?(l._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(W).catch(function(ce){throw l._status===f.STATUS_TERMINATED?new Error("terminated"):(k.reply(480),l._failed("local",null,a.causes.USER_DENIED_MEDIA_ACCESS),d.warn('emit "getusermediafailed" [error:%o]',ce),l.emit("getusermediafailed",ce),new Error("getUserMedia() failed"))})):void 0)}).then(function(ce){if(l._status===f.STATUS_TERMINATED)throw new Error("terminated");l._localMediaStream=ce,ce&&ce.getTracks().forEach(function(Fe){l._connection.addTrack(Fe,ce)})}).then(function(){if(!l._late_sdp){var ce={originator:"remote",type:"offer",sdp:k.body};d.debug('emit "sdp"'),l.emit("sdp",ce);var Fe=new RTCSessionDescription({type:"offer",sdp:ce.sdp});return l._connectionPromiseQueue=l._connectionPromiseQueue.then(function(){return l._connection.setRemoteDescription(Fe)}).catch(function(rt){throw k.reply(488),l._failed("system",null,a.causes.WEBRTC_ERROR),d.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',rt),l.emit("peerconnection:setremotedescriptionfailed",rt),new Error("peerconnection.setRemoteDescription() failed")}),l._connectionPromiseQueue}}).then(function(){if(l._status===f.STATUS_TERMINATED)throw new Error("terminated");return l._connecting(k),l._late_sdp?l._createLocalDescription("offer",l._rtcOfferConstraints).catch(function(){throw k.reply(500),new Error("_createLocalDescription() failed")}):l._createLocalDescription("answer",Z).catch(function(){throw k.reply(500),new Error("_createLocalDescription() failed")})}).then(function(ce){if(l._status===f.STATUS_TERMINATED)throw new Error("terminated");l._handleSessionTimersInIncomingRequest(k,P),k.reply(200,null,P,ce,function(){l._status=f.STATUS_WAITING_FOR_ACK,l._setInvite2xxTimer(k,ce),l._setACKTimer(),l._accepted("local")},function(){l._failed("system",null,a.causes.CONNECTION_ERROR)})}).catch(function(ce){l._status!==f.STATUS_TERMINATED&&d.warn(ce)})}else k.reply(500,"Error creating dialog")}},{key:"terminate",value:function(){var l=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d.debug("terminate()");var k,P=h.cause||a.causes.BYE,W=C.cloneArray(h.extraHeaders),K=h.body,z=h.status_code,ne=h.reason_phrase;if(this._status===f.STATUS_TERMINATED)throw new v.InvalidStateError(this._status);switch(this._status){case f.STATUS_NULL:case f.STATUS_INVITE_SENT:case f.STATUS_1XX_RECEIVED:if(d.debug("canceling session"),z&&(z<200||z>=700))throw new TypeError("Invalid status_code: ".concat(z));z&&(ne=ne||a.REASON_PHRASE[z]||"",k="SIP ;cause=".concat(z,' ;text="').concat(ne,'"')),this._status===f.STATUS_NULL||this._status===f.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=k):this._status===f.STATUS_1XX_RECEIVED&&this._request.cancel(k),this._status=f.STATUS_CANCELED,this._failed("local",null,a.causes.CANCELED);break;case f.STATUS_WAITING_FOR_ANSWER:case f.STATUS_ANSWERED:if(d.debug("rejecting session"),(z=z||480)<300||z>=700)throw new TypeError("Invalid status_code: ".concat(z));this._request.reply(z,ne,W,K),this._failed("local",null,a.causes.REJECTED);break;case f.STATUS_WAITING_FOR_ACK:case f.STATUS_CONFIRMED:if(d.debug("terminating session"),ne=h.reason_phrase||a.REASON_PHRASE[z]||"",z&&(z<200||z>=700))throw new TypeError("Invalid status_code: ".concat(z));if(z&&W.push("Reason: SIP ;cause=".concat(z,'; text="').concat(ne,'"')),this._status===f.STATUS_WAITING_FOR_ACK&&this._direction==="incoming"&&this._request.server_transaction.state!==y.C.STATUS_TERMINATED){var Z=this._dialog;this.receiveRequest=function(X){X.method===a.ACK&&(l.sendRequest(a.BYE,{extraHeaders:W,body:K}),Z.terminate())},this._request.server_transaction.on("stateChanged",function(){l._request.server_transaction.state===y.C.STATUS_TERMINATED&&(l.sendRequest(a.BYE,{extraHeaders:W,body:K}),Z.terminate())}),this._ended("local",null,P),this._dialog=Z,this._ua.newDialog(Z)}else this.sendRequest(a.BYE,{extraHeaders:W,body:K}),this._ended("local",null,P)}}},{key:"sendDTMF",value:function(l){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};d.debug("sendDTMF() | tones: %s",l);var k=0,P=h.duration||null,W=h.interToneGap||null,K=h.transportType||a.DTMF_TRANSPORT.INFO;if(l===void 0)throw new TypeError("Not enough arguments");if(this._status!==f.STATUS_CONFIRMED&&this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_1XX_RECEIVED)throw new v.InvalidStateError(this._status);if(K!==a.DTMF_TRANSPORT.INFO&&K!==a.DTMF_TRANSPORT.RFC2833)throw new TypeError("invalid transportType: ".concat(K));if(typeof l=="number"&&(l=l.toString()),!l||typeof l!="string"||!l.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: ".concat(l));if(P&&!C.isDecimal(P))throw new TypeError("Invalid tone duration: ".concat(P));if(P?P<b.C.MIN_DURATION?(d.debug('"duration" value is lower than the minimum allowed, setting it to '.concat(b.C.MIN_DURATION," milliseconds")),P=b.C.MIN_DURATION):P>b.C.MAX_DURATION?(d.debug('"duration" value is greater than the maximum allowed, setting it to '.concat(b.C.MAX_DURATION," milliseconds")),P=b.C.MAX_DURATION):P=Math.abs(P):P=b.C.DEFAULT_DURATION,h.duration=P,W&&!C.isDecimal(W))throw new TypeError("Invalid interToneGap: ".concat(W));if(W?W<b.C.MIN_INTER_TONE_GAP?(d.debug('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(b.C.MIN_INTER_TONE_GAP," milliseconds")),W=b.C.MIN_INTER_TONE_GAP):W=Math.abs(W):W=b.C.DEFAULT_INTER_TONE_GAP,K!==a.DTMF_TRANSPORT.RFC2833)this._tones?this._tones+=l:(this._tones=l,(function ne(){var Z=this,X;if(this._status===f.STATUS_TERMINATED||!this._tones||k>=this._tones.length)return void(this._tones=null);var ie=this._tones[k];if(k+=1,ie===",")X=2e3;else{var ue=new b(this);h.eventHandlers={onFailed:function(){Z._tones=null}},ue.send(ie,h),X=P+W}setTimeout(ne.bind(this),X)}).call(this));else{var z=this._getDTMFRTPSender();z&&(l=z.toneBuffer+l,z.insertDTMF(l,P,W))}}},{key:"sendInfo",value:function(l,h){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(d.debug("sendInfo()"),this._status!==f.STATUS_CONFIRMED&&this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_1XX_RECEIVED)throw new v.InvalidStateError(this._status);new T(this).send(l,h,k)}},{key:"mute",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{audio:!0,video:!1};d.debug("mute()");var h=!1,k=!1;this._audioMuted===!1&&l.audio&&(h=!0,this._audioMuted=!0,this._toggleMuteAudio(!0)),this._videoMuted===!1&&l.video&&(k=!0,this._videoMuted=!0,this._toggleMuteVideo(!0)),h!==!0&&k!==!0||this._onmute({audio:h,video:k})}},{key:"unmute",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{audio:!0,video:!0};d.debug("unmute()");var h=!1,k=!1;this._audioMuted===!0&&l.audio&&(h=!0,this._audioMuted=!1,this._localHold===!1&&this._toggleMuteAudio(!1)),this._videoMuted===!0&&l.video&&(k=!0,this._videoMuted=!1,this._localHold===!1&&this._toggleMuteVideo(!1)),h!==!0&&k!==!0||this._onunmute({audio:h,video:k})}},{key:"hold",value:function(){var l=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=arguments.length>1?arguments[1]:void 0;if(d.debug("hold()"),this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_CONFIRMED||this._localHold===!0||!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");var P={succeeded:function(){k&&k()},failed:function(){l.terminate({cause:a.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return h.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:P,extraHeaders:h.extraHeaders}):this._sendReinvite({eventHandlers:P,extraHeaders:h.extraHeaders}),!0}},{key:"unhold",value:function(){var l=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=arguments.length>1?arguments[1]:void 0;if(d.debug("unhold()"),this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_CONFIRMED||this._localHold===!1||!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");var P={succeeded:function(){k&&k()},failed:function(){l.terminate({cause:a.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return h.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:P,extraHeaders:h.extraHeaders}):this._sendReinvite({eventHandlers:P,extraHeaders:h.extraHeaders}),!0}},{key:"renegotiate",value:function(){var l=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},k=arguments.length>1?arguments[1]:void 0;d.debug("renegotiate()");var P=h.rtcOfferConstraints||null;if(this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_CONFIRMED||!this._isReadyToReOffer())return!1;var W={succeeded:function(){k&&k()},failed:function(){l.terminate({cause:a.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),h.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:W,rtcOfferConstraints:P,extraHeaders:h.extraHeaders}):this._sendReinvite({eventHandlers:W,rtcOfferConstraints:P,extraHeaders:h.extraHeaders}),!0}},{key:"refer",value:function(l,h){var k=this;d.debug("refer()");var P=l;if(this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_CONFIRMED)return!1;if(!(l=this._ua.normalizeTarget(l)))throw new TypeError("Invalid target: ".concat(P));var W=new Q(this);W.sendRefer(l,h);var K=W.id;return this._referSubscribers[K]=W,W.on("requestFailed",function(){delete k._referSubscribers[K]}),W.on("accepted",function(){delete k._referSubscribers[K]}),W.on("failed",function(){delete k._referSubscribers[K]}),W}},{key:"sendRequest",value:function(l,h){return d.debug("sendRequest()"),this._dialog.sendRequest(l,h)}},{key:"receiveRequest",value:function(l){var h=this;if(d.debug("receiveRequest()"),l.method===a.CANCEL)this._status!==f.STATUS_WAITING_FOR_ANSWER&&this._status!==f.STATUS_ANSWERED||(this._status=f.STATUS_CANCELED,this._request.reply(487),this._failed("remote",l,a.causes.CANCELED));else switch(l.method){case a.ACK:if(this._status!==f.STATUS_WAITING_FOR_ACK)return;if(this._status=f.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!l.body){this.terminate({cause:a.causes.MISSING_SDP,status_code:400});break}var k={originator:"remote",type:"answer",sdp:l.body};d.debug('emit "sdp"'),this.emit("sdp",k);var P=new RTCSessionDescription({type:"answer",sdp:k.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return h._connection.setRemoteDescription(P)}).then(function(){h._is_confirmed||h._confirmed("remote",l)}).catch(function(z){h.terminate({cause:a.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),d.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',z),h.emit("peerconnection:setremotedescriptionfailed",z)})}else this._is_confirmed||this._confirmed("remote",l);break;case a.BYE:this._status===f.STATUS_CONFIRMED||this._status===f.STATUS_WAITING_FOR_ACK?(l.reply(200),this._ended("remote",l,a.causes.BYE)):this._status===f.STATUS_INVITE_RECEIVED||this._status===f.STATUS_WAITING_FOR_ANSWER?(l.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",l,a.causes.BYE)):l.reply(403,"Wrong Status");break;case a.INVITE:this._status===f.STATUS_CONFIRMED?l.hasHeader("replaces")?this._receiveReplaces(l):this._receiveReinvite(l):l.reply(403,"Wrong Status");break;case a.INFO:if(this._status===f.STATUS_1XX_RECEIVED||this._status===f.STATUS_WAITING_FOR_ANSWER||this._status===f.STATUS_ANSWERED||this._status===f.STATUS_WAITING_FOR_ACK||this._status===f.STATUS_CONFIRMED){var W=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0;W&&W.match(/^application\/dtmf-relay/i)?new b(this).init_incoming(l):W!==void 0?new T(this).init_incoming(l):l.reply(415)}else l.reply(403,"Wrong Status");break;case a.UPDATE:this._status===f.STATUS_CONFIRMED?this._receiveUpdate(l):l.reply(403,"Wrong Status");break;case a.REFER:this._status===f.STATUS_CONFIRMED?this._receiveRefer(l):l.reply(403,"Wrong Status");break;case a.NOTIFY:var K={event:l.event,request:l,taken:!1};if(this.emit("sipEvent",K),K.taken){l.reply(200);break}this._status===f.STATUS_CONFIRMED?this._receiveNotify(l):l.reply(403,"Wrong Status");break;default:l.reply(501)}}},{key:"onTransportError",value:function(){d.warn("onTransportError()"),this._status!==f.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:a.causes.CONNECTION_ERROR,cause:a.causes.CONNECTION_ERROR})}},{key:"onRequestTimeout",value:function(){d.warn("onRequestTimeout()"),this._status!==f.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:a.causes.REQUEST_TIMEOUT,cause:a.causes.REQUEST_TIMEOUT})}},{key:"onDialogError",value:function(){d.warn("onDialogError()"),this._status!==f.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:a.causes.DIALOG_ERROR,cause:a.causes.DIALOG_ERROR})}},{key:"newDTMF",value:function(l){d.debug("newDTMF()"),this.emit("newDTMF",l)}},{key:"newInfo",value:function(l){d.debug("newInfo()"),this.emit("newInfo",l)}},{key:"_isReadyToReOffer",value:function(){return this._rtcReady?this._dialog?this._dialog.uac_pending_reply!==!0&&this._dialog.uas_pending_reply!==!0||(d.debug("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(d.debug("_isReadyToReOffer() | session not established yet"),!1):(d.debug("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}},{key:"_close",value:function(){if(d.debug("close()"),this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(d.debug("close() | closing local MediaStream"),C.closeMediaStream(this._localMediaStream)),this._status!==f.STATUS_TERMINATED){if(this._status=f.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(P){d.warn("close() | error closing the RTCPeerConnection: %o",P)}for(var l in this._timers)Object.prototype.hasOwnProperty.call(this._timers,l)&&clearTimeout(this._timers[l]);for(var h in clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog),this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,h)&&(this._earlyDialogs[h].terminate(),delete this._earlyDialogs[h]);for(var k in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,k)&&delete this._referSubscribers[k];this._ua.destroyRTCSession(this)}}},{key:"_setInvite2xxTimer",value:function(l,h){var k=c.T1;this._timers.invite2xxTimer=setTimeout((function P(){this._status===f.STATUS_WAITING_FOR_ACK&&(l.reply(200,null,["Contact: ".concat(this._contact)],h),k<c.T2&&(k*=2)>c.T2&&(k=c.T2),this._timers.invite2xxTimer=setTimeout(P.bind(this),k))}).bind(this),k)}},{key:"_setACKTimer",value:function(){var l=this;this._timers.ackTimer=setTimeout(function(){l._status===f.STATUS_WAITING_FOR_ACK&&(d.debug("no ACK received, terminating the session"),clearTimeout(l._timers.invite2xxTimer),l.sendRequest(a.BYE),l._ended("remote",null,a.causes.NO_ACK))},c.TIMER_H)}},{key:"_createRTCConnection",value:function(l,h){var k=this;this._connection=new RTCPeerConnection(l,h),this._connection.addEventListener("iceconnectionstatechange",function(){var P=k._connection.iceConnectionState;if(P==="failed"&&k.terminate({cause:a.causes.RTP_TIMEOUT,status_code:408,reason_phrase:a.causes.RTP_TIMEOUT}),k._ua.modes.chrome_rtp_timeout_fix!==void 0&&navigator.webkitGetUserMedia&&P==="disconnected"){var W=k._ua.modes.chrome_rtp_timeout_fix;d.debug("AC: Chrome RTP timeout fix: iceConnectionState==disconnected: check that this will continue for ".concat(W," seconds...")),function K(){k._connection.iceConnectionState==="disconnected"?W-- >0?setTimeout(function(){return K()},1e3):(d.debug("AC: Chrome RTP timeout fix: Hangup call"),k.terminate({cause:a.causes.RTP_TIMEOUT,status_code:408,reason_phrase:a.causes.RTP_TIMEOUT})):d.debug("AC: Chrome RTP timeout fix: iceConnectionState=".concat(k._connection.iceConnectionState))}()}}),d.debug('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}},{key:"_createLocalDescription",value:function(l,h){var k=this;if(d.debug("createLocalDescription()"),l!=="offer"&&l!=="answer")throw new Error('createLocalDescription() | invalid type "'.concat(l,'"'));var P=this._connection;return this._rtcReady=!1,Promise.resolve().then(function(){return l==="offer"?P.createOffer(h).catch(function(W){return d.warn('emit "peerconnection:createofferfailed" [error:%o]',W),k.emit("peerconnection:createofferfailed",W),Promise.reject(W)}):P.createAnswer(h).catch(function(W){return d.warn('emit "peerconnection:createanswerfailed" [error:%o]',W),k.emit("peerconnection:createanswerfailed",W),Promise.reject(W)})}).then(function(W){return P.setLocalDescription(W).catch(function(K){return k._rtcReady=!0,d.warn('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',K),k.emit("peerconnection:setlocaldescriptionfailed",K),Promise.reject(K)})}).then(function(){var W=h&&h.iceRestart;if(P.iceGatheringState==="complete"&&!W||P.iceGatheringState==="gathering"&&k._iceReady){k._rtcReady=!0;var K={originator:"local",type:l,sdp:P.localDescription.sdp};return d.debug('emit "sdp"'),k.emit("sdp",K),Promise.resolve(K.sdp)}return new Promise(function(z){var ne,Z,X=!1;k._iceReady=!1;var ie=function(){P.removeEventListener("icecandidate",ne),P.removeEventListener("icegatheringstatechange",Z),X=!0,k._rtcReady=!0,k._iceReady=!0;var ue={originator:"local",type:l,sdp:P.localDescription.sdp};d.debug('emit "sdp"'),k.emit("sdp",ue),z(ue.sdp)};P.addEventListener("icecandidate",ne=function(ue){var de=ue.candidate;de?k.emit("icecandidate",{candidate:de,ready:ie}):X||ie()}),P.addEventListener("icegatheringstatechange",Z=function(){P.iceGatheringState!=="complete"||X||ie()}),k._ua.modes.ice_timeout_fix!==void 0&&setTimeout(function(){X||(d.debug("AC: ICE gathering timeout fix"),ie())},k._ua.modes.ice_timeout_fix)})})}},{key:"_createDialog",value:function(l,h,k){var P=h==="UAS"?l.to_tag:l.from_tag,W=h==="UAS"?l.from_tag:l.to_tag,K=l.call_id+P+W,z=this._earlyDialogs[K];if(k)return!!z||((z=new m(this,l,h,m.C.STATUS_EARLY)).error?(d.debug(z.error),this._failed("remote",l,a.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[K]=z,!0));if(this._from_tag=l.from_tag,this._to_tag=l.to_tag,z)return z.update(l,h),this._dialog=z,delete this._earlyDialogs[K],!0;var ne=new m(this,l,h);return ne.error?(d.debug(ne.error),this._failed("remote",l,a.causes.INTERNAL_ERROR),!1):(this._dialog=ne,!0)}},{key:"_receiveReinvite",value:function(l){var h=this;d.debug("receiveReinvite()");var k=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0,P={request:l,callback:void 0,reject:(function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W=!0;var ne=z.status_code||403,Z=z.reason_phrase||"",X=C.cloneArray(z.extraHeaders);if(this._status!==f.STATUS_CONFIRMED)return!1;if(ne<300||ne>=700)throw new TypeError("Invalid status_code: ".concat(ne));l.reply(ne,Z,X)}).bind(this)},W=!1;if(this.emit("reinvite",P),!W){if(this._late_sdp=!1,!l.body)return this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),void(this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return h._createLocalDescription("offer",h._rtcOfferConstraints)}).then(function(z){K.call(h,z)}).catch(function(){l.reply(500)}));if(k!=="application/sdp")return d.debug("invalid Content-Type"),void l.reply(415);this._processInDialogSdpOffer(l).then(function(z){h._status!==f.STATUS_TERMINATED&&K.call(h,z)}).catch(function(z){d.warn(z)})}function K(z){var ne=this,Z=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(l,Z),this._late_sdp&&(z=this._mangleOffer(z)),l.reply(200,null,Z,z,function(){ne._status=f.STATUS_WAITING_FOR_ACK,ne._setInvite2xxTimer(l,z),ne._setACKTimer()}),typeof P.callback=="function"&&P.callback()}}},{key:"_receiveUpdate",value:function(l){var h=this;d.debug("receiveUpdate()");var k=l.hasHeader("Content-Type")?l.getHeader("Content-Type").toLowerCase():void 0,P={request:l,callback:void 0,reject:(function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};W=!0;var ne=z.status_code||403,Z=z.reason_phrase||"",X=C.cloneArray(z.extraHeaders);if(this._status!==f.STATUS_CONFIRMED)return!1;if(ne<300||ne>=700)throw new TypeError("Invalid status_code: ".concat(ne));l.reply(ne,Z,X)}).bind(this)},W=!1;if(this.emit("update",P),!W)if(l.body){if(k!=="application/sdp")return d.debug("invalid Content-Type"),void l.reply(415);this._processInDialogSdpOffer(l).then(function(z){h._status!==f.STATUS_TERMINATED&&K.call(h,z)}).catch(function(z){d.warn(z)})}else K.call(this,null);function K(z){var ne=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(l,ne),l.reply(200,null,ne,z),typeof P.callback=="function"&&P.callback()}}},{key:"_processInDialogSdpOffer",value:function(l){var h=this;d.debug("_processInDialogSdpOffer()");var k,P=l.parseSDP(),W=!1,K=N(P.media);try{for(K.s();!(k=K.n()).done;){var z=k.value;if(E.indexOf(z.type)!==-1){var ne=z.direction||P.direction||"sendrecv";if(ne!=="sendonly"&&ne!=="inactive"){W=!1;break}W=!0}}}catch(ie){K.e(ie)}finally{K.f()}var Z={originator:"remote",type:"offer",sdp:l.body};d.debug('emit "sdp"'),this.emit("sdp",Z);var X=new RTCSessionDescription({type:"offer",sdp:Z.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(h._status===f.STATUS_TERMINATED)throw new Error("terminated");return h._connection.setRemoteDescription(X).catch(function(ie){throw l.reply(488),d.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',ie),h.emit("peerconnection:setremotedescriptionfailed",ie),ie})}).then(function(){if(h._status===f.STATUS_TERMINATED)throw new Error("terminated");h._remoteHold===!0&&W===!1?(h._remoteHold=!1,h._onunhold("remote")):h._remoteHold===!1&&W===!0&&(h._remoteHold=!0,h._onhold("remote"))}).then(function(){if(h._status===f.STATUS_TERMINATED)throw new Error("terminated");return h._createLocalDescription("answer",h._rtcAnswerConstraints).catch(function(ie){throw l.reply(500),d.warn('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',ie),ie})}).catch(function(ie){d.warn("_processInDialogSdpOffer() failed [error: %o]",ie)}),this._connectionPromiseQueue}},{key:"_receiveRefer",value:function(l){var h=this;if(d.debug("receiveRefer()"),!l.refer_to)return d.debug("no Refer-To header field present in REFER"),void l.reply(400);if(l.refer_to.uri.scheme!==a.SIP)return d.debug("Refer-To header field points to a non-SIP URI scheme"),void l.reply(416);l.reply(202);var k=new x(this,l.cseq);d.debug('emit "refer"'),this.emit("refer",{request:l,accept:function(P,W){(function(K){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(K=typeof K=="function"?K:null,this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_CONFIRMED)return!1;var ne=new $(this._ua);if(ne.on("progress",function(X){var ie=X.response;k.notify(ie.status_code,ie.reason_phrase)}),ne.on("accepted",function(X){var ie=X.response;k.notify(ie.status_code,ie.reason_phrase)}),ne.on("_failed",function(X){var ie=X.message,ue=X.cause;ie?k.notify(ie.status_code,ie.reason_phrase):k.notify(487,ue)}),l.refer_to.uri.hasHeader("replaces")){var Z=decodeURIComponent(l.refer_to.uri.getHeader("replaces"));z.extraHeaders=C.cloneArray(z.extraHeaders),z.extraHeaders.push("Replaces: ".concat(Z))}ne.connect(l.refer_to.uri.toAor(),z,K)}).call(h,P,W)},reject:function(){(function(){k.notify(603)}).call(h)}})}},{key:"_receiveNotify",value:function(l){switch(d.debug("receiveNotify()"),l.event||l.reply(400),l.event.event){case"refer":var h,k;if(l.event.params&&l.event.params.id)h=l.event.params.id,k=this._referSubscribers[h];else{if(Object.keys(this._referSubscribers).length!==1)return void l.reply(400,"Missing event id parameter");k=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}if(!k)return void l.reply(481,"Subscription does not exist");k.receiveNotify(l),l.reply(200);break;default:l.reply(489)}}},{key:"_receiveReplaces",value:function(l){var h=this;d.debug("receiveReplaces()"),this.emit("replaces",{request:l,accept:function(k){(function(P){var W=this;if(this._status!==f.STATUS_WAITING_FOR_ACK&&this._status!==f.STATUS_CONFIRMED)return!1;var K=new $(this._ua);K.on("confirmed",function(){W.terminate()}),K.init_incoming(l,P)}).call(h,k)},reject:function(){(function(){d.debug("Replaced INVITE rejected by the user"),l.reply(486)}).call(h)}})}},{key:"_sendInitialRequest",value:function(l,h,k){var P=this,W=new S(this._ua,this._request,{onRequestTimeout:function(){P.onRequestTimeout()},onTransportError:function(){P.onTransportError()},onAuthenticated:function(K){P._request=K},onReceiveResponse:function(K){P._receiveInviteResponse(K)}});Promise.resolve().then(function(){return k||(l.audio||l.video?(P._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(l).catch(function(K){throw P._status===f.STATUS_TERMINATED?new Error("terminated"):(P._failed("local",null,a.causes.USER_DENIED_MEDIA_ACCESS),d.warn('emit "getusermediafailed" [error:%o]',K),P.emit("getusermediafailed",K),K)})):void 0)}).then(function(K){if(P._status===f.STATUS_TERMINATED)throw new Error("terminated");return P._localMediaStream=K,K&&K.getTracks().forEach(function(z){P._connection.addTrack(z,K)}),P._connecting(P._request),P._createLocalDescription("offer",h).catch(function(z){throw P._failed("local",null,a.causes.WEBRTC_ERROR),z})}).then(function(K){if(P._is_canceled||P._status===f.STATUS_TERMINATED)throw new Error("terminated");P._request.body=K,P._status=f.STATUS_INVITE_SENT,d.debug('emit "sending" [request:%o]',P._request),P.emit("sending",{request:P._request}),W.send()}).catch(function(K){P._status!==f.STATUS_TERMINATED&&d.warn(K)})}},{key:"_getDTMFRTPSender",value:function(){var l=this._connection.getSenders().find(function(h){return h.track&&h.track.kind==="audio"});if(l&&l.dtmf)return l.dtmf;d.warn("sendDTMF() | no local audio track to send DTMF with")}},{key:"_receiveInviteResponse",value:function(l){var h=this;if(d.debug("receiveInviteResponse()"),this._dialog&&l.status_code>=200&&l.status_code<=299){if(this._dialog.id.call_id===l.call_id&&this._dialog.id.local_tag===l.from_tag&&this._dialog.id.remote_tag===l.to_tag)return void this.sendRequest(a.ACK);var k=new m(this,l,"UAC");return k.error!==void 0?void d.debug(k.error):(this.sendRequest(a.ACK),void this.sendRequest(a.BYE))}if(this._is_canceled)l.status_code>=100&&l.status_code<200?this._request.cancel(this._cancel_reason):l.status_code>=200&&l.status_code<299&&this._acceptAndTerminate(l);else if(this._status===f.STATUS_INVITE_SENT||this._status===f.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(l.status_code):this._status=f.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(l.status_code):if(!l.to_tag){d.debug("1xx response received without to tag");break}if(l.hasHeader("contact")&&!this._createDialog(l,"UAC",!0))break;if(this._status=f.STATUS_1XX_RECEIVED,!l.body){this._progress("remote",l);break}var P={originator:"remote",type:"answer",sdp:l.body};d.debug('emit "sdp"'),this.emit("sdp",P);var W=new RTCSessionDescription({type:"answer",sdp:P.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return h._connection.setRemoteDescription(W)}).then(function(){return h._progress("remote",l)}).catch(function(Z){d.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',Z),h.emit("peerconnection:setremotedescriptionfailed",Z)});break;case/^2[0-9]{2}$/.test(l.status_code):if(this._status=f.STATUS_CONFIRMED,!l.body){this._acceptAndTerminate(l,400,a.causes.MISSING_SDP),this._failed("remote",l,a.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(l,"UAC"))break;var K={originator:"remote",type:"answer",sdp:l.body};d.debug('emit "sdp"'),this.emit("sdp",K);var z=new RTCSessionDescription({type:"answer",sdp:K.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(h._connection.signalingState==="stable")return h._connection.createOffer(h._rtcOfferConstraints).then(function(Z){return h._connection.setLocalDescription(Z)}).catch(function(Z){h._acceptAndTerminate(l,500,Z.toString()),h._failed("local",l,a.causes.WEBRTC_ERROR)})}).then(function(){h._connection.setRemoteDescription(z).then(function(){h._handleSessionTimersInIncomingResponse(l),h._accepted("remote",l),h.sendRequest(a.ACK),h._confirmed("local",null)}).catch(function(Z){h._acceptAndTerminate(l,488,"Not Acceptable Here"),h._failed("remote",l,a.causes.BAD_MEDIA_DESCRIPTION),d.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',Z),h.emit("peerconnection:setremotedescriptionfailed",Z)})});break;default:var ne=C.sipErrorCause(l.status_code);this._failed("remote",l,ne)}}},{key:"_sendReinvite",value:function(){var l=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d.debug("sendReinvite()");var k=C.cloneArray(h.extraHeaders),P=C.cloneObject(h.eventHandlers),W=h.rtcOfferConstraints||this._rtcOfferConstraints||null,K=!1;function z(ne){P.failed&&P.failed(ne)}k.push("Contact: ".concat(this._contact)),k.push("Content-Type: application/sdp"),this._sessionTimers.running&&k.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return l._createLocalDescription("offer",W)}).then(function(ne){var Z={originator:"local",type:"offer",sdp:ne=l._mangleOffer(ne)};d.debug('emit "sdp"'),l.emit("sdp",Z),l.sendRequest(a.INVITE,{extraHeaders:k,body:ne,eventHandlers:{onSuccessResponse:function(X){(function(ie){var ue=this;if(this._status!==f.STATUS_TERMINATED&&(this.sendRequest(a.ACK),!K)){if(this._handleSessionTimersInIncomingResponse(ie),!ie.body)return void z.call(this);if(!ie.hasHeader("Content-Type")||ie.getHeader("Content-Type").toLowerCase()!=="application/sdp")return void z.call(this);var de={originator:"remote",type:"answer",sdp:ie.body};d.debug('emit "sdp"'),this.emit("sdp",de);var ye=new RTCSessionDescription({type:"answer",sdp:de.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return ue._connection.setRemoteDescription(ye)}).then(function(){P.succeeded&&P.succeeded(ie)}).catch(function(Ee){z.call(ue),d.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',Ee),ue.emit("peerconnection:setremotedescriptionfailed",Ee)})}}).call(l,X),K=!0},onErrorResponse:function(X){z.call(l,X)},onTransportError:function(){l.onTransportError()},onRequestTimeout:function(){l.onRequestTimeout()},onDialogError:function(){l.onDialogError()}}})}).catch(function(){z()})}},{key:"_sendUpdate",value:function(){var l=this,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d.debug("sendUpdate()");var k=C.cloneArray(h.extraHeaders),P=C.cloneObject(h.eventHandlers),W=h.rtcOfferConstraints||this._rtcOfferConstraints||null,K=h.sdpOffer||!1,z=!1;function ne(X){var ie=this;if(this._status!==f.STATUS_TERMINATED&&!z)if(this._handleSessionTimersInIncomingResponse(X),K){if(!X.body)return void Z.call(this);if(!X.hasHeader("Content-Type")||X.getHeader("Content-Type").toLowerCase()!=="application/sdp")return void Z.call(this);var ue={originator:"remote",type:"answer",sdp:X.body};d.debug('emit "sdp"'),this.emit("sdp",ue);var de=new RTCSessionDescription({type:"answer",sdp:ue.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return ie._connection.setRemoteDescription(de)}).then(function(){P.succeeded&&P.succeeded(X)}).catch(function(ye){Z.call(ie),d.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',ye),ie.emit("peerconnection:setremotedescriptionfailed",ye)})}else P.succeeded&&P.succeeded(X)}function Z(X){P.failed&&P.failed(X)}k.push("Contact: ".concat(this._contact)),this._sessionTimers.running&&k.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),K?(k.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return l._createLocalDescription("offer",W)}).then(function(X){var ie={originator:"local",type:"offer",sdp:X=l._mangleOffer(X)};d.debug('emit "sdp"'),l.emit("sdp",ie),l.sendRequest(a.UPDATE,{extraHeaders:k,body:X,eventHandlers:{onSuccessResponse:function(ue){ne.call(l,ue),z=!0},onErrorResponse:function(ue){Z.call(l,ue)},onTransportError:function(){l.onTransportError()},onRequestTimeout:function(){l.onRequestTimeout()},onDialogError:function(){l.onDialogError()}}})}).catch(function(){Z.call(l)})):this.sendRequest(a.UPDATE,{extraHeaders:k,eventHandlers:{onSuccessResponse:function(X){ne.call(l,X)},onErrorResponse:function(X){Z.call(l,X)},onTransportError:function(){l.onTransportError()},onRequestTimeout:function(){l.onRequestTimeout()},onDialogError:function(){l.onDialogError()}}})}},{key:"_acceptAndTerminate",value:function(l,h,k){d.debug("acceptAndTerminate()");var P=[];h&&(k=k||a.REASON_PHRASE[h]||"",P.push("Reason: SIP ;cause=".concat(h,'; text="').concat(k,'"'))),(this._dialog||this._createDialog(l,"UAC"))&&(this.sendRequest(a.ACK),this.sendRequest(a.BYE,{extraHeaders:P})),this._status=f.STATUS_TERMINATED}},{key:"_mangleOffer",value:function(l){if(!this._localHold&&!this._remoteHold)return l;if(l=s.parse(l),this._localHold&&!this._remoteHold){d.debug("mangleOffer() | me on hold, mangling offer");var h,k=N(l.media);try{for(k.s();!(h=k.n()).done;){var P=h.value;E.indexOf(P.type)!==-1&&(P.direction?P.direction==="sendrecv"?P.direction="sendonly":P.direction==="recvonly"&&(P.direction="inactive"):P.direction="sendonly")}}catch(ie){k.e(ie)}finally{k.f()}}else if(this._localHold&&this._remoteHold){d.debug("mangleOffer() | both on hold, mangling offer");var W,K=N(l.media);try{for(K.s();!(W=K.n()).done;){var z=W.value;E.indexOf(z.type)!==-1&&(z.direction="inactive")}}catch(ie){K.e(ie)}finally{K.f()}}else if(this._remoteHold){d.debug("mangleOffer() | remote on hold, mangling offer");var ne,Z=N(l.media);try{for(Z.s();!(ne=Z.n()).done;){var X=ne.value;E.indexOf(X.type)!==-1&&(X.direction?X.direction==="sendrecv"?X.direction="recvonly":X.direction==="recvonly"&&(X.direction="inactive"):X.direction="recvonly")}}catch(ie){Z.e(ie)}finally{Z.f()}}return s.write(l)}},{key:"_setLocalMediaStatus",value:function(){var l=!0,h=!0;(this._localHold||this._remoteHold)&&(l=!1,h=!1),this._audioMuted&&(l=!1),this._videoMuted&&(h=!1),this._toggleMuteAudio(!l),this._toggleMuteVideo(!h)}},{key:"_handleSessionTimersInIncomingRequest",value:function(l,h){var k;this._sessionTimers.enabled&&(l.session_expires&&l.session_expires>=a.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=l.session_expires,k=l.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,k="uas"),h.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(k)),this._sessionTimers.refresher=k==="uas",this._runSessionTimer())}},{key:"_handleSessionTimersInIncomingResponse",value:function(l){var h;this._sessionTimers.enabled&&(l.session_expires&&l.session_expires>=a.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=l.session_expires,h=l.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,h="uac"),this._sessionTimers.refresher=h==="uac",this._runSessionTimer())}},{key:"_runSessionTimer",value:function(){var l=this,h=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(function(){l._status!==f.STATUS_TERMINATED&&l._isReadyToReOffer()&&(d.debug("runSessionTimer() | sending session refresh request"),l._sessionTimers.refreshMethod===a.UPDATE?l._sendUpdate():l._sendReinvite())},500*h):this._sessionTimers.timer=setTimeout(function(){l._status!==f.STATUS_TERMINATED&&(d.warn("runSessionTimer() | timer expired, terminating the session"),l.terminate({cause:a.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*h)}},{key:"_toggleMuteAudio",value:function(l){var h,k=N(this._connection.getSenders().filter(function(P){return P.track&&P.track.kind==="audio"}));try{for(k.s();!(h=k.n()).done;)h.value.track.enabled=!l}catch(P){k.e(P)}finally{k.f()}}},{key:"_toggleMuteVideo",value:function(l){var h,k=N(this._connection.getSenders().filter(function(P){return P.track&&P.track.kind==="video"}));try{for(k.s();!(h=k.n()).done;)h.value.track.enabled=!l}catch(P){k.e(P)}finally{k.f()}}},{key:"_newRTCSession",value:function(l,h){d.debug("newRTCSession()"),this._ua.newRTCSession(this,{originator:l,session:this,request:h})}},{key:"_connecting",value:function(l){d.debug("session connecting"),d.debug('emit "connecting"'),this.emit("connecting",{request:l})}},{key:"_progress",value:function(l,h){d.debug("session progress"),d.debug('emit "progress"'),this.emit("progress",{originator:l,response:h||null})}},{key:"_accepted",value:function(l,h){d.debug("session accepted"),this._start_time=new Date,d.debug('emit "accepted"'),this.emit("accepted",{originator:l,response:h||null})}},{key:"_confirmed",value:function(l,h){d.debug("session confirmed"),this._is_confirmed=!0,d.debug('emit "confirmed"'),this.emit("confirmed",{originator:l,ack:h||null})}},{key:"_ended",value:function(l,h,k){d.debug("session ended"),this._end_time=new Date,this._close(),d.debug('emit "ended"'),this.emit("ended",{originator:l,message:h||null,cause:k})}},{key:"_failed",value:function(l,h,k){d.debug("session failed"),d.debug('emit "_failed"'),this.emit("_failed",{originator:l,message:h||null,cause:k}),this._close(),d.debug('emit "failed"'),this.emit("failed",{originator:l,message:h||null,cause:k})}},{key:"_onhold",value:function(l){d.debug("session onhold"),this._setLocalMediaStatus(),d.debug('emit "hold"'),this.emit("hold",{originator:l})}},{key:"_onunhold",value:function(l){d.debug("session onunhold"),this._setLocalMediaStatus(),d.debug('emit "unhold"'),this.emit("unhold",{originator:l})}},{key:"_onmute",value:function(l){var h=l.audio,k=l.video;d.debug("session onmute"),this._setLocalMediaStatus(),d.debug('emit "muted"'),this.emit("muted",{audio:h,video:k})}},{key:"_onunmute",value:function(l){var h=l.audio,k=l.video;d.debug("session onunmute"),this._setLocalMediaStatus(),d.debug('emit "unmuted"'),this.emit("unmuted",{audio:h,video:k})}}])&&M(D.prototype,O),F&&M(D,F),Object.defineProperty(D,"prototype",{writable:!1}),$}()},{"./Constants":2,"./Dialog":3,"./Exceptions":6,"./Logger":9,"./RTCSession/DTMF":16,"./RTCSession/Info":17,"./RTCSession/ReferNotifier":18,"./RTCSession/ReferSubscriber":19,"./RequestSender":21,"./SIPMessage":22,"./Timers":25,"./Transactions":26,"./URI":29,"./Utils":30,events:33,"sdp-transform":39}],16:[function(A,V,j){function L(y){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(y)}function N(y,C){for(var c=0;c<C.length;c++){var p=C[c];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}function i(y,C){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,p){return c.__proto__=p,c})(y,C)}function M(y){var C=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var c,p=q(y);if(C){var m=q(this).constructor;c=Reflect.construct(p,arguments,m)}else c=p.apply(this,arguments);return function(S,b){if(b&&(L(b)==="object"||typeof b=="function"))return b;if(b!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}(S)}(this,c)}}function q(y){return(q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(C){return C.__proto__||Object.getPrototypeOf(C)})(y)}var t=A("events").EventEmitter,I=A("../Logger"),R=A("../Constants"),s=A("../Exceptions"),_=A("../Utils"),a=new I("RTCSession:DTMF"),v={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};V.exports=function(y){(function(S,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(b&&b.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),Object.defineProperty(S,"prototype",{writable:!1}),b&&i(S,b)})(m,t);var C,c,p=M(m);function m(S){var b;return function(T,x){if(!(T instanceof x))throw new TypeError("Cannot call a class as a function")}(this,m),(b=p.call(this))._session=S,b._direction=null,b._tone=null,b._duration=null,b._request=null,b}return C=m,(c=[{key:"tone",get:function(){return this._tone}},{key:"duration",get:function(){return this._duration}},{key:"send",value:function(S){var b=this,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(S===void 0)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new s.InvalidStateError(this._session.status);var x=_.cloneArray(T.extraHeaders);if(this.eventHandlers=_.cloneObject(T.eventHandlers),typeof S=="string")S=S.toUpperCase();else{if(typeof S!="number")throw new TypeError("Invalid tone: ".concat(S));S=S.toString()}if(!S.match(/^[0-9A-DR#*]$/))throw new TypeError("Invalid tone: ".concat(S));this._tone=S,this._duration=T.duration,x.push("Content-Type: application/dtmf-relay");var Q="Signal=".concat(this._tone,`\r
`);Q+="Duration=".concat(this._duration),this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(R.INFO,{extraHeaders:x,eventHandlers:{onSuccessResponse:function(G){b.emit("succeeded",{originator:"remote",response:G})},onErrorResponse:function(G){b.eventHandlers.onFailed&&b.eventHandlers.onFailed(),b.emit("failed",{originator:"remote",response:G})},onRequestTimeout:function(){b._session.onRequestTimeout()},onTransportError:function(){b._session.onTransportError()},onDialogError:function(){b._session.onDialogError()}},body:Q})}},{key:"init_incoming",value:function(S){var b=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,T=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=S,S.reply(200),S.body){var x=S.body.split(`
`);x.length>=1&&b.test(x[0])&&(this._tone=x[0].replace(b,"$2")),x.length>=2&&T.test(x[1])&&(this._duration=parseInt(x[1].replace(T,"$2"),10))}this._duration||(this._duration=v.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:S}):a.debug("invalid INFO DTMF received, discarded")}}])&&N(C.prototype,c),Object.defineProperty(C,"prototype",{writable:!1}),m}(),V.exports.C=v},{"../Constants":2,"../Exceptions":6,"../Logger":9,"../Utils":30,events:33}],17:[function(A,V,j){function L(_){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(_)}function N(_,a){for(var v=0;v<a.length;v++){var y=a[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(_,y.key,y)}}function i(_,a){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,y){return v.__proto__=y,v})(_,a)}function M(_){var a=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var v,y=q(_);if(a){var C=q(this).constructor;v=Reflect.construct(y,arguments,C)}else v=y.apply(this,arguments);return function(c,p){if(p&&(L(p)==="object"||typeof p=="function"))return p;if(p!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}(c)}(this,v)}}function q(_){return(q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)})(_)}var t=A("events").EventEmitter,I=A("../Constants"),R=A("../Exceptions"),s=A("../Utils");V.exports=function(_){(function(c,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(p&&p.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),p&&i(c,p)})(C,t);var a,v,y=M(C);function C(c){var p;return function(m,S){if(!(m instanceof S))throw new TypeError("Cannot call a class as a function")}(this,C),(p=y.call(this))._session=c,p._direction=null,p._contentType=null,p._body=null,p}return a=C,(v=[{key:"contentType",get:function(){return this._contentType}},{key:"body",get:function(){return this._body}},{key:"send",value:function(c,p){var m=this,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._direction="outgoing",p&&c===void 0)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new R.InvalidStateError(this._session.status);this._contentType=c,this._body=p;var b=s.cloneArray(S.extraHeaders);c&&b.push("Content-Type: ".concat(c)),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(I.INFO,{extraHeaders:b,eventHandlers:{onSuccessResponse:function(T){m.emit("succeeded",{originator:"remote",response:T})},onErrorResponse:function(T){m.emit("failed",{originator:"remote",response:T})},onTransportError:function(){m._session.onTransportError()},onRequestTimeout:function(){m._session.onRequestTimeout()},onDialogError:function(){m._session.onDialogError()}},body:p})}},{key:"init_incoming",value:function(c){this._direction="incoming",this.request=c,c.reply(200),this._contentType=c.hasHeader("Content-Type")?c.getHeader("Content-Type").toLowerCase():void 0,this._body=c.body,this._session.newInfo({originator:"remote",info:this,request:c})}}])&&N(a.prototype,v),Object.defineProperty(a,"prototype",{writable:!1}),C}()},{"../Constants":2,"../Exceptions":6,"../Utils":30,events:33}],18:[function(A,V,j){function L(t,I){for(var R=0;R<I.length;R++){var s=I[R];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var N=A("../Logger"),i=A("../Constants"),M=new N("RTCSession:ReferNotifier"),q={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300};V.exports=function(){function t(s,_,a){(function(v,y){if(!(v instanceof y))throw new TypeError("Cannot call a class as a function")})(this,t),this._session=s,this._id=_,this._expires=a||q.expires,this._active=!0,this.notify(100)}var I,R;return I=t,(R=[{key:"notify",value:function(s,_){if(M.debug("notify()"),this._active!==!1){var a;_=_||i.REASON_PHRASE[s]||"",a=s>=200?"terminated;reason=noresource":"active;expires=".concat(this._expires);try{this._session.sendRequest(i.NOTIFY,{extraHeaders:["Event: ".concat(q.event_type,";id=").concat(this._id),"Subscription-State: ".concat(a),"Content-Type: ".concat(q.body_type)],body:"SIP/2.0 ".concat(s," ").concat(_),eventHandlers:{onErrorResponse:function(){this._active=!1}}})}catch{M.debug("send NOTIFY exception [ignored]")}}}}])&&L(I.prototype,R),Object.defineProperty(I,"prototype",{writable:!1}),t}()},{"../Constants":2,"../Logger":9}],19:[function(A,V,j){function L(v){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(v)}function N(v,y){for(var C=0;C<y.length;C++){var c=y[C];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(v,c.key,c)}}function i(v,y){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(C,c){return C.__proto__=c,C})(v,y)}function M(v){var y=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var C,c=q(v);if(y){var p=q(this).constructor;C=Reflect.construct(c,arguments,p)}else C=c.apply(this,arguments);return function(m,S){if(S&&(L(S)==="object"||typeof S=="function"))return S;if(S!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(b){if(b===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}(m)}(this,C)}}function q(v){return(q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(y){return y.__proto__||Object.getPrototypeOf(y)})(v)}var t=A("events").EventEmitter,I=A("../Logger"),R=A("../Constants"),s=A("../Grammar"),_=A("../Utils"),a=new I("RTCSession:ReferSubscriber");V.exports=function(v){(function(m,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(S&&S.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),S&&i(m,S)})(p,t);var y,C,c=M(p);function p(m){var S;return function(b,T){if(!(b instanceof T))throw new TypeError("Cannot call a class as a function")}(this,p),(S=c.call(this))._id=null,S._session=m,S}return y=p,(C=[{key:"id",get:function(){return this._id}},{key:"sendRefer",value:function(m){var S=this,b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};a.debug("sendRefer()");var T=_.cloneArray(b.extraHeaders),x=_.cloneObject(b.eventHandlers);for(var Q in x)Object.prototype.hasOwnProperty.call(x,Q)&&this.on(Q,x[Q]);var G=null;b.replaces&&(G=b.replaces._request.call_id,G+=";to-tag=".concat(b.replaces._to_tag),G+=";from-tag=".concat(b.replaces._from_tag),G=encodeURIComponent(G));var d="Refer-To: <".concat(m).concat(G?"?Replaces=".concat(G):"",">");if(T.push(d),!T.some(function(w){return w.toLowerCase().startsWith("referred-by:")})){var f="Referred-By: <".concat(this._session._ua._configuration.uri._scheme,":").concat(this._session._ua._configuration.uri._user,"@").concat(this._session._ua._configuration.uri._host,">");T.push(f)}T.push("Contact: ".concat(this._session.contact));var E=this._session.sendRequest(R.REFER,{extraHeaders:T,eventHandlers:{onSuccessResponse:function(w){S._requestSucceeded(w)},onErrorResponse:function(w){S._requestFailed(w,R.causes.REJECTED)},onTransportError:function(){S._requestFailed(null,R.causes.CONNECTION_ERROR)},onRequestTimeout:function(){S._requestFailed(null,R.causes.REQUEST_TIMEOUT)},onDialogError:function(){S._requestFailed(null,R.causes.DIALOG_ERROR)}}});this._id=E.cseq}},{key:"receiveNotify",value:function(m){if(a.debug("receiveNotify()"),m.body){var S=s.parse(m.body.trim().split(`\r
`,1)[0],"Status_Line");if(S!==-1)switch(!0){case/^100$/.test(S.status_code):this.emit("trying",{request:m,status_line:S});break;case/^1[0-9]{2}$/.test(S.status_code):this.emit("progress",{request:m,status_line:S});break;case/^2[0-9]{2}$/.test(S.status_code):this.emit("accepted",{request:m,status_line:S});break;default:this.emit("failed",{request:m,status_line:S})}else a.debug('receiveNotify() | error parsing NOTIFY body: "'.concat(m.body,'"'))}}},{key:"_requestSucceeded",value:function(m){a.debug("REFER succeeded"),a.debug('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:m})}},{key:"_requestFailed",value:function(m,S){a.debug("REFER failed"),a.debug('emit "requestFailed"'),this.emit("requestFailed",{response:m||null,cause:S})}}])&&N(y.prototype,C),Object.defineProperty(y,"prototype",{writable:!1}),p}()},{"../Constants":2,"../Grammar":7,"../Logger":9,"../Utils":30,events:33}],20:[function(A,V,j){function L(R,s){for(var _=0;_<s.length;_++){var a=s[_];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(R,a.key,a)}}var N=A("./Logger"),i=A("./Utils"),M=A("./Constants"),q=A("./SIPMessage"),t=A("./RequestSender"),I=new N("Registrator");V.exports=function(){function R(a,v){(function(y,C){if(!(y instanceof C))throw new TypeError("Cannot call a class as a function")})(this,R),this._reg_id=1,this._ua=a,this._transport=v,this._registrar=a.configuration.registrar_server,this._expires=a.configuration.register_expires,this._call_id=i.createRandomToken(22),this._cseq=0,this._to_uri=a.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._sipInstance='"<urn:uuid:'.concat(this._ua.configuration.instance_id,'>"'),this._contact+=";reg-id=".concat(this._reg_id),this._contact+=";+sip.instance=".concat(this._sipInstance),this._auth=null}var s,_;return s=R,(_=[{key:"registered",get:function(){return this._registered}},{key:"setExtraHeaders",value:function(a){Array.isArray(a)||(a=[]),this._extraHeaders=a.slice()}},{key:"setExtraContactParams",value:function(a){for(var v in a instanceof Object||(a={}),this._extraContactParams="",a)if(Object.prototype.hasOwnProperty.call(a,v)){var y=a[v];this._extraContactParams+=";".concat(v),y&&(this._extraContactParams+="=".concat(y))}}},{key:"register",value:function(){var a=this;if(this._registering)I.debug("Register request in progress...");else{var v=this._extraHeaders.slice();v.push("Contact: ".concat(this._contact,";expires=").concat(this._expires).concat(this._extraContactParams)),v.push("Expires: ".concat(this._expires)),this._auth&&v.push(this._auth);var y=new q.OutgoingRequest(M.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},v),C=new t(this._ua,y,{onRequestTimeout:function(){a._registrationFailure(null,M.causes.REQUEST_TIMEOUT)},onTransportError:function(){a._registrationFailure(null,M.causes.CONNECTION_ERROR)},onAuthenticated:function(c){var p,m;a._cseq+=1,a._ua.modes.cache_register_auth_mode&&((m=c.getHeader(p="Authorization"))||(m=c.getHeader(p="Proxy-Authorization")))&&(a._auth="".concat(p,": ").concat(m))},onReceiveResponse:function(c){if(c.cseq===a._cseq)switch(a._registrationTimer!==null&&(clearTimeout(a._registrationTimer),a._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(c.status_code):break;case/^2[0-9]{2}$/.test(c.status_code):if(a._registering=!1,!c.hasHeader("Contact")){I.debug("no Contact header in response to REGISTER, response ignored");break}var p=c.headers.Contact.reduce(function(x,Q){return x.concat(Q.parsed)},[]),m=p.find(function(x){return a._sipInstance===x.getParam("+sip.instance")&&a._reg_id===parseInt(x.getParam("reg-id"))});if(m||(m=p.find(function(x){return x.uri.user===a._ua.contact.uri.user})),!m){I.debug("no Contact header pointing to us, response ignored");break}var S=m.getParam("expires");!S&&c.hasHeader("expires")&&(S=c.getHeader("expires")),S||(S=a._expires),(S=Number(S))<10&&(S=10);var b=S>=140?1e3*S/2+Math.floor(1e3*(S/2-70)*Math.random()):1e3*S-5e3;a._registrationTimer=setTimeout(function(){a._registrationTimer=null,a._ua.listeners("registrationExpiring").length===0?a.register():a._ua.emit("registrationExpiring")},b),m.hasParam("temp-gruu")&&(a._ua.contact.temp_gruu=m.getParam("temp-gruu").replace(/"/g,"")),m.hasParam("pub-gruu")&&(a._ua.contact.pub_gruu=m.getParam("pub-gruu").replace(/"/g,"")),a._registered||(a._registered=!0,a._ua.registered({response:c}));break;case/^423$/.test(c.status_code):c.hasHeader("min-expires")?(a._expires=Number(c.getHeader("min-expires")),a._expires<10&&(a._expires=10),a.register()):(I.debug("423 response received for REGISTER without Min-Expires"),a._registrationFailure(c,M.causes.SIP_FAILURE_CODE));break;default:var T=i.sipErrorCause(c.status_code);a._registrationFailure(c,T)}}});this._registering=!0,C.send()}}},{key:"unregister",value:function(){var a=this,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._registered){this._registered=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);var y=this._extraHeaders.slice();v.all?y.push("Contact: *".concat(this._extraContactParams)):y.push("Contact: ".concat(this._contact,";expires=0").concat(this._extraContactParams)),y.push("Expires: 0"),this._auth&&y.push(this._auth);var C=new q.OutgoingRequest(M.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},y);new t(this._ua,C,{onRequestTimeout:function(){a._unregistered(null,M.causes.REQUEST_TIMEOUT)},onTransportError:function(){a._unregistered(null,M.causes.CONNECTION_ERROR)},onAuthenticated:function(){a._cseq+=1},onReceiveResponse:function(c){switch(!0){case/^1[0-9]{2}$/.test(c.status_code):break;case/^2[0-9]{2}$/.test(c.status_code):a._unregistered(c);break;default:var p=i.sipErrorCause(c.status_code);a._unregistered(c,p)}}}).send(),this._auth=null}else I.debug("already unregistered")}},{key:"close",value:function(){this._registered&&this.unregister()}},{key:"onTransportClosed",value:function(){this._registering=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}},{key:"_registrationFailure",value:function(a,v){this._registering=!1,this._ua.registrationFailed({response:a||null,cause:v}),this._registered&&(this._registered=!1,this._ua.unregistered({response:a||null,cause:v}))}},{key:"_unregistered",value:function(a,v){this._registering=!1,this._registered=!1,this._ua.unregistered({response:a||null,cause:v||null})}}])&&L(s.prototype,_),Object.defineProperty(s,"prototype",{writable:!1}),R}()},{"./Constants":2,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./Utils":30}],21:[function(A,V,j){function L(R,s){for(var _=0;_<s.length;_++){var a=s[_];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(R,a.key,a)}}var N=A("./Logger"),i=A("./Constants"),M=A("./DigestAuthentication"),q=A("./Transactions"),t=new N("RequestSender"),I={onRequestTimeout:function(){},onTransportError:function(){},onReceiveResponse:function(){},onAuthenticated:function(){}};V.exports=function(){function R(a,v,y){for(var C in function(c,p){if(!(c instanceof p))throw new TypeError("Cannot call a class as a function")}(this,R),this._ua=a,this._eventHandlers=y,this._method=v.method,this._request=v,this._auth=null,this._challenged=!1,this._staled=!1,I)Object.prototype.hasOwnProperty.call(I,C)&&(this._eventHandlers[C]||(this._eventHandlers[C]=I[C]));a.status!==a.C.STATUS_USER_CLOSED||this._method===i.BYE&&this._method===i.ACK||this._eventHandlers.onTransportError()}var s,_;return s=R,(_=[{key:"send",value:function(){var a=this,v={onRequestTimeout:function(){a._eventHandlers.onRequestTimeout()},onTransportError:function(){a._eventHandlers.onTransportError()},onReceiveResponse:function(y){a._receiveResponse(y)}};switch(this._method){case"INVITE":this.clientTransaction=new q.InviteClientTransaction(this._ua,this._ua.transport,this._request,v);break;case"ACK":this.clientTransaction=new q.AckClientTransaction(this._ua,this._ua.transport,this._request,v);break;default:this.clientTransaction=new q.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,v)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}},{key:"_receiveResponse",value:function(a){var v,y,C=a.status_code;if(C!==401&&C!==407||this._ua.configuration.password===null&&this._ua.configuration.ha1===null)this._eventHandlers.onReceiveResponse(a);else{if(a.status_code===401?(v=a.parseHeader("www-authenticate"),y="authorization"):(v=a.parseHeader("proxy-authenticate"),y="proxy-authorization"),!v)return t.debug("".concat(a.status_code," with wrong or missing challenge, cannot authenticate")),void this._eventHandlers.onReceiveResponse(a);if(!this._challenged||!this._staled&&v.stale===!0){if(!this._auth){var c=this._ua.getCredential(v.realm);this._auth=new M(c)}if(!this._auth.authenticate(this._request,v))return void this._eventHandlers.onReceiveResponse(a);this._challenged=!0,this._ua.updateCredential(v.realm,this._auth.get("realm"),this._auth.get("ha1")),v.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq","".concat(this._request.cseq," ").concat(this._method)),this._request.setHeader(y,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(a)}}}])&&L(s.prototype,_),Object.defineProperty(s,"prototype",{writable:!1}),R}()},{"./Constants":2,"./DigestAuthentication":5,"./Logger":9,"./Transactions":26}],22:[function(A,V,j){function L(G){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(G)}function N(G,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(d&&d.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),Object.defineProperty(G,"prototype",{writable:!1}),d&&i(G,d)}function i(G,d){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,E){return f.__proto__=E,f})(G,d)}function M(G){var d=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var f,E=q(G);if(d){var w=q(this).constructor;f=Reflect.construct(E,arguments,w)}else f=E.apply(this,arguments);return function(D,O){if(O&&(L(O)==="object"||typeof O=="function"))return O;if(O!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(F){if(F===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F}(D)}(this,f)}}function q(G){return(q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)})(G)}function t(G,d){var f=typeof Symbol<"u"&&G[Symbol.iterator]||G["@@iterator"];if(!f){if(Array.isArray(G)||(f=function(B,$){if(B){if(typeof B=="string")return I(B,$);var l=Object.prototype.toString.call(B).slice(8,-1);if(l==="Object"&&B.constructor&&(l=B.constructor.name),l==="Map"||l==="Set")return Array.from(B);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return I(B,$)}}(G))||d){f&&(G=f);var E=0,w=function(){};return{s:w,n:function(){return E>=G.length?{done:!0}:{done:!1,value:G[E++]}},e:function(B){throw B},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D,O=!0,F=!1;return{s:function(){f=f.call(G)},n:function(){var B=f.next();return O=B.done,B},e:function(B){F=!0,D=B},f:function(){try{O||f.return==null||f.return()}finally{if(F)throw D}}}}function I(G,d){(d==null||d>G.length)&&(d=G.length);for(var f=0,E=new Array(d);f<d;f++)E[f]=G[f];return E}function R(G,d){if(!(G instanceof d))throw new TypeError("Cannot call a class as a function")}function s(G,d){for(var f=0;f<d.length;f++){var E=d[f];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(G,E.key,E)}}function _(G,d,f){return d&&s(G.prototype,d),Object.defineProperty(G,"prototype",{writable:!1}),G}var a=A("sdp-transform"),v=A("./Logger"),y=A("./Constants"),C=A("./Utils"),c=A("./NameAddrHeader"),p=A("./Grammar"),m=new v("SIPMessage"),S=function(){function G(d,f,E,w,D,O){if(R(this,G),!d||!f||!E)return null;w=w||{},this.ua=E,this.headers={},this.method=d,this.ruri=f,this.body=O,this.extraHeaders=C.cloneArray(D),this.ua.configuration.extra_headers&&(this.extraHeaders=this.extraHeaders.concat(this.ua.configuration.extra_headers)),w.route_set?this.setHeader("route",w.route_set):E.configuration.use_preloaded_route&&this.setHeader("route","<".concat(E.transport.sip_uri,";lr>")),this.setHeader("via",""),this.setHeader("max-forwards",y.MAX_FORWARDS);var F=w.to_uri||f,B=w.to_tag?{tag:w.to_tag}:null,$=w.to_display_name!==void 0?w.to_display_name:null;this.to=new c(F,$,B),this.setHeader("to",this.to.toString());var l,h=w.from_uri||E.configuration.uri,k={tag:w.from_tag||C.newTag()};l=w.from_display_name!==void 0?w.from_display_name:E.configuration.display_name?E.configuration.display_name:null,this.from=new c(h,l,k),this.setHeader("from",this.from.toString());var P=w.call_id||E.configuration.jssip_id+C.createRandomToken(15);this.call_id=P,this.setHeader("call-id",P);var W=w.cseq||Math.floor(1e4*Math.random());this.cseq=W,this.setHeader("cseq","".concat(W," ").concat(d))}return _(G,[{key:"setHeader",value:function(d,f){for(var E=new RegExp("^\\s*".concat(d,"\\s*:"),"i"),w=0;w<this.extraHeaders.length;w++)E.test(this.extraHeaders[w])&&this.extraHeaders.splice(w,1);this.headers[C.headerize(d)]=Array.isArray(f)?f:[f]}},{key:"getHeader",value:function(d){var f=this.headers[C.headerize(d)];if(f){if(f[0])return f[0]}else{var E,w=new RegExp("^\\s*".concat(d,"\\s*:"),"i"),D=t(this.extraHeaders);try{for(D.s();!(E=D.n()).done;){var O=E.value;if(w.test(O))return O.substring(O.indexOf(":")+1).trim()}}catch(F){D.e(F)}finally{D.f()}}}},{key:"getHeaders",value:function(d){var f=this.headers[C.headerize(d)],E=[];if(f){var w,D=t(f);try{for(D.s();!(w=D.n()).done;){var O=w.value;E.push(O)}}catch(h){D.e(h)}finally{D.f()}return E}var F,B=new RegExp("^\\s*".concat(d,"\\s*:"),"i"),$=t(this.extraHeaders);try{for($.s();!(F=$.n()).done;){var l=F.value;B.test(l)&&E.push(l.substring(l.indexOf(":")+1).trim())}}catch(h){$.e(h)}finally{$.f()}return E}},{key:"hasHeader",value:function(d){if(this.headers[C.headerize(d)])return!0;var f,E=new RegExp("^\\s*".concat(d,"\\s*:"),"i"),w=t(this.extraHeaders);try{for(w.s();!(f=w.n()).done;){var D=f.value;if(E.test(D))return!0}}catch(O){w.e(O)}finally{w.f()}return!1}},{key:"parseSDP",value:function(d){return!d&&this.sdp?this.sdp:(this.sdp=a.parse(this.body||""),this.sdp)}},{key:"toString",value:function(){var d="".concat(this.method," ").concat(this.ruri,` SIP/2.0\r
`);for(var f in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,f)){var E,w=t(this.headers[f]);try{for(w.s();!(E=w.n()).done;){var D=E.value;d+="".concat(f,": ").concat(D,`\r
`)}}catch(k){w.e(k)}finally{w.f()}}var O,F=t(this.extraHeaders);try{for(F.s();!(O=F.n()).done;){var B=O.value;d+="".concat(B.trim(),`\r
`)}}catch(k){F.e(k)}finally{F.f()}var $=[];switch(this.method){case y.REGISTER:$.push("path","gruu");break;case y.INVITE:this.ua.configuration.session_timers&&$.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&$.push("gruu"),$.push("ice","replaces");break;case y.UPDATE:this.ua.configuration.session_timers&&$.push("timer"),$.push("ice")}$.push("outbound");var l=this.ua.configuration.user_agent||y.USER_AGENT;if(d+="Allow: ".concat(y.ALLOWED_METHODS,`\r
`),d+="Supported: ".concat($,`\r
`),d+="User-Agent: ".concat(l,`\r
`),this.body){var h=C.str_utf8_length(this.body);d+="Content-Length: ".concat(h,`\r
\r
`),d+=this.body}else d+=`Content-Length: 0\r
\r
`;return d}},{key:"clone",value:function(){var d=new G(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(f){d.headers[f]=this.headers[f].slice()},this),d.body=this.body,d.extraHeaders=C.cloneArray(this.extraHeaders),d.to=this.to,d.from=this.from,d.call_id=this.call_id,d.cseq=this.cseq,d}}]),G}(),b=function(G){N(f,S);var d=M(f);function f(E,w,D,O,F){var B;return R(this,f),(B=d.call(this,y.INVITE,E,w,D,O,F)).transaction=null,B}return _(f,[{key:"cancel",value:function(E){this.transaction.cancel(E)}},{key:"clone",value:function(){var E=new f(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(w){E.headers[w]=this.headers[w].slice()},this),E.body=this.body,E.extraHeaders=C.cloneArray(this.extraHeaders),E.to=this.to,E.from=this.from,E.call_id=this.call_id,E.cseq=this.cseq,E.transaction=this.transaction,E}}]),f}(),T=function(){function G(){R(this,G),this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}return _(G,[{key:"addHeader",value:function(d,f){var E={raw:f};d=C.headerize(d),this.headers[d]?this.headers[d].push(E):this.headers[d]=[E]}},{key:"getHeader",value:function(d){var f=this.headers[C.headerize(d)];if(f)return f[0]?f[0].raw:void 0}},{key:"getHeaders",value:function(d){var f=this.headers[C.headerize(d)],E=[];if(!f)return[];var w,D=t(f);try{for(D.s();!(w=D.n()).done;){var O=w.value;E.push(O.raw)}}catch(F){D.e(F)}finally{D.f()}return E}},{key:"hasHeader",value:function(d){return!!this.headers[C.headerize(d)]}},{key:"parseHeader",value:function(d){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(d=C.headerize(d),this.headers[d]){if(!(f>=this.headers[d].length)){var E=this.headers[d][f],w=E.raw;if(E.parsed)return E.parsed;var D=p.parse(w,d.replace(/-/g,"_"));return D===-1?(this.headers[d].splice(f,1),void m.debug('error parsing "'.concat(d,'" header field with value "').concat(w,'"'))):(E.parsed=D,D)}m.debug('not so many "'.concat(d,'" headers present'))}else m.debug('header "'.concat(d,'" not present'))}},{key:"s",value:function(d,f){return this.parseHeader(d,f)}},{key:"setHeader",value:function(d,f){var E={raw:f};this.headers[C.headerize(d)]=[E]}},{key:"parseSDP",value:function(d){return!d&&this.sdp?this.sdp:(this.sdp=a.parse(this.body||""),this.sdp)}},{key:"toString",value:function(){return this.data}}]),G}(),x=function(G){N(f,T);var d=M(f);function f(E){var w;return R(this,f),(w=d.call(this)).ua=E,w.headers={},w.ruri=null,w.transport=null,w.server_transaction=null,w}return _(f,[{key:"reply",value:function(E,w,D,O,F,B){var $=[],l=this.getHeader("To");if(w=w||null,!(E=E||null)||E<100||E>699)throw new TypeError("Invalid status_code: ".concat(E));if(w&&typeof w!="string"&&!(w instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(w));w=w||y.REASON_PHRASE[E]||"",D=C.cloneArray(D),this.ua.configuration.extra_headers&&(D=D.concat(this.ua.configuration.extra_headers));var h="SIP/2.0 ".concat(E," ").concat(w,`\r
`);if(this.method===y.INVITE&&E>100&&E<=200){var k,P=t(this.getHeaders("record-route"));try{for(P.s();!(k=P.n()).done;){var W=k.value;h+="Record-Route: ".concat(W,`\r
`)}}catch(de){P.e(de)}finally{P.f()}}var K,z=t(this.getHeaders("via"));try{for(z.s();!(K=z.n()).done;){var ne=K.value;h+="Via: ".concat(ne,`\r
`)}}catch(de){z.e(de)}finally{z.f()}!this.to_tag&&E>100?l+=";tag=".concat(C.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(l+=";tag=".concat(this.to_tag)),h+="To: ".concat(l,`\r
`),h+="From: ".concat(this.getHeader("From"),`\r
`),h+="Call-ID: ".concat(this.call_id,`\r
`),h+="CSeq: ".concat(this.cseq," ").concat(this.method,`\r
`);var Z,X=t(D);try{for(X.s();!(Z=X.n()).done;){var ie=Z.value;h+="".concat(ie.trim(),`\r
`)}}catch(de){X.e(de)}finally{X.f()}switch(this.method){case y.INVITE:this.ua.configuration.session_timers&&$.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&$.push("gruu"),$.push("ice","replaces");break;case y.UPDATE:this.ua.configuration.session_timers&&$.push("timer"),O&&$.push("ice"),$.push("replaces")}if($.push("outbound"),this.method===y.OPTIONS?(h+="Allow: ".concat(y.ALLOWED_METHODS,`\r
`),h+="Accept: ".concat(y.ACCEPTED_BODY_TYPES,`\r
`)):E===405?h+="Allow: ".concat(y.ALLOWED_METHODS,`\r
`):E===415&&(h+="Accept: ".concat(y.ACCEPTED_BODY_TYPES,`\r
`)),h+="Supported: ".concat($,`\r
`),O){var ue=C.str_utf8_length(O);h+=`Content-Type: application/sdp\r
`,h+="Content-Length: ".concat(ue,`\r
\r
`),h+=O}else h+="Content-Length: ".concat(0,`\r
\r
`);this.server_transaction.receiveResponse(E,h,F,B)}},{key:"reply_sl",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,D=this.getHeaders("via");if(!E||E<100||E>699)throw new TypeError("Invalid status_code: ".concat(E));if(w&&typeof w!="string"&&!(w instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(w));w=w||y.REASON_PHRASE[E]||"";var O,F="SIP/2.0 ".concat(E," ").concat(w,`\r
`),B=t(D);try{for(B.s();!(O=B.n()).done;){var $=O.value;F+="Via: ".concat($,`\r
`)}}catch(W){B.e(W)}finally{B.f()}var l=this.getHeader("To");if(!this.to_tag&&E>100?l+=";tag=".concat(C.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(l+=";tag=".concat(this.to_tag)),F+="To: ".concat(l,`\r
`),F+="From: ".concat(this.getHeader("From"),`\r
`),F+="Call-ID: ".concat(this.call_id,`\r
`),F+="CSeq: ".concat(this.cseq," ").concat(this.method,`\r
`),this.ua.configuration.extra_headers){var h,k=t(this.ua.configuration.extra_headers);try{for(k.s();!(h=k.n()).done;){var P=h.value;F+="".concat(P.trim(),`\r
`)}}catch(W){k.e(W)}finally{k.f()}}F+="Content-Length: ".concat(0,`\r
\r
`),this.transport.send(F)}}]),f}(),Q=function(G){N(f,T);var d=M(f);function f(){var E;return R(this,f),(E=d.call(this)).headers={},E.status_code=null,E.reason_phrase=null,E}return _(f)}();V.exports={OutgoingRequest:S,InitialOutgoingInviteRequest:b,IncomingRequest:x,IncomingResponse:Q}},{"./Constants":2,"./Grammar":7,"./Logger":9,"./NameAddrHeader":11,"./Utils":30,"sdp-transform":39}],23:[function(A,V,j){var L=A("./Logger"),N=A("./Utils"),i=A("./Grammar"),M=new L("Socket");j.isSocket=function(q){if(Array.isArray(q))return!1;if(q===void 0)return M.warn("undefined JsSIP.Socket instance"),!1;try{if(!N.isString(q.url))throw M.warn("missing or invalid JsSIP.Socket url property"),new Error("Missing or invalid JsSIP.Socket url property");if(!N.isString(q.via_transport))throw M.warn("missing or invalid JsSIP.Socket via_transport property"),new Error("Missing or invalid JsSIP.Socket via_transport property");if(i.parse(q.sip_uri,"SIP_URI")===-1)throw M.warn("missing or invalid JsSIP.Socket sip_uri property"),new Error("missing or invalid JsSIP.Socket sip_uri property")}catch{return!1}try{["connect","disconnect","send"].forEach(function(t){if(!N.isFunction(q[t]))throw M.warn("missing or invalid JsSIP.Socket method: ".concat(t)),new Error("Missing or invalid JsSIP.Socket method: ".concat(t))})}catch{return!1}return!0}},{"./Grammar":7,"./Logger":9,"./Utils":30}],24:[function(A,V,j){function L(S){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(S)}function N(S,b){var T=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(!T){if(Array.isArray(S)||(T=function(E,w){if(E){if(typeof E=="string")return i(E,w);var D=Object.prototype.toString.call(E).slice(8,-1);if(D==="Object"&&E.constructor&&(D=E.constructor.name),D==="Map"||D==="Set")return Array.from(E);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return i(E,w)}}(S))||b){T&&(S=T);var x=0,Q=function(){};return{s:Q,n:function(){return x>=S.length?{done:!0}:{done:!1,value:S[x++]}},e:function(E){throw E},f:Q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var G,d=!0,f=!1;return{s:function(){T=T.call(S)},n:function(){var E=T.next();return d=E.done,E},e:function(E){f=!0,G=E},f:function(){try{d||T.return==null||T.return()}finally{if(f)throw G}}}}function i(S,b){(b==null||b>S.length)&&(b=S.length);for(var T=0,x=new Array(b);T<b;T++)x[T]=S[T];return x}function M(S,b){for(var T=0;T<b.length;T++){var x=b[T];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(S,x.key,x)}}function q(S,b){return(q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,x){return T.__proto__=x,T})(S,b)}function t(S){var b=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,x=I(S);if(b){var Q=I(this).constructor;T=Reflect.construct(x,arguments,Q)}else T=x.apply(this,arguments);return function(G,d){if(d&&(L(d)==="object"||typeof d=="function"))return d;if(d!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}(G)}(this,T)}}function I(S){return(I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(b){return b.__proto__||Object.getPrototypeOf(b)})(S)}var R=A("events").EventEmitter,s=A("./Logger"),_=A("./Constants"),a=A("./Utils"),v=A("./Grammar"),y=A("./SIPMessage"),C=A("./RequestSender"),c=A("./Dialog"),p=new s("Subscriber"),m={SUBSCRIBE_RESPONSE_TIMEOUT:0,SUBSCRIBE_TRANSPORT_ERROR:1,SUBSCRIBE_NON_OK_RESPONSE:2,SUBSCRIBE_BAD_OK_RESPONSE:3,SUBSCRIBE_FAILED_AUTHENTICATION:4,UNSUBSCRIBE_TIMEOUT:5,RECEIVE_FINAL_NOTIFY:6,RECEIVE_BAD_NOTIFY:7,STATE_PENDING:0,STATE_ACTIVE:1,STATE_TERMINATED:2,STATE_INIT:3,STATE_NOTIFY_WAIT:4};V.exports=function(S){(function(d,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(f&&f.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),Object.defineProperty(d,"prototype",{writable:!1}),f&&q(d,f)})(G,R);var b,T,x,Q=t(G);function G(d,f,E,w,D){var O,F=D.expires,B=D.contentType,$=D.allowEvents,l=D.params,h=D.extraHeaders;if(function(K,z){if(!(K instanceof z))throw new TypeError("Cannot call a class as a function")}(this,G),p.debug("new"),O=Q.call(this),!f)throw new TypeError("target is undefined");if(!E)throw new TypeError("eventName is undefined");if(!w)throw new TypeError("accept is undefined");O._ua=d,O._target=f,F===0||F||(F=900),O._expires=F,O._content_type=B,O._params=a.cloneObject(l),O._params.from_uri||(O._params.from_uri=O._ua.configuration.uri),O._params.from_tag=a.newTag(),O._params.to_tag=null,O._params.call_id=a.createRandomToken(20),O._params.cseq===void 0&&(O._params.cseq=Math.floor(1e4*Math.random()+1)),O._state=m.STATE_INIT,O._dialog=null,O._expires_timer=null,O._expires_timestamp=null,O._terminated=!1,O._unsubscribe_timeout_timer=null,O.data={};var k=v.parse(E,"Event");if(k===-1)throw new TypeError("eventName - wrong format");O._event_name=k.event,O._event_id=k.params&&k.params.id;var P=O._event_name;if(O._event_id&&(P+=";id=".concat(O._event_id)),O._headers=a.cloneArray(h),O._headers=O._headers.concat(["Event: ".concat(P),"Expires: ".concat(O._expires),"Accept: ".concat(w)]),!O._headers.find(function(K){return K.startsWith("Contact")})){var W="Contact: ".concat(O._ua._contact.toString());O._headers.push(W)}return $&&O._headers.push("Allow-Events: ".concat($)),O._queue=[],O}return b=G,x=[{key:"C",get:function(){return m}}],(T=[{key:"C",get:function(){return m}},{key:"onRequestTimeout",value:function(){this._dialogTerminated(m.SUBSCRIBE_RESPONSE_TIMEOUT)}},{key:"onTransportError",value:function(){this._dialogTerminated(m.SUBSCRIBE_TRANSPORT_ERROR)}},{key:"receiveRequest",value:function(d){if(d.method!==_.NOTIFY)return p.warn("received non-NOTIFY request"),void d.reply(405);var f=d.parseHeader("Event");if(!f)return p.warn("missed Event header"),d.reply(400),void this._dialogTerminated(m.RECEIVE_BAD_NOTIFY);var E=f.event,w=f.params&&f.params.id;if(E!==this._event_name||w!==this._event_id)return p.warn("Event header does not match SUBSCRIBE"),d.reply(489),void this._dialogTerminated(m.RECEIVE_BAD_NOTIFY);var D=d.parseHeader("subscription-state");if(!D)return p.warn("missed Subscription-State header"),d.reply(400),void this._dialogTerminated(m.RECEIVE_BAD_NOTIFY);d.reply(200);var O=this._stateStringToNumber(D.state),F=this._state;if(F!==m.STATE_TERMINATED&&O!==m.STATE_TERMINATED&&(this._state=O,D.expires!==void 0)){var B=D.expires,$=new Date().getTime()+1e3*B;this._expires_timestamp-$>2e3&&(p.debug("update sending re-SUBSCRIBE time"),this._scheduleSubscribe(B))}F!==m.STATE_PENDING&&O===m.STATE_PENDING?(p.debug('emit "pending"'),this.emit("pending")):F!==m.STATE_ACTIVE&&O===m.STATE_ACTIVE&&(p.debug('emit "active"'),this.emit("active"));var l=d.body,h=O===m.STATE_TERMINATED;if(l){var k=d.getHeader("content-type");p.debug('emit "notify"'),this.emit("notify",h,d,l,k)}if(h){var P=D.reason,W=void 0;D.params&&D.params["retry-after"]!==void 0&&(W=parseInt(D.params["retry-after"])),this._dialogTerminated(m.RECEIVE_FINAL_NOTIFY,P,W)}}},{key:"subscribe",value:function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;p.debug("subscribe()"),this._state===m.STATE_INIT?this._sendInitialSubscribe(d,this._headers):this._sendSubsequentSubscribe(d,this._headers)}},{key:"terminate",value:function(){var d=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(p.debug("terminate()"),!this._terminated){this._terminated=!0;var E=this._headers.map(function(w){return w.startsWith("Expires")?"Expires: 0":w});this._state===m.STATE_INIT?this._sendInitialSubscribe(f,E):this._sendSubsequentSubscribe(f,E),this._unsubscribe_timeout_timer=setTimeout(function(){d._dialogTerminated(m.UNSUBSCRIBE_TIMEOUT)},3e4)}}},{key:"state",get:function(){return this._state}},{key:"id",get:function(){return this._dialog?this._dialog.id:null}},{key:"_sendInitialSubscribe",value:function(d,f){var E=this;if(d){if(!this._content_type)throw new TypeError("content_type is undefined");(f=f.slice()).push("Content-Type: ".concat(this._content_type))}this._state=m.STATE_NOTIFY_WAIT;var w=new y.OutgoingRequest(_.SUBSCRIBE,this._ua.normalizeTarget(this._target),this._ua,this._params,f,d);new C(this._ua,w,{onRequestTimeout:function(){E.onRequestTimeout()},onTransportError:function(){E.onTransportError()},onReceiveResponse:function(D){E._receiveSubscribeResponse(D)}}).send()}},{key:"_receiveSubscribeResponse",value:function(d){if(d.status_code>=200&&d.status_code<300){if(this._dialog===null){var f=new c(this,d,"UAC");if(f.error)return p.warn(f.error),void this._dialogTerminated(m.SUBSCRIBE_BAD_OK_RESPONSE);this._dialog=f,p.debug('emit "accepted"'),this.emit("accepted");var E,w=N(this._queue);try{for(w.s();!(E=w.n()).done;){var D=E.value;p.debug("dequeue subscribe"),this._sendSubsequentSubscribe(D.body,D.headers)}}catch(B){w.e(B)}finally{w.f()}}var O=d.getHeader("expires");O===0||O||(p.warn("response without Expires header"),O="900");var F=parseInt(O);F>0&&this._scheduleSubscribe(F)}else d.status_code===401||d.status_code===407?this._dialogTerminated(m.SUBSCRIBE_FAILED_AUTHENTICATION):d.status_code>=300&&this._dialogTerminated(m.SUBSCRIBE_NON_OK_RESPONSE)}},{key:"_sendSubsequentSubscribe",value:function(d,f){var E=this;if(this._state!==m.STATE_TERMINATED){if(!this._dialog)return p.debug("enqueue subscribe"),void this._queue.push({body:d,headers:f.slice()});if(d){if(!this._content_type)throw new TypeError("content_type is undefined");(f=f.slice()).push("Content-Type: ".concat(this._content_type))}this._dialog.sendRequest(_.SUBSCRIBE,{body:d,extraHeaders:f,eventHandlers:{onRequestTimeout:function(){E.onRequestTimeout()},onTransportError:function(){E.onTransportError()},onSuccessResponse:function(w){E._receiveSubscribeResponse(w)},onErrorResponse:function(w){E._receiveSubscribeResponse(w)},onDialogError:function(w){E._receiveSubscribeResponse(w)}}})}}},{key:"_dialogTerminated",value:function(d){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this._state!==m.STATE_TERMINATED&&(this._state=m.STATE_TERMINATED,clearTimeout(this._expires_timer),clearTimeout(this._unsubscribe_timeout_timer),this._dialog&&(this._dialog.terminate(),this._dialog=null),p.debug('emit "terminated" code='.concat(d)),this.emit("terminated",d,f,E))}},{key:"_scheduleSubscribe",value:function(d){var f=this,E=d>=140?1e3*d/2+Math.floor(1e3*(d/2-70)*Math.random()):1e3*d-5e3;this._expires_timestamp=new Date().getTime()+1e3*d,p.debug("next SUBSCRIBE will be sent in ".concat(Math.floor(E/1e3)," sec")),clearTimeout(this._expires_timer),this._expires_timer=setTimeout(function(){f._expires_timer=null,f._sendSubsequentSubscribe(null,f._headers)},E)}},{key:"_stateStringToNumber",value:function(d){switch(d){case"pending":return m.STATE_PENDING;case"active":return m.STATE_ACTIVE;case"terminated":return m.STATE_TERMINATED;case"init":return m.STATE_INIT;case"notify_wait":return m.STATE_NOTIFY_WAIT;default:throw new TypeError("wrong state value")}}}])&&M(b.prototype,T),x&&M(b,x),Object.defineProperty(b,"prototype",{writable:!1}),G}()},{"./Constants":2,"./Dialog":3,"./Grammar":7,"./Logger":9,"./RequestSender":21,"./SIPMessage":22,"./Utils":30,events:33}],25:[function(A,V,j){var L=500;V.exports={T1:L,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},{}],26:[function(A,V,j){function L(E){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w})(E)}function N(E,w){if(!(E instanceof w))throw new TypeError("Cannot call a class as a function")}function i(E,w){for(var D=0;D<w.length;D++){var O=w[D];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(E,O.key,O)}}function M(E,w,D){return w&&i(E.prototype,w),Object.defineProperty(E,"prototype",{writable:!1}),E}function q(E,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function");E.prototype=Object.create(w&&w.prototype,{constructor:{value:E,writable:!0,configurable:!0}}),Object.defineProperty(E,"prototype",{writable:!1}),w&&t(E,w)}function t(E,w){return(t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,O){return D.__proto__=O,D})(E,w)}function I(E){var w=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var D,O=s(E);if(w){var F=s(this).constructor;D=Reflect.construct(O,arguments,F)}else D=O.apply(this,arguments);return function(B,$){if($&&(L($)==="object"||typeof $=="function"))return $;if($!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return R(B)}(this,D)}}function R(E){if(E===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return E}function s(E){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(w){return w.__proto__||Object.getPrototypeOf(w)})(E)}var _=A("events").EventEmitter,a=A("./Logger"),v=A("./Constants"),y=A("./SIPMessage"),C=A("./Timers"),c=new a("NonInviteClientTransaction"),p=new a("InviteClientTransaction"),m=new a("AckClientTransaction"),S=new a("NonInviteServerTransaction"),b=new a("InviteServerTransaction"),T={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},x=function(E){q(D,_);var w=I(D);function D(O,F,B,$){var l;N(this,D),(l=w.call(this)).type=T.NON_INVITE_CLIENT,l.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),l.ua=O,l.transport=F,l.request=B,l.eventHandlers=$;var h="SIP/2.0/".concat(F.via_transport);return h+=" ".concat(O.configuration.via_host,";branch=").concat(l.id),l.request.setHeader("via",h),l.ua.newTransaction(R(l)),l}return M(D,[{key:"C",get:function(){return T}},{key:"stateChanged",value:function(O){this.state=O,this.emit("stateChanged")}},{key:"send",value:function(){var O=this;this.stateChanged(T.STATUS_TRYING),this.F=setTimeout(function(){O.timer_F()},C.TIMER_F),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){c.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.F),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}},{key:"timer_F",value:function(){c.debug("Timer F expired for transaction ".concat(this.id)),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}},{key:"timer_K",value:function(){this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"receiveResponse",value:function(O){var F=O.status_code;if(F<200)switch(this.state){case T.STATUS_TRYING:case T.STATUS_PROCEEDING:this.stateChanged(T.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(O)}else switch(this.state){case T.STATUS_TRYING:case T.STATUS_PROCEEDING:this.stateChanged(T.STATUS_COMPLETED),clearTimeout(this.F),F===408?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(O),this.timer_K();break;case T.STATUS_COMPLETED:}}}]),D}(),Q=function(E){q(D,_);var w=I(D);function D(O,F,B,$){var l;N(this,D),(l=w.call(this)).type=T.INVITE_CLIENT,l.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),l.ua=O,l.transport=F,l.request=B,l.eventHandlers=$,B.transaction=R(l);var h="SIP/2.0/".concat(F.via_transport);return h+=" ".concat(O.configuration.via_host,";branch=").concat(l.id),l.request.setHeader("via",h),l.ua.newTransaction(R(l)),l}return M(D,[{key:"C",get:function(){return T}},{key:"stateChanged",value:function(O){this.state=O,this.emit("stateChanged")}},{key:"send",value:function(){var O=this;this.stateChanged(T.STATUS_CALLING),this.B=setTimeout(function(){O.timer_B()},C.TIMER_B),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){clearTimeout(this.B),clearTimeout(this.M),this.state!==T.STATUS_ACCEPTED&&(p.debug("transport error occurred, deleting transaction ".concat(this.id)),this.eventHandlers.onTransportError()),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_M",value:function(){p.debug("Timer M expired for transaction ".concat(this.id)),this.state===T.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"timer_B",value:function(){p.debug("Timer B expired for transaction ".concat(this.id)),this.state===T.STATUS_CALLING&&(this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}},{key:"timer_D",value:function(){p.debug("Timer D expired for transaction ".concat(this.id)),clearTimeout(this.B),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"sendACK",value:function(O){var F=new y.OutgoingRequest(v.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});F.setHeader("from",this.request.getHeader("from")),F.setHeader("via",this.request.getHeader("via")),F.setHeader("to",O.getHeader("to")),this.transport.send(F),this.timer_D()}},{key:"cancel",value:function(O){if(this.state===T.STATUS_PROCEEDING){var F=new y.OutgoingRequest(v.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});F.setHeader("from",this.request.getHeader("from")),F.setHeader("via",this.request.getHeader("via")),F.setHeader("to",this.request.getHeader("to")),O&&F.setHeader("reason",O),this.transport.send(F)}}},{key:"receiveResponse",value:function(O){var F=this,B=O.status_code;if(B>=100&&B<=199)switch(this.state){case T.STATUS_CALLING:this.stateChanged(T.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(O);break;case T.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(O)}else if(B>=200&&B<=299)switch(this.state){case T.STATUS_CALLING:case T.STATUS_PROCEEDING:this.stateChanged(T.STATUS_ACCEPTED),this.M=setTimeout(function(){F.timer_M()},C.TIMER_M),this.eventHandlers.onReceiveResponse(O);break;case T.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(O)}else if(B>=300&&B<=699)switch(this.state){case T.STATUS_CALLING:case T.STATUS_PROCEEDING:this.stateChanged(T.STATUS_COMPLETED),this.sendACK(O),this.eventHandlers.onReceiveResponse(O);break;case T.STATUS_COMPLETED:this.sendACK(O)}}}]),D}(),G=function(E){q(D,_);var w=I(D);function D(O,F,B,$){var l;N(this,D),(l=w.call(this)).id="z9hG4bK".concat(Math.floor(1e7*Math.random())),l.transport=F,l.request=B,l.eventHandlers=$;var h="SIP/2.0/".concat(F.via_transport);return h+=" ".concat(O.configuration.via_host,";branch=").concat(l.id),l.request.setHeader("via",h),l}return M(D,[{key:"C",get:function(){return T}},{key:"send",value:function(){this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){m.debug("transport error occurred for transaction ".concat(this.id)),this.eventHandlers.onTransportError()}}]),D}(),d=function(E){q(D,_);var w=I(D);function D(O,F,B){var $;return N(this,D),($=w.call(this)).type=T.NON_INVITE_SERVER,$.id=B.via_branch,$.ua=O,$.transport=F,$.request=B,$.last_response="",B.server_transaction=R($),$.state=T.STATUS_TRYING,O.newTransaction(R($)),$}return M(D,[{key:"C",get:function(){return T}},{key:"stateChanged",value:function(O){this.state=O,this.emit("stateChanged")}},{key:"timer_J",value:function(){S.debug("Timer J expired for transaction ".concat(this.id)),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,S.debug("transport error occurred, deleting transaction ".concat(this.id)),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"receiveResponse",value:function(O,F,B,$){if(O===100)switch(this.state){case T.STATUS_TRYING:this.stateChanged(T.STATUS_PROCEEDING),this.transport.send(F)||this.onTransportError();break;case T.STATUS_PROCEEDING:this.last_response=F,this.transport.send(F)?B&&B():(this.onTransportError(),$&&$())}else if(O>=200&&O<=699)switch(this.state){case T.STATUS_TRYING:case T.STATUS_PROCEEDING:this.stateChanged(T.STATUS_COMPLETED),this.last_response=F,this.timer_J(),this.transport.send(F)?B&&B():(this.onTransportError(),$&&$());break;case T.STATUS_COMPLETED:}}}]),D}(),f=function(E){q(D,_);var w=I(D);function D(O,F,B){var $;return N(this,D),($=w.call(this)).type=T.INVITE_SERVER,$.id=B.via_branch,$.ua=O,$.transport=F,$.request=B,$.last_response="",B.server_transaction=R($),$.state=T.STATUS_PROCEEDING,O.newTransaction(R($)),$.resendProvisionalTimer=null,B.reply(100),$}return M(D,[{key:"C",get:function(){return T}},{key:"stateChanged",value:function(O){this.state=O,this.emit("stateChanged")}},{key:"timer_H",value:function(){b.debug("Timer H expired for transaction ".concat(this.id)),this.state===T.STATUS_COMPLETED&&b.debug("ACK not received, dialog will be terminated"),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_I",value:function(){this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_L",value:function(){b.debug("Timer L expired for transaction ".concat(this.id)),this.state===T.STATUS_ACCEPTED&&(this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,b.debug("transport error occurred, deleting transaction ".concat(this.id)),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),this.stateChanged(T.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"resend_provisional",value:function(){this.transport.send(this.last_response)||this.onTransportError()}},{key:"receiveResponse",value:function(O,F,B,$){var l=this;if(O>=100&&O<=199)switch(this.state){case T.STATUS_PROCEEDING:this.transport.send(F)||this.onTransportError(),this.last_response=F}if(O>100&&O<=199&&this.state===T.STATUS_PROCEEDING)this.resendProvisionalTimer===null&&(this.resendProvisionalTimer=setInterval(function(){l.resend_provisional()},C.PROVISIONAL_RESPONSE_INTERVAL));else if(O>=200&&O<=299)switch(this.state){case T.STATUS_PROCEEDING:this.stateChanged(T.STATUS_ACCEPTED),this.last_response=F,this.L=setTimeout(function(){l.timer_L()},C.TIMER_L),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case T.STATUS_ACCEPTED:this.transport.send(F)?B&&B():(this.onTransportError(),$&&$())}else if(O>=300&&O<=699)switch(this.state){case T.STATUS_PROCEEDING:this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(F)?(this.stateChanged(T.STATUS_COMPLETED),this.H=setTimeout(function(){l.timer_H()},C.TIMER_H),B&&B()):(this.onTransportError(),$&&$())}}}]),D}();V.exports={C:T,NonInviteClientTransaction:x,InviteClientTransaction:Q,AckClientTransaction:G,NonInviteServerTransaction:d,InviteServerTransaction:f,checkTransaction:function(E,w){var D,O=E._transactions;switch(w.method){case v.INVITE:if(D=O.ist[w.via_branch]){switch(D.state){case T.STATUS_PROCEEDING:D.transport.send(D.last_response);break;case T.STATUS_ACCEPTED:}return!0}break;case v.ACK:if(!(D=O.ist[w.via_branch])||D.state===T.STATUS_ACCEPTED)return!1;if(D.state===T.STATUS_COMPLETED)return D.state=T.STATUS_CONFIRMED,D.timer_I(),!0;break;case v.CANCEL:return(D=O.ist[w.via_branch])?(w.reply_sl(200),D.state!==T.STATUS_PROCEEDING):(w.reply_sl(481),!0);default:if(D=O.nist[w.via_branch]){switch(D.state){case T.STATUS_TRYING:break;case T.STATUS_PROCEEDING:case T.STATUS_COMPLETED:D.transport.send(D.last_response)}return!0}}}}},{"./Constants":2,"./Logger":9,"./SIPMessage":22,"./Timers":25,events:33}],27:[function(A,V,j){function L(s,_){var a=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!a){if(Array.isArray(s)||(a=function(m,S){if(m){if(typeof m=="string")return N(m,S);var b=Object.prototype.toString.call(m).slice(8,-1);if(b==="Object"&&m.constructor&&(b=m.constructor.name),b==="Map"||b==="Set")return Array.from(m);if(b==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return N(m,S)}}(s))||_){a&&(s=a);var v=0,y=function(){};return{s:y,n:function(){return v>=s.length?{done:!0}:{done:!1,value:s[v++]}},e:function(m){throw m},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C,c=!0,p=!1;return{s:function(){a=a.call(s)},n:function(){var m=a.next();return c=m.done,m},e:function(m){p=!0,C=m},f:function(){try{c||a.return==null||a.return()}finally{if(p)throw C}}}}function N(s,_){(_==null||_>s.length)&&(_=s.length);for(var a=0,v=new Array(_);a<_;a++)v[a]=s[a];return v}function i(s,_){for(var a=0;a<_.length;a++){var v=_[a];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(s,v.key,v)}}var M=A("./Logger"),q=A("./Socket"),t=A("./Constants"),I=new M("Transport"),R={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:t.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:t.CONNECTION_RECOVERY_MAX_INTERVAL}};V.exports=function(){function s(v,y){var C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:R.recovery_options;(function(c,p){if(!(c instanceof p))throw new TypeError("Cannot call a class as a function")})(this,s),I.debug("new()"),this._ua=v,this.status=R.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=C,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1;try{this.textDecoder=new TextDecoder("utf8")}catch(c){I.warn("cannot use TextDecoder: ".concat(c))}if(y===void 0)throw new TypeError("Invalid argument. undefined 'sockets' argument");y instanceof Array||(y=[y]),y.forEach(function(c){if(!q.isSocket(c.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(c.weight&&!Number(c.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:c.socket,weight:c.weight||0,status:R.SOCKET_STATUS_READY})},this),this._getSocket()}var _,a;return _=s,(a=[{key:"via_transport",get:function(){return this.socket.via_transport}},{key:"url",get:function(){return this.socket.url}},{key:"sip_uri",get:function(){return this.socket.sip_uri}},{key:"connect",value:function(){I.debug("connect()"),this.isConnected()?I.debug("Transport is already connected"):this.isConnecting()?I.debug("Transport is connecting"):(this.close_requested=!1,this.status=R.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}},{key:"disconnect",value:function(){I.debug("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=R.STATUS_DISCONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}},{key:"send",value:function(v){if(I.debug("send()"),!this.isConnected())return I.warn("unable to send message, transport is not connected"),!1;var y=v.toString();return I.debug(`sending message:

`.concat(y,`
`)),this.socket.send(y)}},{key:"isConnected",value:function(){return this.status===R.STATUS_CONNECTED}},{key:"isConnecting",value:function(){return this.status===R.STATUS_CONNECTING}},{key:"_get_number_of_sbc",value:function(){return this.sockets.length}},{key:"_switch_sbc",value:function(){var v=this.ondisconnect;this.ondisconnect=function(){},this.disconnect(),this.ondisconnect=v,this.close_requested=!1,this.sockets.forEach(function(y){this.socket===y.socket&&(y.status=R.SOCKET_STATUS_ERROR)},this),this._getSocket(),this.connect()}},{key:"_register_redirect",value:function(v){var y,C=null,c=L(this.sockets);try{for(c.s();!(y=c.n()).done;){var p=y.value;if(p.socket.url===v){C=p.socket;break}}}catch(x){c.e(x)}finally{c.f()}if(C===null&&!v.includes(":",6)){v+=":443";var m,S=L(this.sockets);try{for(S.s();!(m=S.n()).done;){var b=m.value;if(b.socket.url===v){C=b.socket;break}}}catch(x){S.e(x)}finally{S.f()}}if(C===null)return!1;var T=this.ondisconnect;return this.ondisconnect=function(){},this.disconnect(),this.ondisconnect=T,this.socket=C,this.connect(),!0}},{key:"_reconnect",value:function(){var v=this;this.recover_attempts+=1;var y=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);y<this.recovery_options.min_interval?y=this.recovery_options.min_interval:y>this.recovery_options.max_interval&&(y=this.recovery_options.max_interval),I.debug("reconnection attempt: ".concat(this.recover_attempts,". next connection attempt in ").concat(y," seconds")),this.recovery_timer=setTimeout(function(){v.close_requested||v.isConnected()||v.isConnecting()||(v._getSocket(),v.connect())},1e3*y)}},{key:"_getSocket",value:function(){var v=[];if(this.sockets.forEach(function(C){C.status!==R.SOCKET_STATUS_ERROR&&(v.length===0?v.push(C):C.weight>v[0].weight?v=[C]:C.weight===v[0].weight&&v.push(C))}),v.length===0)return this.sockets.forEach(function(C){C.status=R.SOCKET_STATUS_READY}),void this._getSocket();var y=Math.floor(Math.random()*v.length);this.socket=v[y].socket}},{key:"_onConnect",value:function(){this.recover_attempts=0,this._ha_connect_time=void 0,this.status=R.STATUS_CONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}},{key:"_onDisconnect",value:function(v,y,C){var c=this.status;if(this.status=R.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:v,code:y,reason:C}),!this.close_requested){if(this._ua.modes.sbc_ha_pairs_mode!==void 0){if(c===R.STATUS_CONNECTED)return I.debug("AC: SBC HA pairs mode: Reconnect to the same SBC ".concat(this._ua.modes.sbc_ha_pairs_mode," seconds left")),this._ha_connect_time=new Date().getTime()+1e3*this._ua.modes.sbc_ha_pairs_mode,void this._connect2();if(this._ha_connect_time!==void 0){var p=this._ha_connect_time-new Date().getTime();if(p>0)return I.debug("AC: SBC HA pairs mode: Repeat ".concat(p/1e3," seconds left")),void this._connect2();I.debug("AC: SBC HA pairs mode: Failed"),this._ha_connect_time=void 0}}this.sockets.forEach(function(m){this.socket===m.socket&&(m.status=R.SOCKET_STATUS_ERROR)},this),this._reconnect()}}},{key:"_connect2",value:function(){var v=this,y=0;if(this._ha_last_connect){var C=new Date().getTime()-this._ha_last_connect;y=C>500?0:500-C}this.recovery_timer=setTimeout(function(){v.close_requested||v.isConnected()||v.isConnecting()||(v._ha_last_connect=new Date().getTime(),v.connect())},y)}},{key:"_onData",value:function(v){if(v!==`\r
`){if(typeof v!="string"){try{v=this.textDecoder?this.textDecoder.decode(v):String.fromCharCode.apply(null,new Uint8Array(v))}catch{return void I.debug("received binary message failed to be converted into string, message discarded")}I.debug(`received binary message:

`.concat(v,`
`))}else I.debug(`received text message:

`.concat(v,`
`));this.ondata({transport:this,message:v})}else I.debug("received message with CRLF Keep Alive response")}}])&&i(_.prototype,a),Object.defineProperty(_,"prototype",{writable:!1}),s}()},{"./Constants":2,"./Logger":9,"./Socket":23}],28:[function(A,V,j){function L(w){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D})(w)}function N(w,D){for(var O=0;O<D.length;O++){var F=D[O];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(w,F.key,F)}}function i(w,D){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(O,F){return O.__proto__=F,O})(w,D)}function M(w){var D=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var O,F=t(w);if(D){var B=t(this).constructor;O=Reflect.construct(F,arguments,B)}else O=F.apply(this,arguments);return function($,l){if(l&&(L(l)==="object"||typeof l=="function"))return l;if(l!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return q($)}(this,O)}}function q(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function t(w){return(t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(D){return D.__proto__||Object.getPrototypeOf(D)})(w)}var I=A("events").EventEmitter,R=A("./Logger"),s=A("./Constants"),_=A("./Registrator"),a=A("./RTCSession"),v=A("./Subscriber"),y=A("./Notifier"),C=A("./Message"),c=A("./Options"),p=A("./Transactions"),m=A("./Transport"),S=A("./Utils"),b=A("./Exceptions"),T=A("./URI"),x=A("./Parser"),Q=A("./SIPMessage"),G=A("./sanityCheck"),d=A("./Config"),f=new R("UA"),E={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};V.exports=function(w){(function(l,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");l.prototype=Object.create(h&&h.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),Object.defineProperty(l,"prototype",{writable:!1}),h&&i(l,h)})($,I);var D,O,F,B=M($);function $(l){var h;if(function(k,P){if(!(k instanceof P))throw new TypeError("Cannot call a class as a function")}(this,$),(h=B.call(this)).modes={},h._credentials={},h._cache={credentials:{}},h._configuration=Object.assign({},d.settings),h._dynConfiguration={},h._dialogs={},h._applicants={},h._sessions={},h._transport=null,h._contact=null,h._status=E.STATUS_INIT,h._error=null,h._transactions={nist:{},nict:{},ist:{},ict:{}},h._data={},h._closeTimer=null,l===void 0)throw new TypeError("Not enough arguments");try{h._loadConfig(l)}catch(k){throw h._status=E.STATUS_NOT_READY,h._error=E.CONFIGURATION_ERROR,k}return h._registrator=new _(q(h)),h}return D=$,F=[{key:"C",get:function(){return E}}],(O=[{key:"C",get:function(){return E}},{key:"status",get:function(){return this._status}},{key:"contact",get:function(){return this._contact}},{key:"configuration",get:function(){return this._configuration}},{key:"transport",get:function(){return this._transport}},{key:"start",value:function(){f.debug("start()"),this._status===E.STATUS_INIT?this._transport.connect():this._status===E.STATUS_USER_CLOSED?(f.debug("restarting UA"),this._closeTimer!==null&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=E.STATUS_INIT,this._transport.connect()):this._status===E.STATUS_READY?f.debug("UA is in READY status, not restarted"):f.debug("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}},{key:"register",value:function(){f.debug("register()"),this._dynConfiguration.register=!0,this._registrator.register()}},{key:"unregister",value:function(l){f.debug("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(l)}},{key:"registrator",value:function(){return this._registrator}},{key:"isRegistered",value:function(){return this._registrator.registered}},{key:"isConnected",value:function(){return this._transport.isConnected()}},{key:"call",value:function(l,h){f.debug("call()");var k=new a(this);return k.connect(l,h),k}},{key:"sendMessage",value:function(l,h,k){f.debug("sendMessage()");var P=new C(this);return P.send(l,h,k),P}},{key:"subscribe",value:function(l,h,k,P){return f.debug("subscribe()"),new v(this,l,h,k,P)}},{key:"notify",value:function(l,h,k){return f.debug("notify()"),new y(this,l,h,k)}},{key:"addCredential",value:function(l){this._credentials[l.realm]=S.cloneObject(l)}},{key:"getCredential",value:function(l){var h=this._credentials[l];return h||{username:this._configuration.authorization_user,password:this._configuration.password,realm:this._configuration.realm,ha1:this._configuration.ha1}}},{key:"updateCredential",value:function(l,h,k){var P=this._credentials[l];P?(P.realm=h,P.ha1=k):(this.set("realm",h),this.set("ha1",k))}},{key:"sendOptions",value:function(l,h,k){f.debug("sendOptions()");var P=new c(this);return P.send(l,h,k),P}},{key:"terminateSessions",value:function(l){for(var h in f.debug("terminateSessions()"),this._sessions)this._sessions[h].isEnded()||this._sessions[h].terminate(l)}},{key:"stop",value:function(){var l=this;if(f.debug("stop()"),this._dynConfiguration={},this._status!==E.STATUS_USER_CLOSED){this._registrator.close();var h=Object.keys(this._sessions).length;for(var k in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,k)){f.debug("closing session ".concat(k));try{this._sessions[k].terminate()}catch{}}for(var P in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,P))try{this._applicants[P].close()}catch{}this._status=E.STATUS_USER_CLOSED,Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length===0&&h===0?this._transport.disconnect():this._closeTimer=setTimeout(function(){l._closeTimer=null,l._transport.disconnect()},2e3)}else f.debug("UA already closed")}},{key:"normalizeTarget",value:function(l){return S.normalizeTarget(l,this._configuration.hostport_params)}},{key:"get",value:function(l){switch(l){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;case"authorization_jwt":return this._configuration.authorization_jwt;default:return void f.warn('get() | cannot get "%s" parameter in runtime',l)}}},{key:"set",value:function(l,h){switch(l){case"authorization_user":this._configuration.authorization_user=String(h);break;case"password":this._configuration.password=String(h);break;case"realm":this._configuration.realm=String(h);break;case"ha1":this._configuration.ha1=String(h),this._configuration.password=null;break;case"authorization_jwt":this._configuration.authorization_jwt=String(h);break;case"display_name":this._configuration.display_name=h;break;default:return f.warn('set() | cannot set "%s" parameter in runtime',l),!1}return!0}},{key:"registerRedirect",value:function(l){return!!this._transport._register_redirect(l)||(f.debug('registerRedirect: ignored, "'.concat(l,'" is not found in configuration')),!1)}},{key:"switchSBC",value:function(l){return this._transport._get_number_of_sbc()<2?(f.debug("switchSBC: ignored, no other SBC"),!1):(l&&this._registrator._unregistered(null,s.causes.CONNECTION_ERROR),this._transport._switch_sbc(),!0)}},{key:"getNumberOfSBC",value:function(){return this._transport._get_number_of_sbc()}},{key:"newTransaction",value:function(l){this._transactions[l.type][l.id]=l,this.emit("newTransaction",{transaction:l})}},{key:"destroyTransaction",value:function(l){delete this._transactions[l.type][l.id],this.emit("transactionDestroyed",{transaction:l})}},{key:"newDialog",value:function(l){this._dialogs[l.id]=l}},{key:"destroyDialog",value:function(l){delete this._dialogs[l.id]}},{key:"newMessage",value:function(l,h){this._applicants[l]=l,this.emit("newMessage",h)}},{key:"newOptions",value:function(l,h){this._applicants[l]=l,this.emit("newOptions",h)}},{key:"destroyMessage",value:function(l){delete this._applicants[l]}},{key:"newRTCSession",value:function(l,h){this._sessions[l.id]=l,this.emit("newRTCSession",h)}},{key:"destroyRTCSession",value:function(l){delete this._sessions[l.id]}},{key:"registered",value:function(l){this.emit("registered",l)}},{key:"unregistered",value:function(l){this.emit("unregistered",l)}},{key:"registrationFailed",value:function(l){this.emit("registrationFailed",l)}},{key:"receiveRequest",value:function(l){var h=l.method;if(l.ruri.user!==this._configuration.uri.user&&l.ruri.user!==this._contact.uri.user)return f.debug("Request-URI does not point to us"),void(l.method!==s.ACK&&l.reply_sl(404));if(l.ruri.scheme!==s.SIPS){if(!p.checkTransaction(this,l)){if(h===s.INVITE?new p.InviteServerTransaction(this,this._transport,l):h!==s.ACK&&h!==s.CANCEL&&new p.NonInviteServerTransaction(this,this._transport,l),h===s.OPTIONS){if(this.listeners("newOptions").length===0)return void l.reply(200);new c(this).init_incoming(l)}else if(h===s.MESSAGE){if(this.listeners("newMessage").length===0)return void l.reply(405);new C(this).init_incoming(l)}else if(h===s.SUBSCRIBE){if(this.listeners("newSubscribe").length===0)return void l.reply(405)}else if(h===s.INVITE&&!l.to_tag&&this.listeners("newRTCSession").length===0)return void l.reply(405);var k,P;if(l.to_tag)(k=this._findDialog(l.call_id,l.from_tag,l.to_tag))?k.receiveRequest(l):h===s.NOTIFY?(P=this._findSession(l))?P.receiveRequest(l):(f.debug("received NOTIFY request for a non existent subscription"),l.reply(481,"Subscription does not exist")):h!==s.ACK&&l.reply(481);else switch(h){case s.INVITE:if(window.RTCPeerConnection)if(l.hasHeader("replaces")){var W=l.replaces;(k=this._findDialog(W.call_id,W.from_tag,W.to_tag))?(P=k.owner).isEnded()?l.reply(603):P.receiveRequest(l):l.reply(481)}else(P=new a(this)).init_incoming(l);else f.warn("INVITE received but WebRTC is not supported"),l.reply(488);break;case s.BYE:l.reply(481);break;case s.CANCEL:(P=this._findSession(l))?P.receiveRequest(l):f.debug("received CANCEL request for a non existent session");break;case s.ACK:break;case s.NOTIFY:this.emit("sipEvent",{event:l.event,request:l}),l.reply(200);break;case s.SUBSCRIBE:this.emit("newSubscribe",{event:l.event,request:l});break;default:l.reply(405)}}}else l.reply_sl(416)}},{key:"_findSession",value:function(l){var h=l.call_id,k=l.from_tag,P=l.to_tag,W=h+k,K=this._sessions[W],z=h+P,ne=this._sessions[z];return K||ne||null}},{key:"_findDialog",value:function(l,h,k){var P=l+h+k,W=this._dialogs[P];return W||(P=l+k+h,(W=this._dialogs[P])||null)}},{key:"_loadConfig",value:function(l){try{d.load(this._configuration,l)}catch(z){throw z}this._configuration.display_name===0&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=S.newUUID()),this._configuration.jssip_id=S.createRandomToken(5);var h=this._configuration.uri.clone();h.user=null,this._configuration.hostport_params=h.toString().replace(/^sip:/i,"");try{this._transport=new m(this,this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=(function(z){this.emit("connecting",z)}).bind(this),this._transport.onconnect=(function(z){this._status!==E.STATUS_USER_CLOSED&&(this._status=E.STATUS_READY,this._error=null,this.emit("connected",z),this._dynConfiguration.register&&this._registrator.register())}).bind(this),this._transport.ondisconnect=(function(z){for(var ne=0,Z=["nict","ict","nist","ist"];ne<Z.length;ne++){var X=Z[ne];for(var ie in this._transactions[X])Object.prototype.hasOwnProperty.call(this._transactions[X],ie)&&this._transactions[X][ie].onTransportError()}this.emit("disconnected",z),this._registrator.onTransportClosed(),this._status!==E.STATUS_USER_CLOSED&&(this._status=E.STATUS_NOT_READY,this._error=E.NETWORK_ERROR)}).bind(this),this._transport.ondata=(function(z){var ne=z.transport,Z=z.message;if((Z=x.parseMessage(Z,this))&&!(this._status===E.STATUS_USER_CLOSED&&Z instanceof Q.IncomingRequest)&&G(Z,this,ne)){if(Z instanceof Q.IncomingRequest)Z.transport=ne,this.receiveRequest(Z);else if(Z instanceof Q.IncomingResponse){var X;switch(Z.method){case s.INVITE:(X=this._transactions.ict[Z.via_branch])&&X.receiveResponse(Z);break;case s.ACK:break;default:(X=this._transactions.nict[Z.via_branch])&&X.receiveResponse(Z)}}}}).bind(this)}catch(z){throw f.warn(z),new b.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){var k=this._configuration.uri.clone();k.user=null,k.clearParams(),k.clearHeaders(),this._configuration.registrar_server=k}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new T("sip",S.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString:function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ne=z.anonymous||null,Z=z.outbound||null,X="<";return X+=ne?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!Z||(ne?this.temp_gruu:this.pub_gruu)||(X+=";ob"),X+=">"}};var P=["authorization_user","password","realm","ha1","authorization_jwt","display_name","register"];for(var W in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,W)&&(P.indexOf(W)!==-1?Object.defineProperty(this._configuration,W,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,W,{writable:!1,configurable:!1}));for(var K in f.debug("configuration parameters after validation:"),this._configuration)if(Object.prototype.hasOwnProperty.call(d.settings,K))switch(K){case"uri":case"registrar_server":f.debug("- ".concat(K,": ").concat(this._configuration[K]));break;case"password":case"ha1":case"authorization_jwt":f.debug("- ".concat(K,": NOT SHOWN"));break;default:f.debug("- ".concat(K,": ").concat(JSON.stringify(this._configuration[K])))}}}])&&N(D.prototype,O),F&&N(D,F),Object.defineProperty(D,"prototype",{writable:!1}),$}()},{"./Config":1,"./Constants":2,"./Exceptions":6,"./Logger":9,"./Message":10,"./Notifier":12,"./Options":13,"./Parser":14,"./RTCSession":15,"./Registrator":20,"./SIPMessage":22,"./Subscriber":24,"./Transactions":26,"./Transport":27,"./URI":29,"./Utils":30,"./sanityCheck":32,events:33}],29:[function(A,V,j){function L(I,R){var s=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!s){if(Array.isArray(I)||(s=function(c,p){if(c){if(typeof c=="string")return N(c,p);var m=Object.prototype.toString.call(c).slice(8,-1);if(m==="Object"&&c.constructor&&(m=c.constructor.name),m==="Map"||m==="Set")return Array.from(c);if(m==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return N(c,p)}}(I))||R){s&&(I=s);var _=0,a=function(){};return{s:a,n:function(){return _>=I.length?{done:!0}:{done:!1,value:I[_++]}},e:function(c){throw c},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v,y=!0,C=!1;return{s:function(){s=s.call(I)},n:function(){var c=s.next();return y=c.done,c},e:function(c){C=!0,v=c},f:function(){try{y||s.return==null||s.return()}finally{if(C)throw v}}}}function N(I,R){(R==null||R>I.length)&&(R=I.length);for(var s=0,_=new Array(R);s<R;s++)_[s]=I[s];return _}function i(I,R){for(var s=0;s<R.length;s++){var _=R[s];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(I,_.key,_)}}var M=A("./Constants"),q=A("./Utils"),t=A("./Grammar");V.exports=function(){function I(a,v,y,C){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(function(b,T){if(!(b instanceof T))throw new TypeError("Cannot call a class as a function")}(this,I),!y)throw new TypeError('missing or invalid "host" parameter');for(var m in this._parameters={},this._headers={},this._scheme=a||M.SIP,this._user=v,this._host=y,this._port=C,c)Object.prototype.hasOwnProperty.call(c,m)&&this.setParam(m,c[m]);for(var S in p)Object.prototype.hasOwnProperty.call(p,S)&&this.setHeader(S,p[S])}var R,s,_;return R=I,_=[{key:"parse",value:function(a){return(a=t.parse(a,"SIP_URI"))!==-1?a:void 0}}],(s=[{key:"scheme",get:function(){return this._scheme},set:function(a){this._scheme=a.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(a){this._user=a}},{key:"host",get:function(){return this._host},set:function(a){this._host=a.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(a){this._port=a===0?a:parseInt(a,10)||null}},{key:"setParam",value:function(a,v){a&&(this._parameters[a.toLowerCase()]=v==null?null:v.toString())}},{key:"getParam",value:function(a){if(a)return this._parameters[a.toLowerCase()]}},{key:"hasParam",value:function(a){if(a)return!!this._parameters.hasOwnProperty(a.toLowerCase())}},{key:"deleteParam",value:function(a){if(a=a.toLowerCase(),this._parameters.hasOwnProperty(a)){var v=this._parameters[a];return delete this._parameters[a],v}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(a,v){this._headers[q.headerize(a)]=Array.isArray(v)?v:[v]}},{key:"getHeader",value:function(a){if(a)return this._headers[q.headerize(a)]}},{key:"hasHeader",value:function(a){if(a)return!!this._headers.hasOwnProperty(q.headerize(a))}},{key:"deleteHeader",value:function(a){if(a=q.headerize(a),this._headers.hasOwnProperty(a)){var v=this._headers[a];return delete this._headers[a],v}}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new I(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var a=[],v="".concat(this._scheme,":");for(var y in this._user&&(v+="".concat(q.escapeUser(this._user),"@")),v+=this._host,(this._port||this._port===0)&&(v+=":".concat(this._port)),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,y)&&(v+=";".concat(y),this._parameters[y]!==null&&(v+="=".concat(this._parameters[y])));for(var C in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,C)){var c,p=L(this._headers[C]);try{for(p.s();!(c=p.n()).done;){var m=c.value;a.push("".concat(C,"=").concat(m))}}catch(S){p.e(S)}finally{p.f()}}return a.length>0&&(v+="?".concat(a.join("&"))),v}},{key:"toAor",value:function(a){var v="".concat(this._scheme,":");return this._user&&(v+="".concat(q.escapeUser(this._user),"@")),v+=this._host,a&&(this._port||this._port===0)&&(v+=":".concat(this._port)),v}}])&&i(R.prototype,s),_&&i(R,_),Object.defineProperty(R,"prototype",{writable:!1}),I}()},{"./Constants":2,"./Grammar":7,"./Utils":30}],30:[function(A,V,j){function L(_){return(L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(_)}function N(_,a){var v=typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(!v){if(Array.isArray(_)||(v=function(S,b){if(S){if(typeof S=="string")return i(S,b);var T=Object.prototype.toString.call(S).slice(8,-1);if(T==="Object"&&S.constructor&&(T=S.constructor.name),T==="Map"||T==="Set")return Array.from(S);if(T==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T))return i(S,b)}}(_))||a){v&&(_=v);var y=0,C=function(){};return{s:C,n:function(){return y>=_.length?{done:!0}:{done:!1,value:_[y++]}},e:function(S){throw S},f:C}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c,p=!0,m=!1;return{s:function(){v=v.call(_)},n:function(){var S=v.next();return p=S.done,S},e:function(S){m=!0,c=S},f:function(){try{p||v.return==null||v.return()}finally{if(m)throw c}}}}function i(_,a){(a==null||a>_.length)&&(a=_.length);for(var v=0,y=new Array(a);v<a;v++)y[v]=_[v];return y}var M=A("./Constants"),q=A("./URI"),t=A("./Grammar");j.str_utf8_length=function(_){return unescape(encodeURIComponent(_)).length};var I=j.isFunction=function(_){return _!==void 0&&Object.prototype.toString.call(_)==="[object Function]"};j.isString=function(_){return _!==void 0&&Object.prototype.toString.call(_)==="[object String]"},j.isDecimal=function(_){return!isNaN(_)&&parseFloat(_)===parseInt(_,10)},j.isEmpty=function(_){return _===null||_===""||_===void 0||Array.isArray(_)&&_.length===0||typeof _=="number"&&isNaN(_)},j.hasMethods=function(_){for(var a=arguments.length,v=new Array(a>1?a-1:0),y=1;y<a;y++)v[y-1]=arguments[y];for(var C=0,c=v;C<c.length;C++){var p=c[C];if(I(_[p]))return!1}return!0};var R=j.createRandomToken=function(_){var a,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32,y="";for(a=0;a<_;a++)y+=(Math.random()*v|0).toString(v);return y};j.newTag=function(){return R(10)},j.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(_){var a=16*Math.random()|0;return(_==="x"?a:3&a|8).toString(16)})},j.hostType=function(_){if(_)return(_=t.parse(_,"host"))!==-1?_.host_type:void 0};var s=j.escapeUser=function(_){return encodeURIComponent(decodeURIComponent(_)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")};j.normalizeTarget=function(_,a){if(_){if(_ instanceof q)return _;if(typeof _=="string"){var v,y,C,c=_.split("@");switch(c.length){case 1:if(!a)return;v=_,y=a;break;case 2:v=c[0],y=c[1];break;default:v=c.slice(0,c.length-1).join("@"),y=c[c.length-1]}return v=v.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(v)&&(v=v.replace(/[-.()]/g,"")),_="".concat(M.SIP,":").concat(s(v),"@").concat(y),(C=q.parse(_))?C:void 0}}},j.headerize=function(_){var a,v={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},y=_.toLowerCase().replace(/_/g,"-").split("-"),C="",c=y.length;for(a=0;a<c;a++)a!==0&&(C+="-"),C+=y[a].charAt(0).toUpperCase()+y[a].substring(1);return v[C]&&(C=v[C]),C},j.sipErrorCause=function(_){for(var a in M.SIP_ERROR_CAUSES)if(M.SIP_ERROR_CAUSES[a].indexOf(_)!==-1)return M.causes[a];return M.causes.SIP_FAILURE_CODE},j.getRandomTestNetIP=function(){return"192.0.2.".concat((_=1,a=254,Math.floor(Math.random()*(a-_+1)+_)));var _,a},j.calculateMD5=function(_){function a(D,O){return D<<O|D>>>32-O}function v(D,O){var F=2147483648&D,B=2147483648&O,$=1073741824&D,l=1073741824&O,h=(1073741823&D)+(1073741823&O);return $&l?2147483648^h^F^B:$|l?1073741824&h?3221225472^h^F^B:1073741824^h^F^B:h^F^B}function y(D,O,F,B,$,l,h){return D=v(D,v(v(function(k,P,W){return k&P|~k&W}(O,F,B),$),h)),v(a(D,l),O)}function C(D,O,F,B,$,l,h){return D=v(D,v(v(function(k,P,W){return k&W|P&~W}(O,F,B),$),h)),v(a(D,l),O)}function c(D,O,F,B,$,l,h){return D=v(D,v(v(function(k,P,W){return k^P^W}(O,F,B),$),h)),v(a(D,l),O)}function p(D,O,F,B,$,l,h){return D=v(D,v(v(function(k,P,W){return P^(k|~W)}(O,F,B),$),h)),v(a(D,l),O)}function m(D){var O,F="",B="";for(O=0;O<=3;O++)F+=(B="0".concat((D>>>8*O&255).toString(16))).substr(B.length-2,2);return F}var S,b,T,x,Q,G,d,f,E,w;for(S=function(D){for(var O,F=D.length,B=F+8,$=16*((B-B%64)/64+1),l=new Array($-1),h=0,k=0;k<F;)h=k%4*8,l[O=(k-k%4)/4]=l[O]|D.charCodeAt(k)<<h,k++;return h=k%4*8,l[O=(k-k%4)/4]=l[O]|128<<h,l[$-2]=F<<3,l[$-1]=F>>>29,l}(_=function(D){for(var O="",F=0;F<D.length;F++){var B=D.charCodeAt(F);B<128?O+=String.fromCharCode(B):B>127&&B<2048?(O+=String.fromCharCode(B>>6|192),O+=String.fromCharCode(63&B|128)):(O+=String.fromCharCode(B>>12|224),O+=String.fromCharCode(B>>6&63|128),O+=String.fromCharCode(63&B|128))}return O}(_)),d=1732584193,f=4023233417,E=2562383102,w=271733878,b=0;b<S.length;b+=16)T=d,x=f,Q=E,G=w,d=y(d,f,E,w,S[b+0],7,3614090360),w=y(w,d,f,E,S[b+1],12,3905402710),E=y(E,w,d,f,S[b+2],17,606105819),f=y(f,E,w,d,S[b+3],22,3250441966),d=y(d,f,E,w,S[b+4],7,4118548399),w=y(w,d,f,E,S[b+5],12,1200080426),E=y(E,w,d,f,S[b+6],17,2821735955),f=y(f,E,w,d,S[b+7],22,4249261313),d=y(d,f,E,w,S[b+8],7,1770035416),w=y(w,d,f,E,S[b+9],12,2336552879),E=y(E,w,d,f,S[b+10],17,4294925233),f=y(f,E,w,d,S[b+11],22,2304563134),d=y(d,f,E,w,S[b+12],7,1804603682),w=y(w,d,f,E,S[b+13],12,4254626195),E=y(E,w,d,f,S[b+14],17,2792965006),d=C(d,f=y(f,E,w,d,S[b+15],22,1236535329),E,w,S[b+1],5,4129170786),w=C(w,d,f,E,S[b+6],9,3225465664),E=C(E,w,d,f,S[b+11],14,643717713),f=C(f,E,w,d,S[b+0],20,3921069994),d=C(d,f,E,w,S[b+5],5,3593408605),w=C(w,d,f,E,S[b+10],9,38016083),E=C(E,w,d,f,S[b+15],14,3634488961),f=C(f,E,w,d,S[b+4],20,3889429448),d=C(d,f,E,w,S[b+9],5,568446438),w=C(w,d,f,E,S[b+14],9,3275163606),E=C(E,w,d,f,S[b+3],14,4107603335),f=C(f,E,w,d,S[b+8],20,1163531501),d=C(d,f,E,w,S[b+13],5,2850285829),w=C(w,d,f,E,S[b+2],9,4243563512),E=C(E,w,d,f,S[b+7],14,1735328473),d=c(d,f=C(f,E,w,d,S[b+12],20,2368359562),E,w,S[b+5],4,4294588738),w=c(w,d,f,E,S[b+8],11,2272392833),E=c(E,w,d,f,S[b+11],16,1839030562),f=c(f,E,w,d,S[b+14],23,4259657740),d=c(d,f,E,w,S[b+1],4,2763975236),w=c(w,d,f,E,S[b+4],11,1272893353),E=c(E,w,d,f,S[b+7],16,4139469664),f=c(f,E,w,d,S[b+10],23,3200236656),d=c(d,f,E,w,S[b+13],4,681279174),w=c(w,d,f,E,S[b+0],11,3936430074),E=c(E,w,d,f,S[b+3],16,3572445317),f=c(f,E,w,d,S[b+6],23,76029189),d=c(d,f,E,w,S[b+9],4,3654602809),w=c(w,d,f,E,S[b+12],11,3873151461),E=c(E,w,d,f,S[b+15],16,530742520),d=p(d,f=c(f,E,w,d,S[b+2],23,3299628645),E,w,S[b+0],6,4096336452),w=p(w,d,f,E,S[b+7],10,1126891415),E=p(E,w,d,f,S[b+14],15,2878612391),f=p(f,E,w,d,S[b+5],21,4237533241),d=p(d,f,E,w,S[b+12],6,1700485571),w=p(w,d,f,E,S[b+3],10,2399980690),E=p(E,w,d,f,S[b+10],15,4293915773),f=p(f,E,w,d,S[b+1],21,2240044497),d=p(d,f,E,w,S[b+8],6,1873313359),w=p(w,d,f,E,S[b+15],10,4264355552),E=p(E,w,d,f,S[b+6],15,2734768916),f=p(f,E,w,d,S[b+13],21,1309151649),d=p(d,f,E,w,S[b+4],6,4149444226),w=p(w,d,f,E,S[b+11],10,3174756917),E=p(E,w,d,f,S[b+2],15,718787259),f=p(f,E,w,d,S[b+9],21,3951481745),d=v(d,T),f=v(f,x),E=v(E,Q),w=v(w,G);return(m(d)+m(f)+m(E)+m(w)).toLowerCase()},j.closeMediaStream=function(_){if(_)try{if(_.getTracks){var a,v=N(_.getTracks());try{for(v.s();!(a=v.n()).done;)a.value.stop()}catch(m){v.e(m)}finally{v.f()}}else{var y,C=N(_.getAudioTracks());try{for(C.s();!(y=C.n()).done;)y.value.stop()}catch(m){C.e(m)}finally{C.f()}var c,p=N(_.getVideoTracks());try{for(p.s();!(c=p.n()).done;)c.value.stop()}catch(m){p.e(m)}finally{p.f()}}}catch{typeof _.stop!="function"&&L(_.stop)!=="object"||_.stop()}},j.cloneArray=function(_){return _&&_.slice()||[]},j.cloneObject=function(_){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return _&&Object.assign({},_)||a}},{"./Constants":2,"./Grammar":7,"./URI":29}],31:[function(A,V,j){function L(q,t){for(var I=0;I<t.length;I++){var R=t[I];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(q,R.key,R)}}var N=A("./Logger"),i=A("./Grammar"),M=new N("WebSocketInterface");V.exports=function(){function q(R){(function(_,a){if(!(_ instanceof a))throw new TypeError("Cannot call a class as a function")})(this,q),M.debug('new() [url:"%s"]',R),this._url=R,this._sip_uri=null,this._via_transport=null,this._ws=null;var s=i.parse(R,"absoluteURI");if(s===-1)throw M.warn("invalid WebSocket URI: ".concat(R)),new TypeError("Invalid argument: ".concat(R));if(s.scheme!=="wss"&&s.scheme!=="ws")throw M.warn("invalid WebSocket URI scheme: ".concat(s.scheme)),new TypeError("Invalid argument: ".concat(R));this._sip_uri="sip:".concat(s.host).concat(s.port?":".concat(s.port):"",";transport=ws"),this._via_transport=s.scheme.toUpperCase()}var t,I;return t=q,(I=[{key:"via_transport",get:function(){return this._via_transport},set:function(R){this._via_transport=R.toUpperCase()}},{key:"sip_uri",get:function(){return this._sip_uri}},{key:"url",get:function(){return this._url}},{key:"connect",value:function(){if(M.debug("connect()"),this.isConnected())M.debug("WebSocket ".concat(this._url," is already connected"));else if(this.isConnecting())M.debug("WebSocket ".concat(this._url," is connecting"));else{this._ws&&this.disconnect(),M.debug("connecting to WebSocket ".concat(this._url));try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(R){this._onError(R)}}}},{key:"disconnect",value:function(){M.debug("disconnect()"),this._ws&&(this._ws.onopen=function(){},this._ws.onclose=function(){},this._ws.onmessage=function(){},this._ws.onerror=function(){},this._ws.close(),this._ws=null)}},{key:"send",value:function(R){return M.debug("send()"),this.isConnected()?(this._ws.send(R),!0):(M.warn("unable to send message, WebSocket is not open"),!1)}},{key:"isConnected",value:function(){return this._ws&&this._ws.readyState===this._ws.OPEN}},{key:"isConnecting",value:function(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}},{key:"_onOpen",value:function(){M.debug("WebSocket ".concat(this._url," connected")),this.onconnect()}},{key:"_onClose",value:function(R){var s=R.wasClean,_=R.code,a=R.reason;M.debug("WebSocket ".concat(this._url," closed")),s===!1&&M.debug("WebSocket abrupt disconnection"),this.ondisconnect(!s,_,a)}},{key:"_onMessage",value:function(R){var s=R.data;M.debug("received WebSocket message"),this.ondata(s)}},{key:"_onError",value:function(R){M.warn("WebSocket ".concat(this._url," error: "),R)}}])&&L(t.prototype,I),Object.defineProperty(t,"prototype",{writable:!1}),q}()},{"./Grammar":7,"./Logger":9}],32:[function(A,V,j){function L(c,p){var m=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(!m){if(Array.isArray(c)||(m=function(G,d){if(G){if(typeof G=="string")return N(G,d);var f=Object.prototype.toString.call(G).slice(8,-1);if(f==="Object"&&G.constructor&&(f=G.constructor.name),f==="Map"||f==="Set")return Array.from(G);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return N(G,d)}}(c))||p){m&&(c=m);var S=0,b=function(){};return{s:b,n:function(){return S>=c.length?{done:!0}:{done:!1,value:c[S++]}},e:function(G){throw G},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var T,x=!0,Q=!1;return{s:function(){m=m.call(c)},n:function(){var G=m.next();return x=G.done,G},e:function(G){Q=!0,T=G},f:function(){try{x||m.return==null||m.return()}finally{if(Q)throw T}}}}function N(c,p){(p==null||p>c.length)&&(p=c.length);for(var m=0,S=new Array(p);m<p;m++)S[m]=c[m];return S}var i,M,q,t=A("./Logger"),I=A("./Constants"),R=A("./SIPMessage"),s=A("./Utils"),_=new t("sanityCheck"),a=[function(){for(var c=0,p=["from","to","call_id","cseq","via"];c<p.length;c++){var m=p[c];if(!i.hasHeader(m))return _.debug("missing mandatory header field : ".concat(m,", dropping the response")),!1}}],v=[function(){if(i.s("to").uri.scheme!=="sip")return C(416),!1},function(){if(!i.to_tag&&i.call_id.substr(0,5)===M.configuration.jssip_id)return C(482),!1},function(){var c=s.str_utf8_length(i.body),p=i.getHeader("content-length");if(c<p)return C(400),!1},function(){var c,p=i.from_tag,m=i.call_id,S=i.cseq;if(!i.to_tag)if(i.method===I.INVITE){if(M._transactions.ist[i.via_branch])return!1;for(var b in M._transactions.ist)if(Object.prototype.hasOwnProperty.call(M._transactions.ist,b)&&(c=M._transactions.ist[b]).request.from_tag===p&&c.request.call_id===m&&c.request.cseq===S)return C(482),!1}else{if(M._transactions.nist[i.via_branch])return!1;for(var T in M._transactions.nist)if(Object.prototype.hasOwnProperty.call(M._transactions.nist,T)&&(c=M._transactions.nist[T]).request.from_tag===p&&c.request.call_id===m&&c.request.cseq===S)return C(482),!1}}],y=[function(){if(i.getHeaders("via").length>1)return _.debug("more than one Via header field present in the response, dropping the response"),!1},function(){var c=s.str_utf8_length(i.body),p=i.getHeader("content-length");if(c<p)return _.debug("message body length is lower than the value in Content-Length header field, dropping the response"),!1}];function C(c){var p,m,S=i.getHeaders("via"),b="SIP/2.0 ".concat(c," ").concat(I.REASON_PHRASE[c],`\r
`),T=L(S);try{for(T.s();!(m=T.n()).done;){var x=m.value;b+="Via: ".concat(x,`\r
`)}}catch(Q){T.e(Q)}finally{T.f()}p=i.getHeader("To"),i.to_tag||(p+=";tag=".concat(s.newTag())),b+="To: ".concat(p,`\r
`),b+="From: ".concat(i.getHeader("From"),`\r
`),b+="Call-ID: ".concat(i.call_id,`\r
`),b+="CSeq: ".concat(i.cseq," ").concat(i.method,`\r
`),b+=`\r
`,q.send(b)}V.exports=function(c,p,m){i=c,M=p,q=m;var S,b=L(a);try{for(b.s();!(S=b.n()).done;)if((0,S.value)()===!1)return!1}catch(d){b.e(d)}finally{b.f()}if(i instanceof R.IncomingRequest){var T,x=L(v);try{for(x.s();!(T=x.n()).done;)if((0,T.value)()===!1)return!1}catch(d){x.e(d)}finally{x.f()}}else if(i instanceof R.IncomingResponse){var Q,G=L(y);try{for(G.s();!(Q=G.n()).done;)if((0,Q.value)()===!1)return!1}catch(d){G.e(d)}finally{G.f()}}return!0}},{"./Constants":2,"./Logger":9,"./SIPMessage":22,"./Utils":30}],33:[function(A,V,j){var L=Object.create||function(c){var p=function(){};return p.prototype=c,new p},N=Object.keys||function(c){var p=[];for(var m in c)Object.prototype.hasOwnProperty.call(c,m)&&p.push(m);return m},i=Function.prototype.bind||function(c){var p=this;return function(){return p.apply(c,arguments)}};function M(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=L(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}V.exports=M,M.EventEmitter=M,M.prototype._events=void 0,M.prototype._maxListeners=void 0;var q,t=10;try{var I={};Object.defineProperty&&Object.defineProperty(I,"x",{value:0}),q=I.x===0}catch{q=!1}function R(c){return c._maxListeners===void 0?M.defaultMaxListeners:c._maxListeners}function s(c,p,m,S){var b,T,x;if(typeof m!="function")throw new TypeError('"listener" argument must be a function');if((T=c._events)?(T.newListener&&(c.emit("newListener",p,m.listener?m.listener:m),T=c._events),x=T[p]):(T=c._events=L(null),c._eventsCount=0),x){if(typeof x=="function"?x=T[p]=S?[m,x]:[x,m]:S?x.unshift(m):x.push(m),!x.warned&&(b=R(c))&&b>0&&x.length>b){x.warned=!0;var Q=new Error("Possible EventEmitter memory leak detected. "+x.length+' "'+String(p)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');Q.name="MaxListenersExceededWarning",Q.emitter=c,Q.type=p,Q.count=x.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",Q.name,Q.message)}}else x=T[p]=m,++c._eventsCount;return c}function _(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var c=new Array(arguments.length),p=0;p<c.length;++p)c[p]=arguments[p];this.listener.apply(this.target,c)}}function a(c,p,m){var S={fired:!1,wrapFn:void 0,target:c,type:p,listener:m},b=i.call(_,S);return b.listener=m,S.wrapFn=b,b}function v(c,p,m){var S=c._events;if(!S)return[];var b=S[p];return b?typeof b=="function"?m?[b.listener||b]:[b]:m?function(T){for(var x=new Array(T.length),Q=0;Q<x.length;++Q)x[Q]=T[Q].listener||T[Q];return x}(b):C(b,b.length):[]}function y(c){var p=this._events;if(p){var m=p[c];if(typeof m=="function")return 1;if(m)return m.length}return 0}function C(c,p){for(var m=new Array(p),S=0;S<p;++S)m[S]=c[S];return m}q?Object.defineProperty(M,"defaultMaxListeners",{enumerable:!0,get:function(){return t},set:function(c){if(typeof c!="number"||c<0||c!=c)throw new TypeError('"defaultMaxListeners" must be a positive number');t=c}}):M.defaultMaxListeners=t,M.prototype.setMaxListeners=function(c){if(typeof c!="number"||c<0||isNaN(c))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=c,this},M.prototype.getMaxListeners=function(){return R(this)},M.prototype.emit=function(c){var p,m,S,b,T,x,Q=c==="error";if(x=this._events)Q=Q&&x.error==null;else if(!Q)return!1;if(Q){if(arguments.length>1&&(p=arguments[1]),p instanceof Error)throw p;var G=new Error('Unhandled "error" event. ('+p+")");throw G.context=p,G}if(!(m=x[c]))return!1;var d=typeof m=="function";switch(S=arguments.length){case 1:(function(f,E,w){if(E)f.call(w);else for(var D=f.length,O=C(f,D),F=0;F<D;++F)O[F].call(w)})(m,d,this);break;case 2:(function(f,E,w,D){if(E)f.call(w,D);else for(var O=f.length,F=C(f,O),B=0;B<O;++B)F[B].call(w,D)})(m,d,this,arguments[1]);break;case 3:(function(f,E,w,D,O){if(E)f.call(w,D,O);else for(var F=f.length,B=C(f,F),$=0;$<F;++$)B[$].call(w,D,O)})(m,d,this,arguments[1],arguments[2]);break;case 4:(function(f,E,w,D,O,F){if(E)f.call(w,D,O,F);else for(var B=f.length,$=C(f,B),l=0;l<B;++l)$[l].call(w,D,O,F)})(m,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(b=new Array(S-1),T=1;T<S;T++)b[T-1]=arguments[T];(function(f,E,w,D){if(E)f.apply(w,D);else for(var O=f.length,F=C(f,O),B=0;B<O;++B)F[B].apply(w,D)})(m,d,this,b)}return!0},M.prototype.addListener=function(c,p){return s(this,c,p,!1)},M.prototype.on=M.prototype.addListener,M.prototype.prependListener=function(c,p){return s(this,c,p,!0)},M.prototype.once=function(c,p){if(typeof p!="function")throw new TypeError('"listener" argument must be a function');return this.on(c,a(this,c,p)),this},M.prototype.prependOnceListener=function(c,p){if(typeof p!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(c,a(this,c,p)),this},M.prototype.removeListener=function(c,p){var m,S,b,T,x;if(typeof p!="function")throw new TypeError('"listener" argument must be a function');if(!(S=this._events))return this;if(!(m=S[c]))return this;if(m===p||m.listener===p)--this._eventsCount==0?this._events=L(null):(delete S[c],S.removeListener&&this.emit("removeListener",c,m.listener||p));else if(typeof m!="function"){for(b=-1,T=m.length-1;T>=0;T--)if(m[T]===p||m[T].listener===p){x=m[T].listener,b=T;break}if(b<0)return this;b===0?m.shift():function(Q,G){for(var d=G,f=d+1,E=Q.length;f<E;d+=1,f+=1)Q[d]=Q[f];Q.pop()}(m,b),m.length===1&&(S[c]=m[0]),S.removeListener&&this.emit("removeListener",c,x||p)}return this},M.prototype.removeAllListeners=function(c){var p,m,S;if(!(m=this._events))return this;if(!m.removeListener)return arguments.length===0?(this._events=L(null),this._eventsCount=0):m[c]&&(--this._eventsCount==0?this._events=L(null):delete m[c]),this;if(arguments.length===0){var b,T=N(m);for(S=0;S<T.length;++S)(b=T[S])!=="removeListener"&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=L(null),this._eventsCount=0,this}if(typeof(p=m[c])=="function")this.removeListener(c,p);else if(p)for(S=p.length-1;S>=0;S--)this.removeListener(c,p[S]);return this},M.prototype.listeners=function(c){return v(this,c,!0)},M.prototype.rawListeners=function(c){return v(this,c,!1)},M.listenerCount=function(c,p){return typeof c.listenerCount=="function"?c.listenerCount(p):y.call(c,p)},M.prototype.listenerCount=y,M.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],34:[function(A,V,j){(function(L){(function(){j.formatArgs=function(i){if(i[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+i[0]+(this.useColors?"%c ":" ")+"+"+V.exports.humanize(this.diff),!this.useColors)return;const M="color: "+this.color;i.splice(1,0,M,"color: inherit");let q=0,t=0;i[0].replace(/%[a-zA-Z%]/g,I=>{I!=="%%"&&(q++,I==="%c"&&(t=q))}),i.splice(t,0,M)},j.save=function(i){try{i?j.storage.setItem("debug",i):j.storage.removeItem("debug")}catch{}},j.load=function(){let i;try{i=j.storage.getItem("debug")}catch{}return!i&&L!==void 0&&"env"in L&&(i=L.env.DEBUG),i},j.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},j.storage=function(){try{return localStorage}catch{}}(),j.destroy=(()=>{let i=!1;return()=>{i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),j.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],j.log=console.debug||console.log||(()=>{}),V.exports=A("./common")(j);const{formatters:N}=V.exports;N.j=function(i){try{return JSON.stringify(i)}catch(M){return"[UnexpectedJSONParseError]: "+M.message}}}).call(this)}).call(this,A("_process"))},{"./common":35,_process:37}],35:[function(A,V,j){V.exports=function(L){function N(q){let t,I,R,s=null;function _(...a){if(!_.enabled)return;const v=_,y=Number(new Date),C=y-(t||y);v.diff=C,v.prev=t,v.curr=y,t=y,a[0]=N.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");let c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(p,m)=>{if(p==="%%")return"%";c++;const S=N.formatters[m];if(typeof S=="function"){const b=a[c];p=S.call(v,b),a.splice(c,1),c--}return p}),N.formatArgs.call(v,a),(v.log||N.log).apply(v,a)}return _.namespace=q,_.useColors=N.useColors(),_.color=N.selectColor(q),_.extend=i,_.destroy=N.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>s!==null?s:(I!==N.namespaces&&(I=N.namespaces,R=N.enabled(q)),R),set:a=>{s=a}}),typeof N.init=="function"&&N.init(_),_}function i(q,t){const I=N(this.namespace+(t===void 0?":":t)+q);return I.log=this.log,I}function M(q){return q.toString().substring(2,q.toString().length-2).replace(/\.\*\?$/,"*")}return N.debug=N,N.default=N,N.coerce=function(q){return q instanceof Error?q.stack||q.message:q},N.disable=function(){const q=[...N.names.map(M),...N.skips.map(M).map(t=>"-"+t)].join(",");return N.enable(""),q},N.enable=function(q){let t;N.save(q),N.namespaces=q,N.names=[],N.skips=[];const I=(typeof q=="string"?q:"").split(/[\s,]+/),R=I.length;for(t=0;t<R;t++)I[t]&&((q=I[t].replace(/\*/g,".*?"))[0]==="-"?N.skips.push(new RegExp("^"+q.slice(1)+"$")):N.names.push(new RegExp("^"+q+"$")))},N.enabled=function(q){if(q[q.length-1]==="*")return!0;let t,I;for(t=0,I=N.skips.length;t<I;t++)if(N.skips[t].test(q))return!1;for(t=0,I=N.names.length;t<I;t++)if(N.names[t].test(q))return!0;return!1},N.humanize=A("ms"),N.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(L).forEach(q=>{N[q]=L[q]}),N.names=[],N.skips=[],N.formatters={},N.selectColor=function(q){let t=0;for(let I=0;I<q.length;I++)t=(t<<5)-t+q.charCodeAt(I),t|=0;return N.colors[Math.abs(t)%N.colors.length]},N.enable(N.load()),N}},{ms:36}],36:[function(A,V,j){var L=1e3,N=60*L,i=60*N,M=24*i,q=7*M,t=365.25*M;function I(R,s,_,a){var v=s>=1.5*_;return Math.round(R/_)+" "+a+(v?"s":"")}V.exports=function(R,s){s=s||{};var _=typeof R;if(_==="string"&&R.length>0)return function(a){if(!((a=String(a)).length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(v){var y=parseFloat(v[1]);switch((v[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return y*t;case"weeks":case"week":case"w":return y*q;case"days":case"day":case"d":return y*M;case"hours":case"hour":case"hrs":case"hr":case"h":return y*i;case"minutes":case"minute":case"mins":case"min":case"m":return y*N;case"seconds":case"second":case"secs":case"sec":case"s":return y*L;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}(R);if(_==="number"&&isFinite(R))return s.long?function(a){var v=Math.abs(a);return v>=M?I(a,v,M,"day"):v>=i?I(a,v,i,"hour"):v>=N?I(a,v,N,"minute"):v>=L?I(a,v,L,"second"):a+" ms"}(R):function(a){var v=Math.abs(a);return v>=M?Math.round(a/M)+"d":v>=i?Math.round(a/i)+"h":v>=N?Math.round(a/N)+"m":v>=L?Math.round(a/L)+"s":a+"ms"}(R);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(R))}},{}],37:[function(A,V,j){var L,N,i=V.exports={};function M(){throw new Error("setTimeout has not been defined")}function q(){throw new Error("clearTimeout has not been defined")}function t(c){if(L===setTimeout)return setTimeout(c,0);if((L===M||!L)&&setTimeout)return L=setTimeout,setTimeout(c,0);try{return L(c,0)}catch{try{return L.call(null,c,0)}catch{return L.call(this,c,0)}}}(function(){try{L=typeof setTimeout=="function"?setTimeout:M}catch{L=M}try{N=typeof clearTimeout=="function"?clearTimeout:q}catch{N=q}})();var I,R=[],s=!1,_=-1;function a(){s&&I&&(s=!1,I.length?R=I.concat(R):_=-1,R.length&&v())}function v(){if(!s){var c=t(a);s=!0;for(var p=R.length;p;){for(I=R,R=[];++_<p;)I&&I[_].run();_=-1,p=R.length}I=null,s=!1,function(m){if(N===clearTimeout)return clearTimeout(m);if((N===q||!N)&&clearTimeout)return N=clearTimeout,clearTimeout(m);try{N(m)}catch{try{return N.call(null,m)}catch{return N.call(this,m)}}}(c)}}function y(c,p){this.fun=c,this.array=p}function C(){}i.nextTick=function(c){var p=new Array(arguments.length-1);if(arguments.length>1)for(var m=1;m<arguments.length;m++)p[m-1]=arguments[m];R.push(new y(c,p)),R.length!==1||s||t(v)},y.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=C,i.addListener=C,i.once=C,i.off=C,i.removeListener=C,i.removeAllListeners=C,i.emit=C,i.prependListener=C,i.prependOnceListener=C,i.listeners=function(c){return[]},i.binding=function(c){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(c){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],38:[function(A,V,j){var L=V.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(N){return N.encoding?"rtpmap:%d %s/%s/%s":N.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(N){return N.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(N){return N.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(N){return"extmap:%d"+(N.direction?"/%s":"%v")+(N["encrypt-uri"]?" %s":"%v")+" %s"+(N.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(N){return N.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(N){var i="candidate:%s %d %s %d %s %d typ %s";return i+=N.raddr!=null?" raddr %s rport %d":"%v%v",i+=N.tcptype!=null?" tcptype %s":"%v",N.generation!=null&&(i+=" generation %d"),i+=N["network-id"]!=null?" network-id %d":"%v",i+=N["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(N){var i="ssrc:%d";return N.attribute!=null&&(i+=" %s",N.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(N){return N.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(N){return N.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(N){return"imageattr:%s %s %s"+(N.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(N){return"simulcast:%s %s"+(N.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(N){return"ts-refclk:%s"+(N.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(N){var i="mediaclk:";return i+=N.id!=null?"id=%s %s":"%v%s",i+=N.mediaClockValue!=null?"=%s":"",i+=N.rateNumerator!=null?" rate=%s":"",i+=N.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(L).forEach(function(N){L[N].forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})})},{}],39:[function(A,V,j){var L=A("./parser"),N=A("./writer");j.write=N,j.parse=L.parse,j.parseParams=L.parseParams,j.parseFmtpConfig=L.parseFmtpConfig,j.parsePayloads=L.parsePayloads,j.parseRemoteCandidates=L.parseRemoteCandidates,j.parseImageAttributes=L.parseImageAttributes,j.parseSimulcastStreamList=L.parseSimulcastStreamList},{"./parser":40,"./writer":41}],40:[function(A,V,j){var L=function(t){return String(Number(t))===t?Number(t):t},N=function(t,I,R){var s=t.name&&t.names;t.push&&!I[t.push]?I[t.push]=[]:s&&!I[t.name]&&(I[t.name]={});var _=t.push?{}:s?I[t.name]:I;(function(a,v,y,C){if(C&&!y)v[C]=L(a[1]);else for(var c=0;c<y.length;c+=1)a[c+1]!=null&&(v[y[c]]=L(a[c+1]))})(R.match(t.reg),_,t.names,t.name),t.push&&I[t.push].push(_)},i=A("./grammar"),M=RegExp.prototype.test.bind(/^([a-z])=(.*)/);j.parse=function(t){var I={},R=[],s=I;return t.split(/(\r\n|\r|\n)/).filter(M).forEach(function(_){var a=_[0],v=_.slice(2);a==="m"&&(R.push({rtp:[],fmtp:[]}),s=R[R.length-1]);for(var y=0;y<(i[a]||[]).length;y+=1){var C=i[a][y];if(C.reg.test(v))return N(C,s,v)}}),I.media=R,I};var q=function(t,I){var R=I.split(/=(.+)/,2);return R.length===2?t[R[0]]=L(R[1]):R.length===1&&I.length>1&&(t[R[0]]=void 0),t};j.parseParams=function(t){return t.split(/;\s?/).reduce(q,{})},j.parseFmtpConfig=j.parseParams,j.parsePayloads=function(t){return t.toString().split(" ").map(Number)},j.parseRemoteCandidates=function(t){for(var I=[],R=t.split(" ").map(L),s=0;s<R.length;s+=3)I.push({component:R[s],ip:R[s+1],port:R[s+2]});return I},j.parseImageAttributes=function(t){return t.split(" ").map(function(I){return I.substring(1,I.length-1).split(",").reduce(q,{})})},j.parseSimulcastStreamList=function(t){return t.split(";").map(function(I){return I.split(",").map(function(R){var s,_=!1;return R[0]!=="~"?s=L(R):(s=L(R.substring(1,R.length)),_=!0),{scid:s,paused:_}})})}},{"./grammar":38}],41:[function(A,V,j){var L=A("./grammar"),N=/%[sdv%]/g,i=function(t,I,R){var s=[t+"="+(I.format instanceof Function?I.format(I.push?R:R[I.name]):I.format)];if(I.names)for(var _=0;_<I.names.length;_+=1){var a=I.names[_];I.name?s.push(R[I.name][a]):s.push(R[I.names[_]])}else s.push(R[I.name]);return(function(v){var y=1,C=arguments,c=C.length;return v.replace(N,function(p){if(y>=c)return p;var m=C[y];switch(y+=1,p){case"%%":return"%";case"%s":return String(m);case"%d":return Number(m);case"%v":return""}})}).apply(null,s)},M=["v","o","s","i","u","e","p","c","b","t","r","z","a"],q=["i","c","b","a"];V.exports=function(t,I){I=I||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach(function(a){a.payloads==null&&(a.payloads="")});var R=I.outerOrder||M,s=I.innerOrder||q,_=[];return R.forEach(function(a){L[a].forEach(function(v){v.name in t&&t[v.name]!=null?_.push(i(a,v,t)):v.push in t&&t[v.push]!=null&&t[v.push].forEach(function(y){_.push(i(a,v,y))})})}),t.media.forEach(function(a){_.push(i("m",L.m[0],a)),s.forEach(function(v){L[v].forEach(function(y){y.name in a&&a[y.name]!=null?_.push(i(v,y,a)):y.push in a&&a[y.push]!=null&&a[y.push].forEach(function(C){_.push(i(v,y,C))})})})}),_.join(`\r
`)+`\r
`}},{"./grammar":38}],42:[function(A,V,j){V.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"3.10.0",homepage:"https://jssip.net",contributors:["José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)","Iñaki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)"],types:"lib/JsSIP.d.ts",main:"lib-es5/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{"@types/events":"^3.0.0","@types/debug":"^4.1.7",debug:"^4.3.1",events:"^3.3.0","sdp-transform":"^2.14.1"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","ansi-colors":"^3.2.4",browserify:"^16.5.1",eslint:"^5.16.0","fancy-log":"^1.3.3",gulp:"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4",pegjs:"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},scripts:{lint:"node npm-scripts.js lint",test:"node npm-scripts.js test",prepublish:"node npm-scripts.js prepublish",release:"node npm-scripts.js release"}}},{}]},{},[8])(8)});const ii="AudioCodes Click-to-Call",bi=5,Si=60;let le=new AudioCodesUA,J=console.log,_n=!0,Ye=!1,fe=new AudioPlayer2,ae=null,he=null,si=0,Dt=null,Ci=0,Pt=null,hi=!1,be=!0,an=!1,pn=!1,ht=null,Ze=2e3,mn=function(){},oi=function(){},_i=null,un=null,cn=null,_e=null,li,Re=!1,Pe=null,qe=null,dn=null,Le=null,$e=null,_t=null,Ie=null,ge=null,Ae=null,mt=null,ve=null,et=null,gn=null,Ve=null,Ge=null,we=null,We=null,Me=null;function Ei(){let A=Qe("logger");A||(A=c2c_serverConfig.logger),A?Oi(A).catch(V=>{ci(),J("Cannot connect to logger server",V)}).finally(()=>{ai()}):(ci(),ai())}async function ai(){if(J(`------ Date: ${new Date().toDateString()} -------`),J(ii),J(`SDK: ${le.version()}`),J(`SIP: ${JsSIP.C.USER_AGENT}`),J(`Browser: ${le.getBrowserName()}  Internal name: ${le.getBrowser()}|${le.getOS()}`),le.setUserAgent(`${ii} ${le.version()} ${le.getBrowserName()}`),c2c_config.selectDevicesEnabled){_e=new SelectDevices,_e.setDevices(!0,[{name:"microphone",kind:"audioinput"},{name:"camera",kind:"videoinput"},{name:"speaker",kind:"audiooutput"}]);let I=sessionStorage.getItem("c2c_selectedDevices");I!==null&&_e.load(JSON.parse(I)),await _e.enumerate(!1)}let A=Qe("call");A&&(c2c_config.call==="_take_value_from_url_"?c2c_config.call=ui(A," -"):J(`Error: URL parameter "call" is ignored. To enable set configuration "call: '_take_value_from_url_'"`));let V=Qe("domain");V&&(c2c_serverConfig.domain==="_take_value_from_url_"?c2c_serverConfig.domain=V:J(`Error: URL parameter "domain" is ignored. To enable set configuration "domain: '_take_value_from_url_'"`));let j=Qe("server");j&&(c2c_serverConfig.addresses==="_take_value_from_url_"?c2c_serverConfig.addresses=[`wss://${j}`]:J(`Error: URL parameter "server" is ignored. To enable set configuration "addresses: '_take_value_from_url_'"`));let L=Qe("token");L&&(c2c_config.urlToken?cn=L:J('Error: URL parameter "token" is ignored. To enable set configuration "urlToken: true"'));let N=Qe("dtmf");N&&(ht=ui(N," -")),Ze=wi("delay",Ze),(A||N)&&J(`URL parameters: call=${A} dtmf=${N} delay=${Ze}
After filtering: call=${c2c_config.call}  dtmf=${ht}`);let i=le.getBrowser(),M=le.getOS();if(c2c_config.testCallEnabled&&!c2c_config.testCallSBCScore&&(i==="safari"||M==="ios")&&(J("Disable test call for iMac/iOS Safari browser, because getStats() implementation missed remote-inbound-rtp report"),c2c_config.testCallEnabled=!1),!Ai())return;if(ge.onclick=function(){Xe("call button",mn)},Le&&(Le.onclick=function(){Xe("select devices button",Di)}),$e&&($e.onclick=function(){Xe("keypad show/hide button",ji)}),Ie&&(Ie.onclick=function(){Xe("test button",oi)}),ve&&(ve.onclick=function(){Xe("webcam on/off button",Mi)}),Me&&(Me.onclick=function(){Xe("show local video",Hi)}),c2c_config.testCallEnabled&&(oi=function(){Je(!1)},Pe&&navigator.connection))try{let I=navigator.connection;if(I.downlink){let R=I.downlink;Pe.innerHTML='Connection speed: <span style="font-weight:bold">'+R+"</span> Mbps"}else throw"nc.downlink is undefined"}catch(I){J("Cannot get connection information",I)}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){me("No WebRTC"),fi("WebRTC API is not supported in this browser !");return}try{Ye=await le.checkAvailableDevices(),J(`Camera is ${Ye?"present":"missing"}`)}catch{if(c2c_config.allowCallWithoutMicrophone)J('Microphone is missed. Used "allowCallWithoutMicrophone" mode'),_n=!1;else{me("No microphone or speaker !"),fi("No microphone or speaker !");return}}location.protocol!=="https:"&&location.protocol!=="file:"&&J('Warning: for the URL used "'+location.protocol+'" protocol');const q=I=>I.replace(/[a-z]/gi,R=>String.fromCharCode(R.charCodeAt()+13-26*/[n-z]/i.test(R)));for(let I of c2c_serverConfig.iceServers){if(typeof I=="string")continue;(Array.isArray(I.urls)?I.urls[0]:I.urls).startsWith("turn:")&&(hi=!0,I.username===void 0&&(I.username="some-username"),I.credential===void 0&&(I.credential=q("nhgu-gbxra")))}let t=sessionStorage.getItem("c2c_restoreCall");if(t!==null){sessionStorage.removeItem("c2c_restoreCall"),he=JSON.parse(t);let I=Math.ceil(Math.abs(he.time-new Date().getTime())/1e3);I>c2c_config.c2c_restoreCallMaxDelay&&(J("No restore call, delay is too long ("+I+" seconds)"),he=null)}if(window.addEventListener("beforeunload",Ni),fe.init({logger:J}),await fe.downloadSounds("../sounds/",c2c_soundConfig.downloadSounds),await fe.generateTonesSuite(c2c_soundConfig.generateTones),c2c_config.dtmfKeypadEnabled){let{A:I,B:R,C:s,D:_,...a}=fe.dtmfTones;await fe.generateTonesSuite(a)}if(J("audioPlayer2: sounds are ready"),_e){let I=_e.getSelected("speaker").deviceId;fe.setSpeakerId(I)}if(gt(),he===null){let I=c2c_config.callAutoStart?c2c_config.callAutoStart.toLowerCase():"no";I==="yes force"||I==="yes"&&!fe.isDisabled()?(fe.isDisabled()?J("Start call automatically. Warning: audio player is disabled. So you cannot hear beeps!"):J("Start call automatically"),Je(!0)):c2c_config.testCallEnabled&&c2c_config.testCallAutoStart&&(c2c_config.testCallUseMicrophone?(J("Test call used microphone. Start test call automatically"),Je(!1)):fe.isDisabled()?J("Test call used recorded sound. Play sound is disabled by Auto-Play policy. Please press button to start test call"):(J("Test call used recorded sound. Play sound is enabled by Auto-Play policy. Start test call automatically"),Je(!1)))}he!==null&&(J("Trying to restore call",he),Je(!0))}function Ai(){if(dn=document.getElementById("c2c_widget_div"),!dn)return J('Fatal error: HTML missed div id="c2c_widget"'),!1;if(ge=document.getElementById("c2c_call_btn"),!ge)return J('Fatal error: HTML missed button id="c2c_call_btn"'),!1;if(_i=ge.title,we=document.getElementById("c2c_remote_video"),!we)return J('Fatal error: HTML missed video element id="c2c_remote_video"'),!1;if(Ge=document.getElementById("c2c_local_video"),!Ge)return J('Fatal error: HTML missed video element id="c2c_local_video"'),!1;if(Ve=document.getElementById("c2c_status_line"),!Ve)return J('Fatal error: HTML missed div id="c2c_status_line"'),!1;if(_e&&(Le=document.getElementById("c2c_select_devices_btn"),gn=document.getElementById("c2c_select_devices_div")),c2c_config.dtmfKeypadEnabled&&($e=document.getElementById("c2c_keypad_btn"),_t=document.getElementById("c2c_keypad_div")),c2c_config.testCallEnabled){if(Pe=document.getElementById("c2c_connection_speed_div"),qe=document.getElementById("c2c_test_call_quality_div"),Ie=document.getElementById("c2c_test_btn"),!qe)return J('Fatal error: Mode testCallEnabled and HTML missed span id="c2c_quality_span"'),!1;if(!Ie)return J('Fatal error: Mode testCallEnabled and HTML missed button id="c2c_test_btn"'),!1}if(Ae=document.getElementById("c2c_video_chk_span"),mt=document.getElementById("c2c_video_chk"),ve=document.getElementById("c2c_camera_btn"),et=document.getElementById("c2c_camera_line_svg"),c2c_config.type==="user_control"){if(!Ae)return J('Fatal error: Call type is "user_control" and HTML missed span id="c2c_video_chk_span"'),!1;if(!mt)return J('Fatal error: Call type is "user_control" and HTML missed checkbox id="c2c_video_chk"'),!1;if(!ve)return J('Fatal error: Call type is "user_control" and HTML missed button id="c2c_camera_btn"'),!1;if(!et)return J('Fatal error: Call type is "user_control" and HTML missed svg id="c2c_camera_line_svg"'),!1}if(c2c_config.dtmfKeypadEnabled){let A=document.getElementById("c2c_keypad_table");for(let V of A.getElementsByTagName("tr"))for(let j of V.getElementsByTagName("td"))j.onclick=()=>Bi(j.innerText)}if(c2c_config.selfVideoEnabled){if(We=document.getElementById("c2c_self_video_chk_span"),Me=document.getElementById("c2c_self_video_chk"),!We)return J('Fatal error: missed span id="c2c_self_video_chk_span"'),!1;if(!Me)return J('Fatal error: missed span id="c2c_self_video_chk"'),!1;Re=c2c_config.selfVideoCheckboxDefault,Me.checked=Re}return!0}function Xe(A,V){if(J(`phone>> "${A}" onclick event`),!fe.isDisabled()){V();return}J("Let enable sound..."),fe.enable().then(()=>{J("Sound is enabled")}).catch(j=>{J("Cannot enable sound",j)}).finally(()=>{V()})}function Qe(A,V=null){let j=window.location.search.split("&"+A+"=")[1];return j||(j=window.location.search.split("?"+A+"=")[1]),j!==void 0?decodeURIComponent(j.split("&")[0]):V}function wi(A,V=null){let j=window.location.search.split("&"+A+"=")[1];return j||(j=window.location.search.split("?"+A+"=")[1]),j!==void 0?parseInt(decodeURIComponent(j.split("&")[0])):V}function ui(A,V){let j="";for(let L of A)V.includes(L)||(j+=L);return j}function Ri(A){return new Promise(V=>{setTimeout(()=>V(),A)})}function fn(){let A=new Date,V=A.getHours(),j=A.getMinutes(),L=A.getSeconds(),N=A.getMilliseconds();return(V<10?"0"+V:V)+":"+(j<10?"0"+j:j)+":"+(L<10?"0"+L:L)+"."+("00"+N).slice(-3)+" "}function Ii(A,V){V=V.toLowerCase();for(let j=0;j<A.length;j++){let L=A[j];if((L instanceof Array?L[0]:L).toLowerCase()===V)return j}return-1}function ci(){let A=["chrome","firefox","safari"].includes(le.getBrowser());const V=function(){let L=[].slice.call(arguments),N=[fn()+(A?"%c":"")+L[0]];A&&(N=N.concat(["color: BlueViolet;"])),console.log.apply(console,N.concat(L.slice(1)))};let j=function(){let L=[].slice.call(arguments),N=[fn()+L[0]];console.log.apply(console,N.concat(L.slice(1)))};J=V,le.setAcLogger(V),le.setJsSipLogger(j)}function Oi(A){return new Promise((V,j)=>{let L=new WebSocket("wss://"+A,"wslog");L.onopen=()=>{V(L)},L.onerror=N=>{j(N)}}).then(V=>{const j=function(){let L=[].slice.call(arguments),N=[fn()+L[0]].concat(L.slice(1)).join();V.readyState===WebSocket.OPEN?V.send(N+`
`):console.log(N)};J(`Sending log to "${A}"`),J=j,le.setAcLogger(j),le.setJsSipLogger(j)})}function ki(A){if(he!==null){let V=Ii(c2c_serverConfig.addresses,he.address);V!==-1?(J('Page reloading, raise priority of previously connected server: "'+he.address+'"'),c2c_serverConfig.addresses[V]=[he.address,1e3]):J("Cannot find previously connected server: "+he.address+" in configuration")}le.setServerConfig(c2c_serverConfig.addresses,c2c_serverConfig.domain,c2c_serverConfig.iceServers),le.setAccount(A.user,A.displayName,A.password),le.setWebSocketKeepAlive(c2c_config.pingInterval,c2c_config.pongTimeout,c2c_config.timerThrottlingBestEffort,c2c_config.pongReport,c2c_config.pongDist),le.setListeners({loginStateChanged:function(V,j){switch(j){case"connected":if(J("phone>>> loginStateChanged: connected"),an=!0,ae!==null){J("phone: active call exists (SBC might have switched over to secondary)");break}he!==null?(Me&&(Re=he.selfVideo,Me.checked=Re),J("send INVITE with Replaces to restore call"),xt(he.callTo,he.video==="sendrecv"||he.video==="sendonly"?le.VIDEO:le.AUDIO,["Replaces: "+he.replaces])):pn&&mi();break;case"disconnected":J("phone>>> loginStateChanged: disconnected"),an=!1,le.isInitialized()&&si++>=bi&&ae===null&&(J("phone: too many disconnections."),le.deinit(),me("Cannot connect to SBC server"),gt());break;case"login failed":J("phone>>> loginStateChanged: login failed");break;case"login":J("phone>>> loginStateChanged: login");break;case"logout":J("phone>>> loginStateChanged: logout");break}},outgoingCallProgress:function(V,j){J("phone>>> outgoing call progress"),be&&(me("Ringing",!0),fe.play(c2c_soundConfig.play.outgoingCallProgress))},callTerminated:function(V,j,L,N){if(J(`phone>>> call terminated callback, cause=${L}`),ae=null,L==="Redirected"){J(`Redirect call to ${N}`),xt(N,pi());return}if(fe.stop(),be)me(L,!0),V.isOutgoing()&&!V.wasAccepted()?fe.play(c2c_soundConfig.play.busy):fe.play(c2c_soundConfig.play.disconnect);else if(!V.wasAccepted())J("Warning: Test call is failed !"),me("Test line is failed");else if(c2c_config.testCallSBCScore)try{if(!j)throw"No BYE message";let i=di(j);if(i){let M=c2c_config.testCallQualityText[i.color];J(`BYE: "X-VoiceQuality" header: score="${i.score}", color="${i.color}" text="${M}"`),qe&&(qe.innerHTML='Test call quality: <span style="color:'+i.color+';font-weight:bold">'+M+"</span>"),me("Test passed",!0)}else throw J('BYE: missing "X-VoiceQuality" header'),'BYE: missing "X-VoiceQuality" header'}catch(i){J("Warning: cannot take SBC voice quality information",i),me("Test failed",!0)}Dt=setTimeout(()=>{J("The time interval between the end of the call and SBC disconnection is over"),le.deinit()},Si*1e3),gt(),Ut(!1),pt(!1),Ge.srcObject=null,we.srcObject=null,he=null},callConfirmed:async function(V,j,L){if(J("phone>>> callConfirmed"),fe.stop(),Ut(Re&&ae.hasSendVideo()),pt(ae.hasReceiveVideo()),qt(),be){if(me("Call is established",!0),he!==null&&he.hold.includes("remote")&&(J("Restore remote hold"),me("Hold"),ae.setRemoteHoldState()),ht!==null&&he===null){Ze>0&&(J(`Wait ${Ze}ms before DTMF sending...`),await Ri(Ze)),J(`Send DTMF sequence: ${ht}`);for(let N of ht)ae.sendDTMF(N)}_n||(me("Warning: No microphone"),J('Play "noMicrophoneSound"'),fe.play(c2c_soundConfig.play.noMicrophoneSound,Pt))}else await Fi()},callShowStreams:function(V,j,L){J("phone>>> callShowStreams"),fe.stop(),_e?Ui().catch(N=>{J(`Warning: remove video HTMLVideoElement.setSinkId(): "${N.message}" [Used default browser speaker]`,N)}).finally(()=>{we.srcObject=L,we.volume=be?1:c2c_config.testCallVolume}):(we.srcObject=L,we.volume=be?1:c2c_config.testCallVolume),Re&&ae.hasSendVideo()&&Mt(!0)},incomingCall:function(V,j){J("phone>>> incomingCall"),V.reject()},callHoldStateChanged:function(V,j,L){J("phone>>> callHoldStateChanged"),V.isRemoteHold()?Wi():qt()},callIncomingReinvite:function(V,j,L){j||(pt(V.hasReceiveVideo()),V.hasReceiveVideo()&&!V.hasSendVideo()&&Ye&&(V.hasEnabledSendVideo()?J("Other side disable receive video for video call"):me("You are invited to turn on your camera",!0)))},incomingNotify:function(V,j,L,N,i,M){if(J(`phone>>> incoming NOTIFY "${j}"`,V,L,N,i),V!==null)return!1;if(j==="vq"){let q=di(M);if(q){let t=c2c_config.testCallQualityText[q.color];J(`NOTIFY: "X-VoiceQuality" header: score="${q.score}", color="${q.color}" text="${t}"`)}else J('NOTIFY: missing "X-VoiceQuality" header');return!0}else return!1}}),si=0,le.setEnableAddVideo(c2c_config.type!=="audio"),le.setNetworkPriority(c2c_config.networkPriority),le.setModes(c2c_config.modes),le.init(!1)}function di(A){let V=A.getHeader("X-VoiceQuality");if(!V)return;let j=V.trim().split(" ");if(j.length!==2){console.log("X-VoiceQuality header: parsing problem: must be 2 tokens");return}let L=parseInt(j[0]);if(isNaN(L)){console.log("X-VoiceQuality header: parsing problem: the first token is not number");return}let N=j[1].trim().toLowerCase();return{score:L,color:N}}function Ni(){if(J("phone>>> beforeunload event"),!(le===null||!le.isInitialized())&&ae!==null&&be)if(ae.isEstablished()){let A={callTo:ae.data._user,video:ae.getVideoState(),replaces:ae.getReplacesHeader(),time:new Date().getTime(),hold:`${ae.isLocalHold()?"local":""}${ae.isRemoteHold()?"remote":""}`,address:le.getServerAddress(),selfVideo:Re};sessionStorage.setItem("c2c_restoreCall",JSON.stringify(A))}else ae.terminate()}function pi(){if(!Ye)return le.AUDIO;switch(c2c_config.type){case"audio":return le.AUDIO;case"video":return le.VIDEO;case"user_control":return mt.checked?le.VIDEO:le.AUDIO;default:return J("Warning: c2c_videoOption(): Illegal value of c2c_config.type Used: 'audio'"),le.AUDIO}}function Di(){J("c2c_selectDevices()"),me(""),document.getElementById("select_devices_done_btn").onclick=xi,_e.enumerate(!0).catch(A=>{J("getUserMedia() exception",A)}).finally(()=>{for(let A of _e.names)Pi(A);Vi()})}function Pi(A){let V=_e.getDevice(A),j=document.querySelector(`#c2c_devices [name=${A}]`);for(;j.firstChild;)j.removeChild(j.firstChild);V.incomplete?(j.disabled=!0,J(`Warning: To device selection let enable ${A} usage`)):j.disabled=!1;for(let L=0;L<V.list.length;L++){let N=V.list[L],i=document.createElement("option");i.text=N.label,i.value=L.toString(),i.selected=V.index===L,j.add(i)}if(A==="camera"&&c2c_config.type==="audio"){document.getElementById("camera_dev").style.display="none";return}document.getElementById(`${A}_dev`).style.display=V.list.length>1?"block":"none"}function xi(){for(let i of _e.names){let M=document.querySelector(`#c2c_devices [name=${i}]`),q=M.selectedIndex;if(q!==-1){let t=M.options[q].value;_e.setSelectedIndex(i,parseInt(t))}}let A=_e.store();sessionStorage.setItem("c2c_selectedDevices",JSON.stringify(A));let V="Devices done: selected";for(let i of _e.names)_e.getNumber(i)>1&&(V+=`
${i}: "${_e.getSelected(i).label}"`);J(V);let j=_e.getSelected("microphone").deviceId;le.setConstraint("audio","deviceId",j);let L=_e.getSelected("camera").deviceId;le.setConstraint("video","deviceId",L);let N=_e.getSelected("speaker").deviceId;fe.setSpeakerId(N),gt()}function Ui(){let A=_e.getSelected("speaker").deviceId;return A===null&&(A=""),li===A?(J("c2c: remote video: sinkId is already assigned"),Promise.resolve()):we.setSinkId?(J(`c2c: remove video: setSinkId "${A}"`),we.srcObject=null,we.setSinkId(A).then(()=>{J("c2c: remote video: setSinkId completed"),li=A})):Promise.reject(new Error("setSinkId is not implemented"))}function Mi(){J("c2c_cameraToggle()"),me(""),ae.hasEnabledSendVideo()?ae.stopSendingVideo().then(()=>{qt(),Re&&Mt(!1),pt(ae.hasReceiveVideo())}).catch(A=>{J("stop sending video failure",A)}).finally(()=>{ve&&(ve.disabled=!1)}):(ve&&(ve.disabled=!0),ae.startSendingVideo().then(()=>{qt(),Re&&Mt(!0),pt(ae.hasReceiveVideo())}).catch(A=>{J("c2c error during start video",A)}).finally(()=>{ve&&(ve.disabled=!1)}))}async function Je(A){if(A&&typeof c2c_create_x_header=="function")try{un=c2c_create_x_header()}catch(V){me(V),J("Exception in function c2c_create_x_header",V);return}if(Dt!==null&&(clearTimeout(Dt),Dt=null),be=A,pn=!0,fe.stop(),Gi(),le.isInitialized())an?mi():J("SIP is already initialized. websocket is disconnected. Wait connection...");else try{await qi()}catch(V){J("phone initialization or SBC connecting error:",V),me(V),gt()}}async function qi(){me("Connecting"),ki({user:c2c_config.caller,displayName:c2c_config.callerDN,password:""})}function mi(){pn=!1,be?xt(c2c_config.call,pi()):xt(c2c_config.testCallUser,le.AUDIO)}function xt(A,V,j=[]){let L={};if(ae!==null)throw"Already exists active call";me("Calling",!0),c2c_serverConfig.iceTransportPolicyRelay&&hi&&(J("Used TURN debugging iceTransportPolicy: 'relay'"),L.pcConfig={iceTransportPolicy:"relay"}),(be&&!_n||!be&&!c2c_config.testCallUseMicrophone)&&(Pt=fe.audioCtx.createMediaStreamDestination(),L.mediaStream=Pt.stream),!be&&c2c_config.testCallSBCScore&&(j.push("X-AC-Action: test-voice-quality"),A=`${A}@${c2c_serverConfig.domain};duration=${c2c_config.testCallMinDuration*1e3}`),be&&un&&j.push(un),be&&cn&&j.push(`X-Token: ${cn}`),ae=le.call(V,A,j,L)}function Li(){ae!==null&&(ae.terminate(),ae=null)}function gi(A,V){let j=A.style;j.display="block",V?(j.width=c2c_config.videoSize.width,j.height=c2c_config.videoSize.height):(j.width=0,j.height=0)}function Ut(A){gi(Ge,A)}function pt(A){gi(we,A)}function Hi(){J("c2c_selfVideoToggle()"),Re=Me.checked,Mt(Re)}function Mt(A){A&&ae!==null&&ae.hasSendVideo()?(J("show self-video"),Ge.srcObject=ae.getRTCLocalStream(),Ge.volume=0,Ut(!0)):(J("hide self-video"),Ge.srcObject=null,Ut(!1))}function me(A,V=!1){Ve.innerHTML=A,Ve.dataset.id=++Ci,V&&function(j){setTimeout(()=>{Ve.dataset.id===j&&(Ve.innerHTML="")},c2c_config.messageDisplayTime*1e3)}(Ve.dataset.id)}async function Fi(){if(J("Test call is established"),c2c_config.testCallUseMicrophone?J("Test call plays microphone sound"):(J("Test call plays recorded sound"),fe.play(c2c_soundConfig.play.testCallSound,Pt)),me("Checking line quality..."),c2c_config.testCallSBCScore)J("Checking line quality (SBC test)...");else{if(typeof c2c_browserVoiceQualityTest>"u"){me("Warning: Missed browser voice test",!0),J("Warning: voice_quality.js is not loaded"),ae.terminate();return}await c2c_browserVoiceQualityTest()}}function ji(){getComputedStyle(_t).getPropertyValue("display")==="none"?(J("show keypad"),_t.style.display="block"):(J("hide keypad"),_t.style.display="none")}function Bi(A){ae&&(fe.play(Object.assign({name:A},c2c_soundConfig.play.dtmf)),ae.sendDTMF(A))}function fi(A){J(A),ge.disabled=!0,document.querySelector("#c2c_call_btn svg").setAttribute("class","c2c_call_svg_disabled"),dn.className="c2c_widget_disabled",c2c_config.testCallEnabled&&(Ie.disabled=!0)}function gt(){if(Pe&&navigator.connection&&(Pe.style.display="block"),qe&&(qe.style.display="block"),c2c_config.selectDevicesEnabled&&(Le.style.display="inline-block",Le.disabled=!1,gn.style.display="none"),c2c_config.testCallEnabled&&(Ie.style.display="inline-block",Ie.disabled=!1),ge.style.display="inline-block",ge.disabled=!1,ge.className="c2c_call_btn_ready",ge.querySelector("span").innerText="Call",ge.querySelector("svg").setAttribute("class","c2c_call_svg_ready"),ge.title=_i,mn=function(){Je(!0)},Ae){let A=c2c_config.type==="user_control"&&Ye;Ae.style.display=A?"inline-block":"none",mt&&(mt.checked=c2c_config.videoCheckboxDefault)}ve&&(ve.style.display="none",et&&(ve.style.display="none")),$e&&($e.style.display="none",_t.style.display="none"),We&&(We.style.display="none")}function Vi(){gn.style.display="block",Pe&&(Pe.style.display="none"),Le.style.display="none",Ie&&(Ie.style.display="none"),ge.style.display="none",Ae&&(Ae.style.display="none"),ve&&(ve.style.display="none",et&&(ve.style.display="none"))}function Gi(){Le&&(Le.style.display="none"),be?(Pe&&(Pe.style.display="none"),c2c_config.testCallEnabled&&(Ie.disabled=!0,Ie.style.display="none"),ge.className="c2c_call_btn_hangup",ge.querySelector("span").innerText="Hangup",ge.title="Hang up",ge.querySelector("svg").setAttribute("class","c2c_call_svg_calling"),ge.querySelector("svg").setAttribute("class","c2c_call_svg_calling"),mn=Li,Ae&&(Ae.style.display="none")):(qe&&(qe.innerHTML=""),ge.style.display="none",Ae&&(Ae.style.display="none"))}function Wi(){J("phone on remote hold")}function qt(){be&&(Ae&&(Ae.style.display="none"),ge.querySelector("svg").setAttribute("class","c2c_call_svg_hangup"),c2c_config.type==="user_control"&&Ye&&ve&&et&&(ve.style.display="inline-block",ve.title=ae.hasEnabledSendVideo()?"turn camera off":"turn camera on",et.setAttribute("class",ae.hasEnabledSendVideo()?"c2c_camera_on":"c2c_camera_off")),$e&&($e.style.display="inline-block"),We&&Ye&&ae.hasSendVideo()?We.style.display="inline-block":We.style.display="none")}Ei()});export default Yi();
